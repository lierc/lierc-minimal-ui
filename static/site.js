(function sortableModule(factory){"use strict";if(typeof define==="function"&&define.amd){define(factory)}else if(typeof module!="undefined"&&typeof module.exports!="undefined"){module.exports=factory()}else{window["Sortable"]=factory()}})(function sortableFactory(){"use strict";if(typeof window=="undefined"||!window.document){return function sortableError(){throw new Error("Sortable.js requires a window with a document")}}var dragEl,parentEl,ghostEl,cloneEl,rootEl,nextEl,lastDownEl,scrollEl,scrollParentEl,scrollCustomFn,lastEl,lastCSS,lastParentCSS,oldIndex,newIndex,activeGroup,putSortable,autoScroll={},tapEvt,touchEvt,moved,R_SPACE=/\s+/g,R_FLOAT=/left|right|inline/,expando="Sortable"+(new Date).getTime(),win=window,document=win.document,parseInt=win.parseInt,$=win.jQuery||win.Zepto,Polymer=win.Polymer,captureMode=false,supportDraggable=!!("draggable"in document.createElement("div")),supportCssPointerEvents=function(el){if(!!navigator.userAgent.match(/Trident.*rv[ :]?11\./)){return false}el=document.createElement("x");el.style.cssText="pointer-events:auto";return el.style.pointerEvents==="auto"}(),_silent=false,abs=Math.abs,min=Math.min,savedInputChecked=[],touchDragOverListeners=[],_autoScroll=_throttle(function(evt,options,rootEl){if(rootEl&&options.scroll){var _this=rootEl[expando],el,rect,sens=options.scrollSensitivity,speed=options.scrollSpeed,x=evt.clientX,y=evt.clientY,winWidth=window.innerWidth,winHeight=window.innerHeight,vx,vy,scrollOffsetX,scrollOffsetY;if(scrollParentEl!==rootEl){scrollEl=options.scroll;scrollParentEl=rootEl;scrollCustomFn=options.scrollFn;if(scrollEl===true){scrollEl=rootEl;do{if(scrollEl.offsetWidth<scrollEl.scrollWidth||scrollEl.offsetHeight<scrollEl.scrollHeight){break}}while(scrollEl=scrollEl.parentNode)}}if(scrollEl){el=scrollEl;rect=scrollEl.getBoundingClientRect();vx=(abs(rect.right-x)<=sens)-(abs(rect.left-x)<=sens);vy=(abs(rect.bottom-y)<=sens)-(abs(rect.top-y)<=sens)}if(!(vx||vy)){vx=(winWidth-x<=sens)-(x<=sens);vy=(winHeight-y<=sens)-(y<=sens);(vx||vy)&&(el=win)}if(autoScroll.vx!==vx||autoScroll.vy!==vy||autoScroll.el!==el){autoScroll.el=el;autoScroll.vx=vx;autoScroll.vy=vy;clearInterval(autoScroll.pid);if(el){autoScroll.pid=setInterval(function(){scrollOffsetY=vy?vy*speed:0;scrollOffsetX=vx?vx*speed:0;if("function"===typeof scrollCustomFn){return scrollCustomFn.call(_this,scrollOffsetX,scrollOffsetY,evt)}if(el===win){win.scrollTo(win.pageXOffset+scrollOffsetX,win.pageYOffset+scrollOffsetY)}else{el.scrollTop+=scrollOffsetY;el.scrollLeft+=scrollOffsetX}},24)}}}},30),_prepareGroup=function(options){function toFn(value,pull){if(value===void 0||value===true){value=group.name}if(typeof value==="function"){return value}else{return function(to,from){var fromGroup=from.options.group.name;return pull?value:value&&(value.join?value.indexOf(fromGroup)>-1:fromGroup==value)}}}var group={};var originalGroup=options.group;if(!originalGroup||typeof originalGroup!="object"){originalGroup={name:originalGroup}}group.name=originalGroup.name;group.checkPull=toFn(originalGroup.pull,true);group.checkPut=toFn(originalGroup.put);group.revertClone=originalGroup.revertClone;options.group=group};function Sortable(el,options){if(!(el&&el.nodeType&&el.nodeType===1)){throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(el)}this.el=el;this.options=options=_extend({},options);el[expando]=this;var defaults={group:Math.random(),sort:true,disabled:false,store:null,handle:null,scroll:true,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(el.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:true,animation:0,setData:function(dataTransfer,dragEl){dataTransfer.setData("Text",dragEl.textContent)},dropBubble:false,dragoverBubble:false,dataIdAttr:"data-id",delay:0,forceFallback:false,fallbackClass:"sortable-fallback",fallbackOnBody:false,fallbackTolerance:0,fallbackOffset:{x:0,y:0}};for(var name in defaults){!(name in options)&&(options[name]=defaults[name])}_prepareGroup(options);for(var fn in this){if(fn.charAt(0)==="_"&&typeof this[fn]==="function"){this[fn]=this[fn].bind(this)}}this.nativeDraggable=options.forceFallback?false:supportDraggable;_on(el,"mousedown",this._onTapStart);_on(el,"touchstart",this._onTapStart);_on(el,"pointerdown",this._onTapStart);if(this.nativeDraggable){_on(el,"dragover",this);_on(el,"dragenter",this)}touchDragOverListeners.push(this._onDragOver);options.store&&this.sort(options.store.get(this))}Sortable.prototype={constructor:Sortable,_onTapStart:function(evt){var _this=this,el=this.el,options=this.options,preventOnFilter=options.preventOnFilter,type=evt.type,touch=evt.touches&&evt.touches[0],target=(touch||evt).target,originalTarget=evt.target.shadowRoot&&evt.path[0]||target,filter=options.filter,startIndex;_saveInputCheckedState(el);if(dragEl){return}if(/mousedown|pointerdown/.test(type)&&evt.button!==0||options.disabled){return}target=_closest(target,options.draggable,el);if(!target){return}if(lastDownEl===target){return}startIndex=_index(target,options.draggable);if(typeof filter==="function"){if(filter.call(this,evt,target,this)){_dispatchEvent(_this,originalTarget,"filter",target,el,startIndex);preventOnFilter&&evt.preventDefault();return}}else if(filter){filter=filter.split(",").some(function(criteria){criteria=_closest(originalTarget,criteria.trim(),el);if(criteria){_dispatchEvent(_this,criteria,"filter",target,el,startIndex);return true}});if(filter){preventOnFilter&&evt.preventDefault();return}}if(options.handle&&!_closest(originalTarget,options.handle,el)){return}this._prepareDragStart(evt,touch,target,startIndex)},_prepareDragStart:function(evt,touch,target,startIndex){var _this=this,el=_this.el,options=_this.options,ownerDocument=el.ownerDocument,dragStartFn;if(target&&!dragEl&&target.parentNode===el){tapEvt=evt;rootEl=el;dragEl=target;parentEl=dragEl.parentNode;nextEl=dragEl.nextSibling;lastDownEl=target;activeGroup=options.group;oldIndex=startIndex;this._lastX=(touch||evt).clientX;this._lastY=(touch||evt).clientY;dragEl.style["will-change"]="transform";dragStartFn=function(){_this._disableDelayedDrag();dragEl.draggable=_this.nativeDraggable;_toggleClass(dragEl,options.chosenClass,true);_this._triggerDragStart(evt,touch);_dispatchEvent(_this,rootEl,"choose",dragEl,rootEl,oldIndex)};options.ignore.split(",").forEach(function(criteria){_find(dragEl,criteria.trim(),_disableDraggable)});_on(ownerDocument,"mouseup",_this._onDrop);_on(ownerDocument,"touchend",_this._onDrop);_on(ownerDocument,"touchcancel",_this._onDrop);_on(ownerDocument,"pointercancel",_this._onDrop);_on(ownerDocument,"selectstart",_this);if(options.delay){_on(ownerDocument,"mouseup",_this._disableDelayedDrag);_on(ownerDocument,"touchend",_this._disableDelayedDrag);_on(ownerDocument,"touchcancel",_this._disableDelayedDrag);_on(ownerDocument,"mousemove",_this._disableDelayedDrag);_on(ownerDocument,"touchmove",_this._disableDelayedDrag);_on(ownerDocument,"pointermove",_this._disableDelayedDrag);_this._dragStartTimer=setTimeout(dragStartFn,options.delay)}else{dragStartFn()}}},_disableDelayedDrag:function(){var ownerDocument=this.el.ownerDocument;clearTimeout(this._dragStartTimer);_off(ownerDocument,"mouseup",this._disableDelayedDrag);_off(ownerDocument,"touchend",this._disableDelayedDrag);_off(ownerDocument,"touchcancel",this._disableDelayedDrag);_off(ownerDocument,"mousemove",this._disableDelayedDrag);_off(ownerDocument,"touchmove",this._disableDelayedDrag);_off(ownerDocument,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(evt,touch){touch=touch||(evt.pointerType=="touch"?evt:null);if(touch){tapEvt={target:dragEl,clientX:touch.clientX,clientY:touch.clientY};this._onDragStart(tapEvt,"touch")}else if(!this.nativeDraggable){this._onDragStart(tapEvt,true)}else{_on(dragEl,"dragend",this);_on(rootEl,"dragstart",this._onDragStart)}try{if(document.selection){setTimeout(function(){document.selection.empty()})}else{window.getSelection().removeAllRanges()}}catch(err){}},_dragStarted:function(){if(rootEl&&dragEl){var options=this.options;_toggleClass(dragEl,options.ghostClass,true);_toggleClass(dragEl,options.dragClass,false);Sortable.active=this;_dispatchEvent(this,rootEl,"start",dragEl,rootEl,oldIndex)}else{this._nulling()}},_emulateDragOver:function(){if(touchEvt){if(this._lastX===touchEvt.clientX&&this._lastY===touchEvt.clientY){return}this._lastX=touchEvt.clientX;this._lastY=touchEvt.clientY;if(!supportCssPointerEvents){_css(ghostEl,"display","none")}var target=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),parent=target,i=touchDragOverListeners.length;if(parent){do{if(parent[expando]){while(i--){touchDragOverListeners[i]({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:target,rootEl:parent})}break}target=parent}while(parent=parent.parentNode)}if(!supportCssPointerEvents){_css(ghostEl,"display","")}}},_onTouchMove:function(evt){if(tapEvt){var options=this.options,fallbackTolerance=options.fallbackTolerance,fallbackOffset=options.fallbackOffset,touch=evt.touches?evt.touches[0]:evt,dx=touch.clientX-tapEvt.clientX+fallbackOffset.x,dy=touch.clientY-tapEvt.clientY+fallbackOffset.y,translate3d=evt.touches?"translate3d("+dx+"px,"+dy+"px,0)":"translate("+dx+"px,"+dy+"px)";if(!Sortable.active){if(fallbackTolerance&&min(abs(touch.clientX-this._lastX),abs(touch.clientY-this._lastY))<fallbackTolerance){return}this._dragStarted()}this._appendGhost();moved=true;touchEvt=touch;_css(ghostEl,"webkitTransform",translate3d);_css(ghostEl,"mozTransform",translate3d);_css(ghostEl,"msTransform",translate3d);_css(ghostEl,"transform",translate3d);evt.preventDefault()}},_appendGhost:function(){if(!ghostEl){var rect=dragEl.getBoundingClientRect(),css=_css(dragEl),options=this.options,ghostRect;ghostEl=dragEl.cloneNode(true);_toggleClass(ghostEl,options.ghostClass,false);_toggleClass(ghostEl,options.fallbackClass,true);_toggleClass(ghostEl,options.dragClass,true);_css(ghostEl,"top",rect.top-parseInt(css.marginTop,10));_css(ghostEl,"left",rect.left-parseInt(css.marginLeft,10));_css(ghostEl,"width",rect.width);_css(ghostEl,"height",rect.height);_css(ghostEl,"opacity","0.8");_css(ghostEl,"position","fixed");_css(ghostEl,"zIndex","100000");_css(ghostEl,"pointerEvents","none");options.fallbackOnBody&&document.body.appendChild(ghostEl)||rootEl.appendChild(ghostEl);ghostRect=ghostEl.getBoundingClientRect();_css(ghostEl,"width",rect.width*2-ghostRect.width);_css(ghostEl,"height",rect.height*2-ghostRect.height)}},_onDragStart:function(evt,useFallback){var dataTransfer=evt.dataTransfer,options=this.options;this._offUpEvents();if(activeGroup.checkPull(this,this,dragEl,evt)){cloneEl=_clone(dragEl);cloneEl.draggable=false;cloneEl.style["will-change"]="";_css(cloneEl,"display","none");_toggleClass(cloneEl,this.options.chosenClass,false);rootEl.insertBefore(cloneEl,dragEl);_dispatchEvent(this,rootEl,"clone",dragEl)}_toggleClass(dragEl,options.dragClass,true);if(useFallback){if(useFallback==="touch"){_on(document,"touchmove",this._onTouchMove);_on(document,"touchend",this._onDrop);_on(document,"touchcancel",this._onDrop);_on(document,"pointermove",this._onTouchMove);_on(document,"pointerup",this._onDrop)}else{_on(document,"mousemove",this._onTouchMove);_on(document,"mouseup",this._onDrop)}this._loopId=setInterval(this._emulateDragOver,50)}else{if(dataTransfer){dataTransfer.effectAllowed="move";options.setData&&options.setData.call(this,dataTransfer,dragEl)}_on(document,"drop",this);setTimeout(this._dragStarted,0)}},_onDragOver:function(evt){var el=this.el,target,dragRect,targetRect,revert,options=this.options,group=options.group,activeSortable=Sortable.active,isOwner=activeGroup===group,isMovingBetweenSortable=false,canSort=options.sort;if(evt.preventDefault!==void 0){evt.preventDefault();!options.dragoverBubble&&evt.stopPropagation()}if(dragEl.animated){return}moved=true;if(activeSortable&&!options.disabled&&(isOwner?canSort||(revert=!rootEl.contains(dragEl)):putSortable===this||(activeSortable.lastPullMode=activeGroup.checkPull(this,activeSortable,dragEl,evt))&&group.checkPut(this,activeSortable,dragEl,evt))&&(evt.rootEl===void 0||evt.rootEl===this.el)){_autoScroll(evt,options,this.el);if(_silent){return}target=_closest(evt.target,options.draggable,el);dragRect=dragEl.getBoundingClientRect();if(putSortable!==this){putSortable=this;isMovingBetweenSortable=true}if(revert){_cloneHide(activeSortable,true);parentEl=rootEl;if(cloneEl||nextEl){rootEl.insertBefore(dragEl,cloneEl||nextEl)}else if(!canSort){rootEl.appendChild(dragEl)}return}if(el.children.length===0||el.children[0]===ghostEl||el===evt.target&&_ghostIsLast(el,evt)){if(el.children.length!==0&&el.children[0]!==ghostEl&&el===evt.target){target=el.lastElementChild}if(target){if(target.animated){return}targetRect=target.getBoundingClientRect()}_cloneHide(activeSortable,isOwner);if(_onMove(rootEl,el,dragEl,dragRect,target,targetRect,evt)!==false){if(!dragEl.contains(el)){el.appendChild(dragEl);parentEl=el}this._animate(dragRect,dragEl);target&&this._animate(targetRect,target)}}else if(target&&!target.animated&&target!==dragEl&&target.parentNode[expando]!==void 0){if(lastEl!==target){lastEl=target;lastCSS=_css(target);lastParentCSS=_css(target.parentNode)}targetRect=target.getBoundingClientRect();var width=targetRect.right-targetRect.left,height=targetRect.bottom-targetRect.top,floating=R_FLOAT.test(lastCSS.cssFloat+lastCSS.display)||lastParentCSS.display=="flex"&&lastParentCSS["flex-direction"].indexOf("row")===0,isWide=target.offsetWidth>dragEl.offsetWidth,isLong=target.offsetHeight>dragEl.offsetHeight,halfway=(floating?(evt.clientX-targetRect.left)/width:(evt.clientY-targetRect.top)/height)>.5,nextSibling=target.nextElementSibling,after=false;if(floating){var elTop=dragEl.offsetTop,tgTop=target.offsetTop;if(elTop===tgTop){after=target.previousElementSibling===dragEl&&!isWide||halfway&&isWide}else if(target.previousElementSibling===dragEl||dragEl.previousElementSibling===target){after=(evt.clientY-targetRect.top)/height>.5}else{after=tgTop>elTop}}else if(!isMovingBetweenSortable){after=nextSibling!==dragEl&&!isLong||halfway&&isLong}var moveVector=_onMove(rootEl,el,dragEl,dragRect,target,targetRect,evt,after);if(moveVector!==false){if(moveVector===1||moveVector===-1){after=moveVector===1}_silent=true;setTimeout(_unsilent,30);_cloneHide(activeSortable,isOwner);if(!dragEl.contains(el)){if(after&&!nextSibling){el.appendChild(dragEl)}else{target.parentNode.insertBefore(dragEl,after?nextSibling:target)}}parentEl=dragEl.parentNode;this._animate(dragRect,dragEl);this._animate(targetRect,target)}}}},_animate:function(prevRect,target){var ms=this.options.animation;if(ms){var currentRect=target.getBoundingClientRect();if(prevRect.nodeType===1){prevRect=prevRect.getBoundingClientRect()}_css(target,"transition","none");_css(target,"transform","translate3d("+(prevRect.left-currentRect.left)+"px,"+(prevRect.top-currentRect.top)+"px,0)");target.offsetWidth;_css(target,"transition","all "+ms+"ms");_css(target,"transform","translate3d(0,0,0)");clearTimeout(target.animated);target.animated=setTimeout(function(){_css(target,"transition","");_css(target,"transform","");target.animated=false},ms)}},_offUpEvents:function(){var ownerDocument=this.el.ownerDocument;_off(document,"touchmove",this._onTouchMove);_off(document,"pointermove",this._onTouchMove);_off(ownerDocument,"mouseup",this._onDrop);_off(ownerDocument,"touchend",this._onDrop);_off(ownerDocument,"pointerup",this._onDrop);_off(ownerDocument,"touchcancel",this._onDrop);_off(ownerDocument,"pointercancel",this._onDrop);_off(ownerDocument,"selectstart",this)},_onDrop:function(evt){var el=this.el,options=this.options;clearInterval(this._loopId);clearInterval(autoScroll.pid);clearTimeout(this._dragStartTimer);_off(document,"mousemove",this._onTouchMove);if(this.nativeDraggable){_off(document,"drop",this);_off(el,"dragstart",this._onDragStart)}this._offUpEvents();if(evt){if(moved){evt.preventDefault();!options.dropBubble&&evt.stopPropagation()}ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl);if(rootEl===parentEl||Sortable.active.lastPullMode!=="clone"){cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl)}if(dragEl){if(this.nativeDraggable){_off(dragEl,"dragend",this)}_disableDraggable(dragEl);dragEl.style["will-change"]="";_toggleClass(dragEl,this.options.ghostClass,false);_toggleClass(dragEl,this.options.chosenClass,false);_dispatchEvent(this,rootEl,"unchoose",dragEl,rootEl,oldIndex);if(rootEl!==parentEl){newIndex=_index(dragEl,options.draggable);if(newIndex>=0){_dispatchEvent(null,parentEl,"add",dragEl,rootEl,oldIndex,newIndex);_dispatchEvent(this,rootEl,"remove",dragEl,rootEl,oldIndex,newIndex);_dispatchEvent(null,parentEl,"sort",dragEl,rootEl,oldIndex,newIndex);_dispatchEvent(this,rootEl,"sort",dragEl,rootEl,oldIndex,newIndex)}}else{if(dragEl.nextSibling!==nextEl){newIndex=_index(dragEl,options.draggable);if(newIndex>=0){_dispatchEvent(this,rootEl,"update",dragEl,rootEl,oldIndex,newIndex);_dispatchEvent(this,rootEl,"sort",dragEl,rootEl,oldIndex,newIndex)}}}if(Sortable.active){if(newIndex==null||newIndex===-1){newIndex=oldIndex}_dispatchEvent(this,rootEl,"end",dragEl,rootEl,oldIndex,newIndex);this.save()}}}this._nulling()},_nulling:function(){rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=scrollEl=scrollParentEl=tapEvt=touchEvt=moved=newIndex=lastEl=lastCSS=putSortable=activeGroup=Sortable.active=null;savedInputChecked.forEach(function(el){el.checked=true});savedInputChecked.length=0},handleEvent:function(evt){switch(evt.type){case"drop":case"dragend":this._onDrop(evt);break;case"dragover":case"dragenter":if(dragEl){this._onDragOver(evt);_globalDragOver(evt)}break;case"selectstart":evt.preventDefault();break}},toArray:function(){var order=[],el,children=this.el.children,i=0,n=children.length,options=this.options;for(;i<n;i++){el=children[i];if(_closest(el,options.draggable,this.el)){order.push(el.getAttribute(options.dataIdAttr)||_generateId(el))}}return order},sort:function(order){var items={},rootEl=this.el;this.toArray().forEach(function(id,i){var el=rootEl.children[i];if(_closest(el,this.options.draggable,rootEl)){items[id]=el}},this);order.forEach(function(id){if(items[id]){rootEl.removeChild(items[id]);rootEl.appendChild(items[id])}})},save:function(){var store=this.options.store;store&&store.set(this)},closest:function(el,selector){return _closest(el,selector||this.options.draggable,this.el)},option:function(name,value){var options=this.options;if(value===void 0){return options[name]}else{options[name]=value;if(name==="group"){_prepareGroup(options)}}},destroy:function(){var el=this.el;el[expando]=null;_off(el,"mousedown",this._onTapStart);_off(el,"touchstart",this._onTapStart);_off(el,"pointerdown",this._onTapStart);if(this.nativeDraggable){_off(el,"dragover",this);_off(el,"dragenter",this)}Array.prototype.forEach.call(el.querySelectorAll("[draggable]"),function(el){el.removeAttribute("draggable")});touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver),1);this._onDrop();this.el=el=null}};function _cloneHide(sortable,state){if(sortable.lastPullMode!=="clone"){state=true}if(cloneEl&&cloneEl.state!==state){_css(cloneEl,"display",state?"none":"");if(!state){if(cloneEl.state){if(sortable.options.group.revertClone){rootEl.insertBefore(cloneEl,nextEl);sortable._animate(dragEl,cloneEl)}else{rootEl.insertBefore(cloneEl,dragEl)}}}cloneEl.state=state}}function _closest(el,selector,ctx){if(el){ctx=ctx||document;do{if(selector===">*"&&el.parentNode===ctx||_matches(el,selector)){return el}}while(el=_getParentOrHost(el))}return null}function _getParentOrHost(el){var parent=el.host;return parent&&parent.nodeType?parent:el.parentNode}function _globalDragOver(evt){if(evt.dataTransfer){evt.dataTransfer.dropEffect="move"}evt.preventDefault()}function _on(el,event,fn){el.addEventListener(event,fn,captureMode)}function _off(el,event,fn){el.removeEventListener(event,fn,captureMode)}function _toggleClass(el,name,state){if(el){if(el.classList){el.classList[state?"add":"remove"](name)}else{var className=(" "+el.className+" ").replace(R_SPACE," ").replace(" "+name+" "," ");el.className=(className+(state?" "+name:"")).replace(R_SPACE," ")}}}function _css(el,prop,val){var style=el&&el.style;if(style){if(val===void 0){if(document.defaultView&&document.defaultView.getComputedStyle){val=document.defaultView.getComputedStyle(el,"")}else if(el.currentStyle){val=el.currentStyle}return prop===void 0?val:val[prop]}else{if(!(prop in style)){prop="-webkit-"+prop}style[prop]=val+(typeof val==="string"?"":"px")}}}function _find(ctx,tagName,iterator){if(ctx){var list=ctx.getElementsByTagName(tagName),i=0,n=list.length;if(iterator){for(;i<n;i++){iterator(list[i],i)}}return list}return[]}function _dispatchEvent(sortable,rootEl,name,targetEl,fromEl,startIndex,newIndex){sortable=sortable||rootEl[expando];var evt=document.createEvent("Event"),options=sortable.options,onName="on"+name.charAt(0).toUpperCase()+name.substr(1);evt.initEvent(name,true,true);evt.to=rootEl;evt.from=fromEl||rootEl;evt.item=targetEl||rootEl;evt.clone=cloneEl;evt.oldIndex=startIndex;evt.newIndex=newIndex;rootEl.dispatchEvent(evt);if(options[onName]){options[onName].call(sortable,evt)}}function _onMove(fromEl,toEl,dragEl,dragRect,targetEl,targetRect,originalEvt,willInsertAfter){var evt,sortable=fromEl[expando],onMoveFn=sortable.options.onMove,retVal;evt=document.createEvent("Event");evt.initEvent("move",true,true);evt.to=toEl;evt.from=fromEl;evt.dragged=dragEl;evt.draggedRect=dragRect;evt.related=targetEl||toEl;evt.relatedRect=targetRect||toEl.getBoundingClientRect();evt.willInsertAfter=willInsertAfter;fromEl.dispatchEvent(evt);if(onMoveFn){retVal=onMoveFn.call(sortable,evt,originalEvt)}return retVal}function _disableDraggable(el){el.draggable=false}function _unsilent(){_silent=false}function _ghostIsLast(el,evt){var lastEl=el.lastElementChild,rect=lastEl.getBoundingClientRect();return evt.clientY-(rect.top+rect.height)>5||evt.clientX-(rect.left+rect.width)>5}function _generateId(el){var str=el.tagName+el.className+el.src+el.href+el.textContent,i=str.length,sum=0;while(i--){sum+=str.charCodeAt(i)}return sum.toString(36)}function _index(el,selector){var index=0;if(!el||!el.parentNode){return-1}while(el&&(el=el.previousElementSibling)){if(el.nodeName.toUpperCase()!=="TEMPLATE"&&(selector===">*"||_matches(el,selector))){index++}}return index}function _matches(el,selector){if(el){selector=selector.split(".");var tag=selector.shift().toUpperCase(),re=new RegExp("\\s("+selector.join("|")+")(?=\\s)","g");return(tag===""||el.nodeName.toUpperCase()==tag)&&(!selector.length||((" "+el.className+" ").match(re)||[]).length==selector.length)}return false}function _throttle(callback,ms){var args,_this;return function(){if(args===void 0){args=arguments;_this=this;setTimeout(function(){if(args.length===1){callback.call(_this,args[0])}else{callback.apply(_this,args)}args=void 0},ms)}}}function _extend(dst,src){if(dst&&src){for(var key in src){if(src.hasOwnProperty(key)){dst[key]=src[key]}}}return dst}function _clone(el){return $?$(el).clone(true)[0]:Polymer&&Polymer.dom?Polymer.dom(el).cloneNode(true):el.cloneNode(true)}function _saveInputCheckedState(root){var inputs=root.getElementsByTagName("input");var idx=inputs.length;while(idx--){var el=inputs[idx];el.checked&&savedInputChecked.push(el)}}_on(document,"touchmove",function(evt){if(Sortable.active){evt.preventDefault()}});try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){captureMode={capture:false,passive:false}}}))}catch(err){}Sortable.utils={on:_on,off:_off,css:_css,find:_find,is:function(el,selector){return!!_closest(el,selector,el)},extend:_extend,throttle:_throttle,closest:_closest,toggleClass:_toggleClass,clone:_clone,index:_index};Sortable.create=function(el,options){return new Sortable(el,options)};Sortable.version="1.6.0";return Sortable});(function(global){"use strict";var setTimeout=global.setTimeout;var clearTimeout=global.clearTimeout;var k=function(){};function XHRTransport(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg){this._internal=new XHRTransportInternal(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg)}XHRTransport.prototype.open=function(url,withCredentials){this._internal.open(url,withCredentials)};XHRTransport.prototype.cancel=function(){this._internal.cancel()};function XHRTransportInternal(xhr,onStartCallback,onProgressCallback,onFinishCallback,thisArg){this.onStartCallback=onStartCallback;this.onProgressCallback=onProgressCallback;this.onFinishCallback=onFinishCallback;this.thisArg=thisArg;this.xhr=xhr;this.state=0;this.charOffset=0;this.offset=0;this.url="";this.withCredentials=false;this.timeout=0}XHRTransportInternal.prototype.onStart=function(){if(this.state===1){this.state=2;var status=0;var statusText="";var contentType=undefined;if(!("contentType"in this.xhr)){try{status=this.xhr.status;statusText=this.xhr.statusText;contentType=this.xhr.getResponseHeader("Content-Type")}catch(error){status=0;statusText="";contentType=undefined}}else{status=200;statusText="OK";contentType=this.xhr.contentType}if(contentType==undefined){contentType=""}this.onStartCallback.call(this.thisArg,status,statusText,contentType)}};XHRTransportInternal.prototype.onProgress=function(){this.onStart();if(this.state===2||this.state===3){this.state=3;var responseText="";try{responseText=this.xhr.responseText}catch(error){}var chunkStart=this.charOffset;var length=responseText.length;for(var i=this.offset;i<length;i+=1){var c=responseText.charCodeAt(i);if(c==="\n".charCodeAt(0)||c==="\r".charCodeAt(0)){this.charOffset=i+1}}this.offset=length;var chunk=responseText.slice(chunkStart,this.charOffset);this.onProgressCallback.call(this.thisArg,chunk)}};XHRTransportInternal.prototype.onFinish=function(){this.onProgress();if(this.state===3){this.state=4;if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0}this.onFinishCallback.call(this.thisArg)}};XHRTransportInternal.prototype.onReadyStateChange=function(){if(this.xhr!=undefined){if(this.xhr.readyState===4){if(this.xhr.status===0){this.onFinish()}else{this.onFinish()}}else if(this.xhr.readyState===3){this.onProgress()}else if(this.xhr.readyState===2){}}};XHRTransportInternal.prototype.onTimeout2=function(){this.timeout=0;var tmp=/^data\:([^,]*?)(base64)?,([\S]*)$/.exec(this.url);var contentType=tmp[1];var data=tmp[2]==="base64"?global.atob(tmp[3]):decodeURIComponent(tmp[3]);if(this.state===1){this.state=2;this.onStartCallback.call(this.thisArg,200,"OK",contentType)}if(this.state===2||this.state===3){this.state=3;this.onProgressCallback.call(this.thisArg,data)}if(this.state===3){this.state=4;this.onFinishCallback.call(this.thisArg)}};XHRTransportInternal.prototype.onTimeout1=function(){this.timeout=0;this.open(this.url,this.withCredentials)};XHRTransportInternal.prototype.onTimeout0=function(){var that=this;this.timeout=setTimeout(function(){that.onTimeout0()},500);if(this.xhr.readyState===3){this.onProgress()}};XHRTransportInternal.prototype.handleEvent=function(event){if(event.type==="load"){this.onFinish()}else if(event.type==="error"){this.onFinish()}else if(event.type==="abort"){this.onFinish()}else if(event.type==="progress"){this.onProgress()}else if(event.type==="readystatechange"){this.onReadyStateChange()}};XHRTransportInternal.prototype.open=function(url,withCredentials){if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0}this.url=url;this.withCredentials=withCredentials;this.state=1;this.charOffset=0;this.offset=0;var that=this;var tmp=/^data\:([^,]*?)(?:;base64)?,[\S]*$/.exec(url);if(tmp!=undefined){this.timeout=setTimeout(function(){that.onTimeout2()},0);return}if((!("ontimeout"in this.xhr)||"sendAsBinary"in this.xhr||"mozAnon"in this.xhr)&&global.document!=undefined&&global.document.readyState!=undefined&&global.document.readyState!=="complete"){this.timeout=setTimeout(function(){that.onTimeout1()},4);return}this.xhr.onload=function(event){that.handleEvent({type:"load"})};this.xhr.onerror=function(){that.handleEvent({type:"error"})};this.xhr.onabort=function(){that.handleEvent({type:"abort"})};this.xhr.onprogress=function(){that.handleEvent({type:"progress"})};this.xhr.onreadystatechange=function(){that.handleEvent({type:"readystatechange"})};this.xhr.open("GET",url,true);this.xhr.withCredentials=withCredentials;this.xhr.responseType="text";if("setRequestHeader"in this.xhr){this.xhr.setRequestHeader("Accept","text/event-stream")}try{this.xhr.send(undefined)}catch(error1){throw error1}if("readyState"in this.xhr&&global.opera!=undefined){this.timeout=setTimeout(function(){that.onTimeout0()},0)}};XHRTransportInternal.prototype.cancel=function(){if(this.state!==0&&this.state!==4){this.state=4;this.xhr.onload=k;this.xhr.onerror=k;this.xhr.onabort=k;this.xhr.onprogress=k;this.xhr.onreadystatechange=k;this.xhr.abort();if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0}this.onFinishCallback.call(this.thisArg)}this.state=0};function Map(){this._data={}}Map.prototype.get=function(key){return this._data[key+"~"]};Map.prototype.set=function(key,value){this._data[key+"~"]=value};Map.prototype["delete"]=function(key){delete this._data[key+"~"]};function EventTarget(){this._listeners=new Map}function throwError(e){setTimeout(function(){throw e},0)}EventTarget.prototype.dispatchEvent=function(event){event.target=this;var type=event.type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){return}var length=typeListeners.length;var listener=undefined;for(var i=0;i<length;i+=1){listener=typeListeners[i];try{if(typeof listener.handleEvent==="function"){listener.handleEvent(event)}else{listener.call(this,event)}}catch(e){throwError(e)}}};EventTarget.prototype.addEventListener=function(type,callback){type=type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){typeListeners=[];listeners.set(type,typeListeners)}for(var i=typeListeners.length;i>=0;i-=1){if(typeListeners[i]===callback){return}}typeListeners.push(callback)};EventTarget.prototype.removeEventListener=function(type,callback){type=type.toString();var listeners=this._listeners;var typeListeners=listeners.get(type);if(typeListeners==undefined){return}var length=typeListeners.length;var filtered=[];for(var i=0;i<length;i+=1){if(typeListeners[i]!==callback){filtered.push(typeListeners[i])}}if(filtered.length===0){listeners["delete"](type)}else{listeners.set(type,filtered)}};function Event(type){this.type=type;this.target=undefined}function MessageEvent(type,options){Event.call(this,type);this.data=options.data;this.lastEventId=options.lastEventId}MessageEvent.prototype=Event.prototype;var XHR=global.XMLHttpRequest;var XDR=global.XDomainRequest;var isCORSSupported=XHR!=undefined&&(new XHR).withCredentials!=undefined;var Transport=isCORSSupported||XHR!=undefined&&XDR==undefined?XHR:XDR;var WAITING=-1;var CONNECTING=0;var OPEN=1;var CLOSED=2;var AFTER_CR=3;var FIELD_START=4;var FIELD=5;var VALUE_START=6;var VALUE=7;var contentTypeRegExp=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i;var MINIMUM_DURATION=1e3;var MAXIMUM_DURATION=18e6;var getDuration=function(value,def){var n=value;if(n!==n){n=def}return n<MINIMUM_DURATION?MINIMUM_DURATION:n>MAXIMUM_DURATION?MAXIMUM_DURATION:n};var fire=function(that,f,event){try{if(typeof f==="function"){f.call(that,event)}}catch(e){throwError(e)}};function EventSource(url,options){EventTarget.call(this);this.onopen=undefined;this.onmessage=undefined;this.onerror=undefined;this.url="";this.readyState=CONNECTING;this.withCredentials=false;this._internal=new EventSourceInternal(this,url,options)}function EventSourceInternal(es,url,options){this.url=url.toString();this.readyState=CONNECTING;this.withCredentials=isCORSSupported&&options!=undefined&&Boolean(options.withCredentials);this.es=es;this.initialRetry=getDuration(1e3,0);
this.heartbeatTimeout=getDuration(45e3,0);this.lastEventId="";this.retry=this.initialRetry;this.wasActivity=false;var CurrentTransport=options!=undefined&&options.Transport!=undefined?options.Transport:Transport;var xhr=new CurrentTransport;this.transport=new XHRTransport(xhr,this.onStart,this.onProgress,this.onFinish,this);this.timeout=0;this.currentState=WAITING;this.dataBuffer=[];this.lastEventIdBuffer="";this.eventTypeBuffer="";this.state=FIELD_START;this.fieldStart=0;this.valueStart=0;this.es.url=this.url;this.es.readyState=this.readyState;this.es.withCredentials=this.withCredentials;this.onTimeout()}EventSourceInternal.prototype.onStart=function(status,statusText,contentType){if(this.currentState===CONNECTING){if(contentType==undefined){contentType=""}if(status===200&&contentTypeRegExp.test(contentType)){this.currentState=OPEN;this.wasActivity=true;this.retry=this.initialRetry;this.readyState=OPEN;this.es.readyState=OPEN;var event=new Event("open");this.es.dispatchEvent(event);fire(this.es,this.es.onopen,event)}else if(status!==0){var message="";if(status!==200){message="EventSource's response has a status "+status+" "+statusText.replace(/\s+/g," ")+" that is not 200. Aborting the connection."}else{message="EventSource's response has a Content-Type specifying an unsupported type: "+contentType.replace(/\s+/g," ")+". Aborting the connection."}throwError(new Error(message));this.close();var event=new Event("error");this.es.dispatchEvent(event);fire(this.es,this.es.onerror,event)}}};EventSourceInternal.prototype.onProgress=function(chunk){if(this.currentState===OPEN){var length=chunk.length;if(length!==0){this.wasActivity=true}for(var position=0;position<length;position+=1){var c=chunk.charCodeAt(position);if(this.state===AFTER_CR&&c==="\n".charCodeAt(0)){this.state=FIELD_START}else{if(this.state===AFTER_CR){this.state=FIELD_START}if(c==="\r".charCodeAt(0)||c==="\n".charCodeAt(0)){if(this.state!==FIELD_START){if(this.state===FIELD){this.valueStart=position+1}var field=chunk.slice(this.fieldStart,this.valueStart-1);var value=chunk.slice(this.valueStart+(this.valueStart<position&&chunk.charCodeAt(this.valueStart)===" ".charCodeAt(0)?1:0),position);if(field==="data"){this.dataBuffer.push(value)}else if(field==="id"){this.lastEventIdBuffer=value}else if(field==="event"){this.eventTypeBuffer=value}else if(field==="retry"){this.initialRetry=getDuration(Number(value),this.initialRetry);this.retry=this.initialRetry}else if(field==="heartbeatTimeout"){this.heartbeatTimeout=getDuration(Number(value),this.heartbeatTimeout);if(this.timeout!==0){clearTimeout(this.timeout);var that=this;this.timeout=setTimeout(function(){that.onTimeout()},this.heartbeatTimeout)}}}if(this.state===FIELD_START){if(this.dataBuffer.length!==0){this.lastEventId=this.lastEventIdBuffer;if(this.eventTypeBuffer===""){this.eventTypeBuffer="message"}var event=new MessageEvent(this.eventTypeBuffer,{data:this.dataBuffer.join("\n"),lastEventId:this.lastEventIdBuffer});this.es.dispatchEvent(event);if(this.eventTypeBuffer==="message"){fire(this.es,this.es.onmessage,event)}if(this.currentState===CLOSED){return}}this.dataBuffer.length=0;this.eventTypeBuffer=""}this.state=c==="\r".charCodeAt(0)?AFTER_CR:FIELD_START}else{if(this.state===FIELD_START){this.fieldStart=position;this.state=FIELD}if(this.state===FIELD){if(c===":".charCodeAt(0)){this.valueStart=position+1;this.state=VALUE_START}}else if(this.state===VALUE_START){this.state=VALUE}}}}}};EventSourceInternal.prototype.onFinish=function(){if(this.currentState===OPEN||this.currentState===CONNECTING){this.currentState=WAITING;if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0}if(this.retry>this.initialRetry*16){this.retry=this.initialRetry*16}if(this.retry>MAXIMUM_DURATION){this.retry=MAXIMUM_DURATION}var that=this;this.timeout=setTimeout(function(){that.onTimeout()},this.retry);this.retry=this.retry*2+1;this.readyState=CONNECTING;this.es.readyState=CONNECTING;var event=new Event("error");this.es.dispatchEvent(event);fire(this.es,this.es.onerror,event)}};EventSourceInternal.prototype.onTimeout=function(){this.timeout=0;if(this.currentState!==WAITING){if(!this.wasActivity){throwError(new Error("No activity within "+this.heartbeatTimeout+" milliseconds. Reconnecting."));this.transport.cancel()}else{this.wasActivity=false;var that=this;this.timeout=setTimeout(function(){that.onTimeout()},this.heartbeatTimeout)}return}this.wasActivity=false;var that=this;this.timeout=setTimeout(function(){that.onTimeout()},this.heartbeatTimeout);this.currentState=CONNECTING;this.dataBuffer.length=0;this.eventTypeBuffer="";this.lastEventIdBuffer=this.lastEventId;this.fieldStart=0;this.valueStart=0;this.state=FIELD_START;var s=this.url.slice(0,5);if(s!=="data:"&&s!=="blob:"){s=this.url+((this.url.indexOf("?",0)===-1?"?":"&")+"lastEventId="+encodeURIComponent(this.lastEventId)+"&r="+(Math.random()+1).toString().slice(2))}else{s=this.url}try{this.transport.open(s,this.withCredentials)}catch(error){this.close();throw error}};EventSourceInternal.prototype.close=function(){this.currentState=CLOSED;this.transport.cancel();if(this.timeout!==0){clearTimeout(this.timeout);this.timeout=0}this.readyState=CLOSED;this.es.readyState=CLOSED};function F(){this.CONNECTING=CONNECTING;this.OPEN=OPEN;this.CLOSED=CLOSED}F.prototype=EventTarget.prototype;EventSource.prototype=new F;EventSource.prototype.close=function(){this._internal.close()};F.call(EventSource);if(isCORSSupported){EventSource.prototype.withCredentials=undefined}var isEventSourceSupported=function(){return global.EventSource!=undefined&&"withCredentials"in global.EventSource.prototype};if(Transport!=undefined&&(global.EventSource==undefined||isCORSSupported&&!isEventSourceSupported())){global.NativeEventSource=global.EventSource;global.EventSource=EventSource}})(typeof window!=="undefined"?window:this);(function(self){"use strict";if(self.fetch){return}var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{new Blob;return true}catch(e){return false}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(support.arrayBuffer){var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var isDataView=function(obj){return obj&&DataView.prototype.isPrototypeOf(obj)};var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1}}function normalizeName(name){if(typeof name!=="string"){name=String(name)}if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(name)){throw new TypeError("Invalid character in header field name")}return name.toLowerCase()}function normalizeValue(value){if(typeof value!=="string"){value=String(value)}return value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===undefined,value:value}}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator}}return iterator}function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach(function(value,name){this.append(name,value)},this)}else if(Array.isArray(headers)){headers.forEach(function(header){this.append(header[0],header[1])},this)}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}}Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+","+value:value};Headers.prototype["delete"]=function(name){delete this.map[normalizeName(name)]};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this)}}};Headers.prototype.keys=function(){var items=[];this.forEach(function(value,name){items.push(name)});return iteratorFor(items)};Headers.prototype.values=function(){var items=[];this.forEach(function(value){items.push(value)});return iteratorFor(items)};Headers.prototype.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value])});return iteratorFor(items)};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries}function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError("Already read"))}body.bodyUsed=true}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise}function readBlobAsText(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsText(blob);return promise}function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i])}return chars.join("")}function bufferClone(buf){if(buf.slice){return buf.slice(0)}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer}}function Body(){this.bodyUsed=false;this._initBody=function(body){this._bodyInit=body;if(!body){this._bodyText=""}else if(typeof body==="string"){this._bodyText=body}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString()}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body)}else{throw new Error("unsupported BodyInit type")}if(!this.headers.get("content-type")){if(typeof body==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return consumed(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(readBlobAsArrayBuffer)}}}this.text=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return readBlobAsText(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(support.formData){this.formData=function(){return this.text().then(decode)}}this.json=function(){return this.text().then(JSON.parse)};return this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed){throw new TypeError("Already read")}this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers)}this.method=input.method;this.mode=input.mode;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true}}else{this.url=String(input)}this.credentials=options.credentials||this.credentials||"omit";if(options.headers||!this.headers){this.headers=new Headers(options.headers)}this.method=normalizeMethod(options.method||this.method||"GET");this.mode=options.mode||this.mode||null;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&body){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(body)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData;body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("=");var name=split.shift().replace(/\+/g," ");var value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}});return form}function parseHeaders(rawHeaders){var headers=new Headers;var preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g," ");preProcessedHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(":");var key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}});return headers}Body.call(Request.prototype);function Response(bodyInit,options){if(!options){options={}}this.type="default";this.status="status"in options?options.status:200;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in options?options.statusText:"OK";this.headers=new Headers(options.headers);this.url=options.url||"";this._initBody(bodyInit)}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var response=new Response(null,{status:0,statusText:""});response.type="error";return response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError("Invalid status code")}return new Response(null,{status:status,headers:{location:url}})};self.Headers=Headers;self.Request=Request;self.Response=Response;self.fetch=function(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);var xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))};xhr.onerror=function(){reject(new TypeError("Network request failed"))};xhr.ontimeout=function(){reject(new TypeError("Network request failed"))};xhr.open(request.method,request.url,true);if(request.credentials==="include"){xhr.withCredentials=true}else if(request.credentials==="omit"){xhr.withCredentials=false}if("responseType"in xhr&&support.blob){xhr.responseType="blob"}request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)});xhr.send(typeof request._bodyInit==="undefined"?null:request._bodyInit)})};self.fetch.polyfill=true})(typeof self!=="undefined"?self:this);(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["Handlebars"]=factory();else root["Handlebars"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _handlebarsRuntime=__webpack_require__(2);var _handlebarsRuntime2=_interopRequireDefault(_handlebarsRuntime);var _handlebarsCompilerAst=__webpack_require__(35);var _handlebarsCompilerAst2=_interopRequireDefault(_handlebarsCompilerAst);var _handlebarsCompilerBase=__webpack_require__(36);var _handlebarsCompilerCompiler=__webpack_require__(41);var _handlebarsCompilerJavascriptCompiler=__webpack_require__(42);var _handlebarsCompilerJavascriptCompiler2=_interopRequireDefault(_handlebarsCompilerJavascriptCompiler);var _handlebarsCompilerVisitor=__webpack_require__(39);var _handlebarsCompilerVisitor2=_interopRequireDefault(_handlebarsCompilerVisitor);var _handlebarsNoConflict=__webpack_require__(34);var _handlebarsNoConflict2=_interopRequireDefault(_handlebarsNoConflict);var _create=_handlebarsRuntime2["default"].create;function create(){var hb=_create();hb.compile=function(input,options){return _handlebarsCompilerCompiler.compile(input,options,hb)};hb.precompile=function(input,options){return _handlebarsCompilerCompiler.precompile(input,options,hb)};hb.AST=_handlebarsCompilerAst2["default"];hb.Compiler=_handlebarsCompilerCompiler.Compiler;hb.JavaScriptCompiler=_handlebarsCompilerJavascriptCompiler2["default"];hb.Parser=_handlebarsCompilerBase.parser;hb.parse=_handlebarsCompilerBase.parse;return hb}var inst=create();inst.create=create;_handlebarsNoConflict2["default"](inst);inst.Visitor=_handlebarsCompilerVisitor2["default"];inst["default"]=inst;exports["default"]=inst;module.exports=exports["default"]},function(module,exports){"use strict";exports["default"]=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};exports.__esModule=true},function(module,exports,__webpack_require__){"use strict";var _interopRequireWildcard=__webpack_require__(3)["default"];var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _handlebarsBase=__webpack_require__(4);var base=_interopRequireWildcard(_handlebarsBase);var _handlebarsSafeString=__webpack_require__(21);var _handlebarsSafeString2=_interopRequireDefault(_handlebarsSafeString);var _handlebarsException=__webpack_require__(6);var _handlebarsException2=_interopRequireDefault(_handlebarsException);var _handlebarsUtils=__webpack_require__(5);var Utils=_interopRequireWildcard(_handlebarsUtils);var _handlebarsRuntime=__webpack_require__(22);var runtime=_interopRequireWildcard(_handlebarsRuntime);var _handlebarsNoConflict=__webpack_require__(34);var _handlebarsNoConflict2=_interopRequireDefault(_handlebarsNoConflict);function create(){var hb=new base.HandlebarsEnvironment;Utils.extend(hb,base);hb.SafeString=_handlebarsSafeString2["default"];hb.Exception=_handlebarsException2["default"];hb.Utils=Utils;hb.escapeExpression=Utils.escapeExpression;hb.VM=runtime;hb.template=function(spec){return runtime.template(spec,hb)};return hb}var inst=create();inst.create=create;_handlebarsNoConflict2["default"](inst);inst["default"]=inst;exports["default"]=inst;module.exports=exports["default"]},function(module,exports){"use strict";exports["default"]=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}};exports.__esModule=true},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.HandlebarsEnvironment=HandlebarsEnvironment;var _utils=__webpack_require__(5);var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);var _helpers=__webpack_require__(10);var _decorators=__webpack_require__(18);var _logger=__webpack_require__(20);var _logger2=_interopRequireDefault(_logger);var VERSION="4.0.10";exports.VERSION=VERSION;var COMPILER_REVISION=7;exports.COMPILER_REVISION=COMPILER_REVISION;var REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};exports.REVISION_CHANGES=REVISION_CHANGES;var objectType="[object Object]";function HandlebarsEnvironment(helpers,partials,decorators){this.helpers=helpers||{};this.partials=partials||{};this.decorators=decorators||{};_helpers.registerDefaultHelpers(this);_decorators.registerDefaultDecorators(this)}HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:_logger2["default"],log:_logger2["default"].log,registerHelper:function registerHelper(name,fn){if(_utils.toString.call(name)===objectType){if(fn){throw new _exception2["default"]("Arg not supported with multiple helpers")}_utils.extend(this.helpers,name)}else{this.helpers[name]=fn}},unregisterHelper:function unregisterHelper(name){delete this.helpers[name]},registerPartial:function registerPartial(name,partial){if(_utils.toString.call(name)===objectType){_utils.extend(this.partials,name)}else{if(typeof partial==="undefined"){throw new _exception2["default"]('Attempting to register a partial called "'+name+'" as undefined')}this.partials[name]=partial}},unregisterPartial:function unregisterPartial(name){delete this.partials[name]},registerDecorator:function registerDecorator(name,fn){if(_utils.toString.call(name)===objectType){if(fn){throw new _exception2["default"]("Arg not supported with multiple decorators")}_utils.extend(this.decorators,name)}else{this.decorators[name]=fn}},unregisterDecorator:function unregisterDecorator(name){delete this.decorators[name]}};var log=_logger2["default"].log;exports.log=log;exports.createFrame=_utils.createFrame;exports.logger=_logger2["default"]},function(module,exports){"use strict";exports.__esModule=true;exports.extend=extend;exports.indexOf=indexOf;exports.escapeExpression=escapeExpression;exports.isEmpty=isEmpty;exports.createFrame=createFrame;exports.blockParams=blockParams;exports.appendContextPath=appendContextPath;var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"};var badChars=/[&<>"'`=]/g,possible=/[&<>"'`=]/;function escapeChar(chr){return escape[chr]}function extend(obj){for(var i=1;i<arguments.length;i++){for(var key in arguments[i]){if(Object.prototype.hasOwnProperty.call(arguments[i],key)){obj[key]=arguments[i][key]}}}return obj}var toString=Object.prototype.toString;exports.toString=toString;var isFunction=function isFunction(value){return typeof value==="function"};if(isFunction(/x/)){exports.isFunction=isFunction=function(value){return typeof value==="function"&&toString.call(value)==="[object Function]"}}exports.isFunction=isFunction;var isArray=Array.isArray||function(value){return value&&typeof value==="object"?toString.call(value)==="[object Array]":false};exports.isArray=isArray;function indexOf(array,value){for(var i=0,len=array.length;i<len;i++){if(array[i]===value){return i}}return-1}function escapeExpression(string){if(typeof string!=="string"){if(string&&string.toHTML){return string.toHTML()}else if(string==null){return""}else if(!string){return string+""}string=""+string}if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)}function isEmpty(value){if(!value&&value!==0){return true}else if(isArray(value)&&value.length===0){return true}else{return false}}function createFrame(object){var frame=extend({},object);frame._parent=object;return frame}function blockParams(params,ids){params.path=ids;return params}function appendContextPath(contextPath,id){return(contextPath?contextPath+".":"")+id}},function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(7)["default"];exports.__esModule=true;var errorProps=["description","fileName","lineNumber","message","name","number","stack"];function Exception(message,node){var loc=node&&node.loc,line=undefined,column=undefined;if(loc){line=loc.start.line;column=loc.start.column;message+=" - "+line+":"+column}var tmp=Error.prototype.constructor.call(this,message);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}if(Error.captureStackTrace){Error.captureStackTrace(this,Exception)}try{if(loc){this.lineNumber=line;if(_Object$defineProperty){Object.defineProperty(this,"column",{value:column,enumerable:true})}else{this.column=column}}}catch(nop){}}Exception.prototype=new Error;exports["default"]=Exception;module.exports=exports["default"]},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(8),__esModule:true}},function(module,exports,__webpack_require__){var $=__webpack_require__(9);module.exports=function defineProperty(it,key,desc){return $.setDesc(it,key,desc)}},function(module,exports){var $Object=Object;module.exports={create:$Object.create,getProto:$Object.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:$Object.getOwnPropertyDescriptor,setDesc:$Object.defineProperty,setDescs:$Object.defineProperties,getKeys:$Object.keys,getNames:$Object.getOwnPropertyNames,getSymbols:$Object.getOwnPropertySymbols,each:[].forEach}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.registerDefaultHelpers=registerDefaultHelpers;var _helpersBlockHelperMissing=__webpack_require__(11);var _helpersBlockHelperMissing2=_interopRequireDefault(_helpersBlockHelperMissing);var _helpersEach=__webpack_require__(12);var _helpersEach2=_interopRequireDefault(_helpersEach);var _helpersHelperMissing=__webpack_require__(13);var _helpersHelperMissing2=_interopRequireDefault(_helpersHelperMissing);var _helpersIf=__webpack_require__(14);var _helpersIf2=_interopRequireDefault(_helpersIf);var _helpersLog=__webpack_require__(15);var _helpersLog2=_interopRequireDefault(_helpersLog);var _helpersLookup=__webpack_require__(16);var _helpersLookup2=_interopRequireDefault(_helpersLookup);var _helpersWith=__webpack_require__(17);var _helpersWith2=_interopRequireDefault(_helpersWith);function registerDefaultHelpers(instance){_helpersBlockHelperMissing2["default"](instance);_helpersEach2["default"](instance);_helpersHelperMissing2["default"](instance);_helpersIf2["default"](instance);_helpersLog2["default"](instance);_helpersLookup2["default"](instance);_helpersWith2["default"](instance)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);exports["default"]=function(instance){instance.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse,fn=options.fn;if(context===true){return fn(this)}else if(context===false||context==null){return inverse(this)}else if(_utils.isArray(context)){if(context.length>0){if(options.ids){options.ids=[options.name]}return instance.helpers.each(context,options)}else{return inverse(this)}}else{if(options.data&&options.ids){var data=_utils.createFrame(options.data);data.contextPath=_utils.appendContextPath(options.data.contextPath,options.name);options={data:data}}return fn(context,options)}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _utils=__webpack_require__(5);var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("each",function(context,options){if(!options){throw new _exception2["default"]("Must pass iterator to #each")}var fn=options.fn,inverse=options.inverse,i=0,ret="",data=undefined,contextPath=undefined;if(options.data&&options.ids){contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])+"."}if(_utils.isFunction(context)){context=context.call(this)}if(options.data){data=_utils.createFrame(options.data)}function execIteration(field,index,last){if(data){data.key=field;data.index=index;data.first=index===0;data.last=!!last;if(contextPath){data.contextPath=contextPath+field}}ret=ret+fn(context[field],{data:data,blockParams:_utils.blockParams([context[field],field],[contextPath+field,null])})}if(context&&typeof context==="object"){if(_utils.isArray(context)){for(var j=context.length;i<j;i++){if(i in context){execIteration(i,i,i===context.length-1)}}}else{var priorKey=undefined;for(var key in context){if(context.hasOwnProperty(key)){if(priorKey!==undefined){execIteration(priorKey,i-1)}priorKey=key;i++}}if(priorKey!==undefined){execIteration(priorKey,i-1,true)}}}if(i===0){ret=inverse(this)}return ret})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("helperMissing",function(){if(arguments.length===1){return undefined}else{throw new _exception2["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);exports["default"]=function(instance){instance.registerHelper("if",function(conditional,options){if(_utils.isFunction(conditional)){conditional=conditional.call(this)}if(!options.hash.includeZero&&!conditional||_utils.isEmpty(conditional)){return options.inverse(this)}else{return options.fn(this)}});instance.registerHelper("unless",function(conditional,options){return instance.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})})};module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=function(instance){instance.registerHelper("log",function(){var args=[undefined],options=arguments[arguments.length-1];for(var i=0;i<arguments.length-1;i++){args.push(arguments[i])}var level=1;if(options.hash.level!=null){level=options.hash.level}else if(options.data&&options.data.level!=null){level=options.data.level}args[0]=level;instance.log.apply(instance,args)})};module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=function(instance){instance.registerHelper("lookup",function(obj,field){return obj&&obj[field]})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);exports["default"]=function(instance){instance.registerHelper("with",function(context,options){if(_utils.isFunction(context)){context=context.call(this)}var fn=options.fn;if(!_utils.isEmpty(context)){var data=options.data;if(options.data&&options.ids){data=_utils.createFrame(options.data);data.contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])}return fn(context,{data:data,blockParams:_utils.blockParams([context],[data&&data.contextPath])})}else{return options.inverse(this)}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.registerDefaultDecorators=registerDefaultDecorators;var _decoratorsInline=__webpack_require__(19);var _decoratorsInline2=_interopRequireDefault(_decoratorsInline);function registerDefaultDecorators(instance){_decoratorsInline2["default"](instance)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);
exports["default"]=function(instance){instance.registerDecorator("inline",function(fn,props,container,options){var ret=fn;if(!props.partials){props.partials={};ret=function(context,options){var original=container.partials;container.partials=_utils.extend({},original,props.partials);var ret=fn(context,options);container.partials=original;return ret}}props.partials[options.args[0]]=options.fn;return ret})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);var logger={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function lookupLevel(level){if(typeof level==="string"){var levelMap=_utils.indexOf(logger.methodMap,level.toLowerCase());if(levelMap>=0){level=levelMap}else{level=parseInt(level,10)}}return level},log:function log(level){level=logger.lookupLevel(level);if(typeof console!=="undefined"&&logger.lookupLevel(logger.level)<=level){var method=logger.methodMap[level];if(!console[method]){method="log"}for(var _len=arguments.length,message=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){message[_key-1]=arguments[_key]}console[method].apply(console,message)}}};exports["default"]=logger;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;function SafeString(string){this.string=string}SafeString.prototype.toString=SafeString.prototype.toHTML=function(){return""+this.string};exports["default"]=SafeString;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _Object$seal=__webpack_require__(23)["default"];var _interopRequireWildcard=__webpack_require__(3)["default"];var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.checkRevision=checkRevision;exports.template=template;exports.wrapProgram=wrapProgram;exports.resolvePartial=resolvePartial;exports.invokePartial=invokePartial;exports.noop=noop;var _utils=__webpack_require__(5);var Utils=_interopRequireWildcard(_utils);var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);var _base=__webpack_require__(4);function checkRevision(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1,currentRevision=_base.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=_base.REVISION_CHANGES[currentRevision],compilerVersions=_base.REVISION_CHANGES[compilerRevision];throw new _exception2["default"]("Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}else{throw new _exception2["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+").")}}}function template(templateSpec,env){if(!env){throw new _exception2["default"]("No environment passed to template")}if(!templateSpec||!templateSpec.main){throw new _exception2["default"]("Unknown template object: "+typeof templateSpec)}templateSpec.main.decorator=templateSpec.main_d;env.VM.checkRevision(templateSpec.compiler);function invokePartialWrapper(partial,context,options){if(options.hash){context=Utils.extend({},context,options.hash);if(options.ids){options.ids[0]=true}}partial=env.VM.resolvePartial.call(this,partial,context,options);var result=env.VM.invokePartial.call(this,partial,context,options);if(result==null&&env.compile){options.partials[options.name]=env.compile(partial,templateSpec.compilerOptions,env);result=options.partials[options.name](context,options)}if(result!=null){if(options.indent){var lines=result.split("\n");for(var i=0,l=lines.length;i<l;i++){if(!lines[i]&&i+1===l){break}lines[i]=options.indent+lines[i]}result=lines.join("\n")}return result}else{throw new _exception2["default"]("The partial "+options.name+" could not be compiled when running in runtime-only mode")}}var container={strict:function strict(obj,name){if(!(name in obj)){throw new _exception2["default"]('"'+name+'" not defined in '+obj)}return obj[name]},lookup:function lookup(depths,name){var len=depths.length;for(var i=0;i<len;i++){if(depths[i]&&depths[i][name]!=null){return depths[i][name]}}},lambda:function lambda(current,context){return typeof current==="function"?current.call(context):current},escapeExpression:Utils.escapeExpression,invokePartial:invokePartialWrapper,fn:function fn(i){var ret=templateSpec[i];ret.decorator=templateSpec[i+"_d"];return ret},programs:[],program:function program(i,data,declaredBlockParams,blockParams,depths){var programWrapper=this.programs[i],fn=this.fn(i);if(data||depths||blockParams||declaredBlockParams){programWrapper=wrapProgram(this,i,fn,data,declaredBlockParams,blockParams,depths)}else if(!programWrapper){programWrapper=this.programs[i]=wrapProgram(this,i,fn)}return programWrapper},data:function data(value,depth){while(value&&depth--){value=value._parent}return value},merge:function merge(param,common){var obj=param||common;if(param&&common&&param!==common){obj=Utils.extend({},common,param)}return obj},nullContext:_Object$seal({}),noop:env.VM.noop,compilerInfo:templateSpec.compiler};function ret(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var data=options.data;ret._setup(options);if(!options.partial&&templateSpec.useData){data=initData(context,data)}var depths=undefined,blockParams=templateSpec.useBlockParams?[]:undefined;if(templateSpec.useDepths){if(options.depths){depths=context!=options.depths[0]?[context].concat(options.depths):options.depths}else{depths=[context]}}function main(context){return""+templateSpec.main(container,context,container.helpers,container.partials,data,blockParams,depths)}main=executeDecorators(templateSpec.main,main,container,options.depths||[],data,blockParams);return main(context,options)}ret.isTop=true;ret._setup=function(options){if(!options.partial){container.helpers=container.merge(options.helpers,env.helpers);if(templateSpec.usePartial){container.partials=container.merge(options.partials,env.partials)}if(templateSpec.usePartial||templateSpec.useDecorators){container.decorators=container.merge(options.decorators,env.decorators)}}else{container.helpers=options.helpers;container.partials=options.partials;container.decorators=options.decorators}};ret._child=function(i,data,blockParams,depths){if(templateSpec.useBlockParams&&!blockParams){throw new _exception2["default"]("must pass block params")}if(templateSpec.useDepths&&!depths){throw new _exception2["default"]("must pass parent depths")}return wrapProgram(container,i,templateSpec[i],data,0,blockParams,depths)};return ret}function wrapProgram(container,i,fn,data,declaredBlockParams,blockParams,depths){function prog(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var currentDepths=depths;if(depths&&context!=depths[0]&&!(context===container.nullContext&&depths[0]===null)){currentDepths=[context].concat(depths)}return fn(container,context,container.helpers,container.partials,options.data||data,blockParams&&[options.blockParams].concat(blockParams),currentDepths)}prog=executeDecorators(fn,prog,container,depths,data,blockParams);prog.program=i;prog.depth=depths?depths.length:0;prog.blockParams=declaredBlockParams||0;return prog}function resolvePartial(partial,context,options){if(!partial){if(options.name==="@partial-block"){partial=options.data["partial-block"]}else{partial=options.partials[options.name]}}else if(!partial.call&&!options.name){options.name=partial;partial=options.partials[partial]}return partial}function invokePartial(partial,context,options){var currentPartialBlock=options.data&&options.data["partial-block"];options.partial=true;if(options.ids){options.data.contextPath=options.ids[0]||options.data.contextPath}var partialBlock=undefined;if(options.fn&&options.fn!==noop){(function(){options.data=_base.createFrame(options.data);var fn=options.fn;partialBlock=options.data["partial-block"]=function partialBlockWrapper(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];options.data=_base.createFrame(options.data);options.data["partial-block"]=currentPartialBlock;return fn(context,options)};if(fn.partials){options.partials=Utils.extend({},options.partials,fn.partials)}})()}if(partial===undefined&&partialBlock){partial=partialBlock}if(partial===undefined){throw new _exception2["default"]("The partial "+options.name+" could not be found")}else if(partial instanceof Function){return partial(context,options)}}function noop(){return""}function initData(context,data){if(!data||!("root"in data)){data=data?_base.createFrame(data):{};data.root=context}return data}function executeDecorators(fn,prog,container,depths,data,blockParams){if(fn.decorator){var props={};prog=fn.decorator(prog,props,container,depths&&depths[0],data,blockParams,depths);Utils.extend(prog,props)}return prog}},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(24),__esModule:true}},function(module,exports,__webpack_require__){__webpack_require__(25);module.exports=__webpack_require__(30).Object.seal},function(module,exports,__webpack_require__){var isObject=__webpack_require__(26);__webpack_require__(27)("seal",function($seal){return function seal(it){return $seal&&isObject(it)?$seal(it):it}})},function(module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},function(module,exports,__webpack_require__){var $export=__webpack_require__(28),core=__webpack_require__(30),fails=__webpack_require__(33);module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn);$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},function(module,exports,__webpack_require__){var global=__webpack_require__(29),core=__webpack_require__(30),ctx=__webpack_require__(31),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,IS_WRAP=type&$export.W,exports=IS_GLOBAL?core:core[name]||(core[name]={}),target=IS_GLOBAL?global:IS_STATIC?global[name]:(global[name]||{})[PROTOTYPE],key,own,out;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&key in target;if(own&&key in exports)continue;out=own?target[key]:source[key];exports[key]=IS_GLOBAL&&typeof target[key]!="function"?source[key]:IS_BIND&&own?ctx(out,global):IS_WRAP&&target[key]==out?function(C){var F=function(param){return this instanceof C?new C(param):C(param)};F[PROTOTYPE]=C[PROTOTYPE];return F}(out):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(IS_PROTO)(exports[PROTOTYPE]||(exports[PROTOTYPE]={}))[key]=out}};$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;module.exports=$export},function(module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},function(module,exports){var core=module.exports={version:"1.2.6"};if(typeof __e=="number")__e=core},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(32);module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},function(module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},function(module,exports){(function(global){"use strict";exports.__esModule=true;exports["default"]=function(Handlebars){var root=typeof global!=="undefined"?global:window,$Handlebars=root.Handlebars;Handlebars.noConflict=function(){if(root.Handlebars===Handlebars){root.Handlebars=$Handlebars}return Handlebars}};module.exports=exports["default"]}).call(exports,function(){return this}())},function(module,exports){"use strict";exports.__esModule=true;var AST={helpers:{helperExpression:function helperExpression(node){return node.type==="SubExpression"||(node.type==="MustacheStatement"||node.type==="BlockStatement")&&!!(node.params&&node.params.length||node.hash)},scopedId:function scopedId(path){return/^\.|this\b/.test(path.original)},simpleId:function simpleId(path){return path.parts.length===1&&!AST.helpers.scopedId(path)&&!path.depth}}};exports["default"]=AST;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];var _interopRequireWildcard=__webpack_require__(3)["default"];exports.__esModule=true;exports.parse=parse;var _parser=__webpack_require__(37);var _parser2=_interopRequireDefault(_parser);var _whitespaceControl=__webpack_require__(38);var _whitespaceControl2=_interopRequireDefault(_whitespaceControl);var _helpers=__webpack_require__(40);var Helpers=_interopRequireWildcard(_helpers);var _utils=__webpack_require__(5);exports.parser=_parser2["default"];var yy={};_utils.extend(yy,Helpers);function parse(input,options){if(input.type==="Program"){return input}_parser2["default"].yy=yy;yy.locInfo=function(locInfo){return new yy.SourceLocation(options&&options.srcName,locInfo)};var strip=new _whitespaceControl2["default"](options);return strip.accept(_parser2["default"].parse(input))}},function(module,exports){"use strict";exports.__esModule=true;var handlebars=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=yy.prepareProgram($$[$0]);break;case 3:this.$=$$[$0];break;case 4:this.$=$$[$0];break;case 5:this.$=$$[$0];break;case 6:this.$=$$[$0];break;case 7:this.$=$$[$0];break;case 8:this.$=$$[$0];break;case 9:this.$={type:"CommentStatement",value:yy.stripComment($$[$0]),strip:yy.stripFlags($$[$0],$$[$0]),loc:yy.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:$$[$0],value:$$[$0],loc:yy.locInfo(this._$)};break;case 11:this.$=yy.prepareRawBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 12:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1]};break;case 13:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],false,this._$);break;case 14:this.$=yy.prepareBlock($$[$0-3],$$[$0-2],$$[$0-1],$$[$0],true,this._$);break;case 15:this.$={open:$$[$0-5],path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 16:this.$={path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 17:this.$={path:$$[$0-4],params:$$[$0-3],hash:$$[$0-2],blockParams:$$[$0-1],strip:yy.stripFlags($$[$0-5],$$[$0])};break;case 18:this.$={strip:yy.stripFlags($$[$0-1],$$[$0-1]),program:$$[$0]};break;case 19:var inverse=yy.prepareBlock($$[$0-2],$$[$0-1],$$[$0],$$[$0],false,this._$),program=yy.prepareProgram([inverse],$$[$0-1].loc);program.chained=true;this.$={strip:$$[$0-2].strip,program:program,chain:true};break;case 20:this.$=$$[$0];break;case 21:this.$={path:$$[$0-1],strip:yy.stripFlags($$[$0-2],$$[$0])};break;case 22:this.$=yy.prepareMustache($$[$0-3],$$[$0-2],$$[$0-1],$$[$0-4],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 23:this.$=yy.prepareMustache($$[$0-3],$$[$0-2],$$[$0-1],$$[$0-4],yy.stripFlags($$[$0-4],$$[$0]),this._$);break;case 24:this.$={type:"PartialStatement",name:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],indent:"",strip:yy.stripFlags($$[$0-4],$$[$0]),loc:yy.locInfo(this._$)};break;case 25:this.$=yy.preparePartialBlock($$[$0-2],$$[$0-1],$$[$0],this._$);break;case 26:this.$={path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],strip:yy.stripFlags($$[$0-4],$$[$0])};break;case 27:this.$=$$[$0];break;case 28:this.$=$$[$0];break;case 29:this.$={type:"SubExpression",path:$$[$0-3],params:$$[$0-2],hash:$$[$0-1],loc:yy.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:$$[$0],loc:yy.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:yy.id($$[$0-2]),value:$$[$0],loc:yy.locInfo(this._$)};break;case 32:this.$=yy.id($$[$0-1]);break;case 33:this.$=$$[$0];break;case 34:this.$=$$[$0];break;case 35:this.$={type:"StringLiteral",value:$$[$0],original:$$[$0],loc:yy.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number($$[$0]),original:Number($$[$0]),loc:yy.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:$$[$0]==="true",original:$$[$0]==="true",loc:yy.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:undefined,value:undefined,loc:yy.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:yy.locInfo(this._$)};break;case 40:this.$=$$[$0];break;case 41:this.$=$$[$0];break;case 42:this.$=yy.preparePath(true,$$[$0],this._$);break;case 43:this.$=yy.preparePath(false,$$[$0],this._$);break;case 44:$$[$0-2].push({part:yy.id($$[$0]),original:$$[$0],separator:$$[$0-1]});this.$=$$[$0-2];break;case 45:this.$=[{part:yy.id($$[$0]),original:$$[$0]}];break;case 46:this.$=[];break;case 47:$$[$0-1].push($$[$0]);break;case 48:this.$=[$$[$0]];break;case 49:$$[$0-1].push($$[$0]);break;case 50:this.$=[];break;case 51:$$[$0-1].push($$[$0]);break;case 58:this.$=[];break;case 59:$$[$0-1].push($$[$0]);break;case 64:this.$=[];break;case 65:$$[$0-1].push($$[$0]);break;case 70:this.$=[];break;case 71:$$[$0-1].push($$[$0]);break;case 78:this.$=[];break;case 79:$$[$0-1].push($$[$0]);break;case 82:this.$=[];break;case 83:$$[$0-1].push($$[$0]);break;case 86:this.$=[];break;case 87:$$[$0-1].push($$[$0]);break;case 90:this.$=[];break;case 91:$$[$0-1].push($$[$0]);break;case 94:this.$=[];break;case 95:$$[$0-1].push($$[$0]);break;case 98:this.$=[$$[$0]];break;case 99:$$[$0-1].push($$[$0]);break;case 100:this.$=[$$[$0]];break;case 101:$$[$0-1].push($$[$0]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function parseError(str,hash){throw new Error(str)
},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]}r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash)}else{throw new Error(str)}},setInput:function setInput(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges)this.yylloc.range=[0,0];this.offset=0;return this},input:function input(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges)this.yylloc.range[1]++;this._input=this._input.slice(1);return ch},unput:function unput(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len-1);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1)this.yylineno-=lines.length-1;var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len]}return this},more:function more(){this._more=true;return this},less:function less(n){this.unput(this.match.slice(n))},pastInput:function pastInput(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function upcomingInput(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function showPosition(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function next(){if(this.done){return this.EOF}if(!this._input)this.done=true;var token,match,tempMatch,index,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(!this.options.flex)break}}if(match){lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input)this.done=false;if(token)return token;else return}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function topState(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.options={};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){function strip(start,end){return yy_.yytext=yy_.yytext.substr(start,yy_.yyleng-end)}var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-2)==="\\\\"){strip(0,1);this.begin("mu")}else if(yy_.yytext.slice(-1)==="\\"){strip(0,1);this.begin("emu")}else{this.begin("mu")}if(yy_.yytext)return 15;break;case 1:return 15;break;case 2:this.popState();return 15;break;case 3:this.begin("raw");return 15;break;case 4:this.popState();if(this.conditionStack[this.conditionStack.length-1]==="raw"){return 15}else{yy_.yytext=yy_.yytext.substr(5,yy_.yyleng-9);return"END_RAW_BLOCK"}break;case 5:return 15;break;case 6:this.popState();return 14;break;case 7:return 65;break;case 8:return 68;break;case 9:return 19;break;case 10:this.popState();this.begin("raw");return 23;break;case 11:return 55;break;case 12:return 60;break;case 13:return 29;break;case 14:return 47;break;case 15:this.popState();return 44;break;case 16:this.popState();return 44;break;case 17:return 34;break;case 18:return 39;break;case 19:return 51;break;case 20:return 48;break;case 21:this.unput(yy_.yytext);this.popState();this.begin("com");break;case 22:this.popState();return 14;break;case 23:return 48;break;case 24:return 73;break;case 25:return 72;break;case 26:return 72;break;case 27:return 87;break;case 28:break;case 29:this.popState();return 54;break;case 30:this.popState();return 33;break;case 31:yy_.yytext=strip(1,2).replace(/\\"/g,'"');return 80;break;case 32:yy_.yytext=strip(1,2).replace(/\\'/g,"'");return 80;break;case 33:return 85;break;case 34:return 82;break;case 35:return 82;break;case 36:return 83;break;case 37:return 84;break;case 38:return 81;break;case 39:return 75;break;case 40:return 77;break;case 41:return 72;break;case 42:yy_.yytext=yy_.yytext.replace(/\\([\\\]])/g,"$1");return 72;break;case 43:return"INVALID";break;case 44:return 5;break}};lexer.rules=[/^(?:[^ ]*?(?=(\{\{)))/,/^(?:[^ ]+)/,/^(?:[^ ]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^ ]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/];lexer.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:false},emu:{rules:[2],inclusive:false},com:{rules:[6],inclusive:false},raw:{rules:[3,4,5],inclusive:false},INITIAL:{rules:[0,1,44],inclusive:true}};return lexer}();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();exports["default"]=handlebars;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _visitor=__webpack_require__(39);var _visitor2=_interopRequireDefault(_visitor);function WhitespaceControl(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.options=options}WhitespaceControl.prototype=new _visitor2["default"];WhitespaceControl.prototype.Program=function(program){var doStandalone=!this.options.ignoreStandalone;var isRoot=!this.isRootSeen;this.isRootSeen=true;var body=program.body;for(var i=0,l=body.length;i<l;i++){var current=body[i],strip=this.accept(current);if(!strip){continue}var _isPrevWhitespace=isPrevWhitespace(body,i,isRoot),_isNextWhitespace=isNextWhitespace(body,i,isRoot),openStandalone=strip.openStandalone&&_isPrevWhitespace,closeStandalone=strip.closeStandalone&&_isNextWhitespace,inlineStandalone=strip.inlineStandalone&&_isPrevWhitespace&&_isNextWhitespace;if(strip.close){omitRight(body,i,true)}if(strip.open){omitLeft(body,i,true)}if(doStandalone&&inlineStandalone){omitRight(body,i);if(omitLeft(body,i)){if(current.type==="PartialStatement"){current.indent=/([ \t]+$)/.exec(body[i-1].original)[1]}}}if(doStandalone&&openStandalone){omitRight((current.program||current.inverse).body);omitLeft(body,i)}if(doStandalone&&closeStandalone){omitRight(body,i);omitLeft((current.inverse||current.program).body)}}return program};WhitespaceControl.prototype.BlockStatement=WhitespaceControl.prototype.DecoratorBlock=WhitespaceControl.prototype.PartialBlockStatement=function(block){this.accept(block.program);this.accept(block.inverse);var program=block.program||block.inverse,inverse=block.program&&block.inverse,firstInverse=inverse,lastInverse=inverse;if(inverse&&inverse.chained){firstInverse=inverse.body[0].program;while(lastInverse.chained){lastInverse=lastInverse.body[lastInverse.body.length-1].program}}var strip={open:block.openStrip.open,close:block.closeStrip.close,openStandalone:isNextWhitespace(program.body),closeStandalone:isPrevWhitespace((firstInverse||program).body)};if(block.openStrip.close){omitRight(program.body,null,true)}if(inverse){var inverseStrip=block.inverseStrip;if(inverseStrip.open){omitLeft(program.body,null,true)}if(inverseStrip.close){omitRight(firstInverse.body,null,true)}if(block.closeStrip.open){omitLeft(lastInverse.body,null,true)}if(!this.options.ignoreStandalone&&isPrevWhitespace(program.body)&&isNextWhitespace(firstInverse.body)){omitLeft(program.body);omitRight(firstInverse.body)}}else if(block.closeStrip.open){omitLeft(program.body,null,true)}return strip};WhitespaceControl.prototype.Decorator=WhitespaceControl.prototype.MustacheStatement=function(mustache){return mustache.strip};WhitespaceControl.prototype.PartialStatement=WhitespaceControl.prototype.CommentStatement=function(node){var strip=node.strip||{};return{inlineStandalone:true,open:strip.open,close:strip.close}};function isPrevWhitespace(body,i,isRoot){if(i===undefined){i=body.length}var prev=body[i-1],sibling=body[i-2];if(!prev){return isRoot}if(prev.type==="ContentStatement"){return(sibling||!isRoot?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(prev.original)}}function isNextWhitespace(body,i,isRoot){if(i===undefined){i=-1}var next=body[i+1],sibling=body[i+2];if(!next){return isRoot}if(next.type==="ContentStatement"){return(sibling||!isRoot?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(next.original)}}function omitRight(body,i,multiple){var current=body[i==null?0:i+1];if(!current||current.type!=="ContentStatement"||!multiple&&current.rightStripped){return}var original=current.value;current.value=current.value.replace(multiple?/^\s+/:/^[ \t]*\r?\n?/,"");current.rightStripped=current.value!==original}function omitLeft(body,i,multiple){var current=body[i==null?body.length-1:i-1];if(!current||current.type!=="ContentStatement"||!multiple&&current.leftStripped){return}var original=current.value;current.value=current.value.replace(multiple?/\s+$/:/[ \t]+$/,"");current.leftStripped=current.value!==original;return current.leftStripped}exports["default"]=WhitespaceControl;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);function Visitor(){this.parents=[]}Visitor.prototype={constructor:Visitor,mutating:false,acceptKey:function acceptKey(node,name){var value=this.accept(node[name]);if(this.mutating){if(value&&!Visitor.prototype[value.type]){throw new _exception2["default"]('Unexpected node type "'+value.type+'" found when accepting '+name+" on "+node.type)}node[name]=value}},acceptRequired:function acceptRequired(node,name){this.acceptKey(node,name);if(!node[name]){throw new _exception2["default"](node.type+" requires "+name)}},acceptArray:function acceptArray(array){for(var i=0,l=array.length;i<l;i++){this.acceptKey(array,i);if(!array[i]){array.splice(i,1);i--;l--}}},accept:function accept(object){if(!object){return}if(!this[object.type]){throw new _exception2["default"]("Unknown type: "+object.type,object)}if(this.current){this.parents.unshift(this.current)}this.current=object;var ret=this[object.type](object);this.current=this.parents.shift();if(!this.mutating||ret){return ret}else if(ret!==false){return object}},Program:function Program(program){this.acceptArray(program.body)},MustacheStatement:visitSubExpression,Decorator:visitSubExpression,BlockStatement:visitBlock,DecoratorBlock:visitBlock,PartialStatement:visitPartial,PartialBlockStatement:function PartialBlockStatement(partial){visitPartial.call(this,partial);this.acceptKey(partial,"program")},ContentStatement:function ContentStatement(){},CommentStatement:function CommentStatement(){},SubExpression:visitSubExpression,PathExpression:function PathExpression(){},StringLiteral:function StringLiteral(){},NumberLiteral:function NumberLiteral(){},BooleanLiteral:function BooleanLiteral(){},UndefinedLiteral:function UndefinedLiteral(){},NullLiteral:function NullLiteral(){},Hash:function Hash(hash){this.acceptArray(hash.pairs)},HashPair:function HashPair(pair){this.acceptRequired(pair,"value")}};function visitSubExpression(mustache){this.acceptRequired(mustache,"path");this.acceptArray(mustache.params);this.acceptKey(mustache,"hash")}function visitBlock(block){visitSubExpression.call(this,block);this.acceptKey(block,"program");this.acceptKey(block,"inverse")}function visitPartial(partial){this.acceptRequired(partial,"name");this.acceptArray(partial.params);this.acceptKey(partial,"hash")}exports["default"]=Visitor;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.SourceLocation=SourceLocation;exports.id=id;exports.stripFlags=stripFlags;exports.stripComment=stripComment;exports.preparePath=preparePath;exports.prepareMustache=prepareMustache;exports.prepareRawBlock=prepareRawBlock;exports.prepareBlock=prepareBlock;exports.prepareProgram=prepareProgram;exports.preparePartialBlock=preparePartialBlock;var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);function validateClose(open,close){close=close.path?close.path.original:close;if(open.path.original!==close){var errorNode={loc:open.path.loc};throw new _exception2["default"](open.path.original+" doesn't match "+close,errorNode)}}function SourceLocation(source,locInfo){this.source=source;this.start={line:locInfo.first_line,column:locInfo.first_column};this.end={line:locInfo.last_line,column:locInfo.last_column}}function id(token){if(/^\[.*\]$/.test(token)){return token.substr(1,token.length-2)}else{return token}}function stripFlags(open,close){return{open:open.charAt(2)==="~",close:close.charAt(close.length-3)==="~"}}function stripComment(comment){return comment.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function preparePath(data,parts,loc){loc=this.locInfo(loc);var original=data?"@":"",dig=[],depth=0,depthString="";for(var i=0,l=parts.length;i<l;i++){var part=parts[i].part,isLiteral=parts[i].original!==part;original+=(parts[i].separator||"")+part;if(!isLiteral&&(part===".."||part==="."||part==="this")){if(dig.length>0){throw new _exception2["default"]("Invalid path: "+original,{loc:loc})}else if(part===".."){depth++;depthString+="../"}}else{dig.push(part)}}return{type:"PathExpression",data:data,depth:depth,parts:dig,original:original,loc:loc}}function prepareMustache(path,params,hash,open,strip,locInfo){var escapeFlag=open.charAt(3)||open.charAt(2),escaped=escapeFlag!=="{"&&escapeFlag!=="&";var decorator=/\*/.test(open);return{type:decorator?"Decorator":"MustacheStatement",path:path,params:params,hash:hash,escaped:escaped,strip:strip,loc:this.locInfo(locInfo)}}function prepareRawBlock(openRawBlock,contents,close,locInfo){validateClose(openRawBlock,close);locInfo=this.locInfo(locInfo);var program={type:"Program",body:contents,strip:{},loc:locInfo};return{type:"BlockStatement",path:openRawBlock.path,params:openRawBlock.params,hash:openRawBlock.hash,program:program,openStrip:{},inverseStrip:{},closeStrip:{},loc:locInfo}}function prepareBlock(openBlock,program,inverseAndProgram,close,inverted,locInfo){if(close&&close.path){validateClose(openBlock,close)}var decorator=/\*/.test(openBlock.open);program.blockParams=openBlock.blockParams;var inverse=undefined,inverseStrip=undefined;if(inverseAndProgram){if(decorator){throw new _exception2["default"]("Unexpected inverse block on decorator",inverseAndProgram)}if(inverseAndProgram.chain){inverseAndProgram.program.body[0].closeStrip=close.strip}inverseStrip=inverseAndProgram.strip;inverse=inverseAndProgram.program}if(inverted){inverted=inverse;inverse=program;program=inverted}return{type:decorator?"DecoratorBlock":"BlockStatement",path:openBlock.path,params:openBlock.params,hash:openBlock.hash,program:program,inverse:inverse,openStrip:openBlock.strip,inverseStrip:inverseStrip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}}function prepareProgram(statements,loc){if(!loc&&statements.length){var firstLoc=statements[0].loc,lastLoc=statements[statements.length-1].loc;if(firstLoc&&lastLoc){loc={source:firstLoc.source,start:{line:firstLoc.start.line,column:firstLoc.start.column},end:{line:lastLoc.end.line,column:lastLoc.end.column}}}}return{type:"Program",body:statements,strip:{},loc:loc}}function preparePartialBlock(open,program,close,locInfo){validateClose(open,close);return{type:"PartialBlockStatement",name:open.path,params:open.params,hash:open.hash,program:program,openStrip:open.strip,closeStrip:close&&close.strip,loc:this.locInfo(locInfo)}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;exports.Compiler=Compiler;exports.precompile=precompile;exports.compile=compile;var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);var _utils=__webpack_require__(5);var _ast=__webpack_require__(35);var _ast2=_interopRequireDefault(_ast);var slice=[].slice;function Compiler(){}Compiler.prototype={compiler:Compiler,equals:function equals(other){var len=this.opcodes.length;if(other.opcodes.length!==len){return false}for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||!argEquals(opcode.args,otherOpcode.args)){return false}}len=this.children.length;for(var i=0;i<len;i++){if(!this.children[i].equals(other.children[i])){return false}}return true},guid:0,compile:function compile(program,options){this.sourceNode=[];this.opcodes=[];this.children=[];this.options=options;this.stringParams=options.stringParams;this.trackIds=options.trackIds;options.blockParams=options.blockParams||[];var knownHelpers=options.knownHelpers;options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true,lookup:true};if(knownHelpers){for(var _name in knownHelpers){if(_name in knownHelpers){this.options.knownHelpers[_name]=knownHelpers[_name]}}}return this.accept(program)},compileProgram:function compileProgram(program){var childCompiler=new this.compiler,result=childCompiler.compile(program,this.options),guid=this.guid++;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;this.useDepths=this.useDepths||result.useDepths;return guid},accept:function accept(node){if(!this[node.type]){throw new _exception2["default"]("Unknown type: "+node.type,node)}this.sourceNode.unshift(node);var ret=this[node.type](node);this.sourceNode.shift();return ret},Program:function Program(program){this.options.blockParams.unshift(program.blockParams);var body=program.body,bodyLength=body.length;for(var i=0;i<bodyLength;i++){this.accept(body[i])}this.options.blockParams.shift();this.isSimple=bodyLength===1;this.blockParams=program.blockParams?program.blockParams.length:0;return this},BlockStatement:function BlockStatement(block){transformLiteralToPath(block);var program=block.program,inverse=block.inverse;program=program&&this.compileProgram(program);inverse=inverse&&this.compileProgram(inverse);var type=this.classifySexpr(block);if(type==="helper"){this.helperSexpr(block,program,inverse)}else if(type==="simple"){this.simpleSexpr(block);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("emptyHash");this.opcode("blockValue",block.path.original)}else{this.ambiguousSexpr(block,program,inverse);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);this.opcode("emptyHash");this.opcode("ambiguousBlockValue")}this.opcode("append")},DecoratorBlock:function DecoratorBlock(decorator){var program=decorator.program&&this.compileProgram(decorator.program);var params=this.setupFullMustacheParams(decorator,program,undefined),path=decorator.path;this.useDecorators=true;this.opcode("registerDecorator",params.length,path.original)},PartialStatement:function PartialStatement(partial){this.usePartial=true;var program=partial.program;if(program){program=this.compileProgram(partial.program)}var params=partial.params;if(params.length>1){throw new _exception2["default"]("Unsupported number of partial arguments: "+params.length,partial)}else if(!params.length){if(this.options.explicitPartialContext){this.opcode("pushLiteral","undefined")}else{params.push({type:"PathExpression",parts:[],depth:0})}}var partialName=partial.name.original,isDynamic=partial.name.type==="SubExpression";if(isDynamic){this.accept(partial.name)}this.setupFullMustacheParams(partial,program,undefined,true);var indent=partial.indent||"";if(this.options.preventIndent&&indent){this.opcode("appendContent",indent);indent=""}this.opcode("invokePartial",isDynamic,partialName,indent);this.opcode("append")},PartialBlockStatement:function PartialBlockStatement(partialBlock){this.PartialStatement(partialBlock)},MustacheStatement:function MustacheStatement(mustache){this.SubExpression(mustache);if(mustache.escaped&&!this.options.noEscape){this.opcode("appendEscaped")}else{this.opcode("append")}},Decorator:function Decorator(decorator){this.DecoratorBlock(decorator)},ContentStatement:function ContentStatement(content){if(content.value){this.opcode("appendContent",content.value)}},CommentStatement:function CommentStatement(){},SubExpression:function SubExpression(sexpr){transformLiteralToPath(sexpr);var type=this.classifySexpr(sexpr);if(type==="simple"){this.simpleSexpr(sexpr)}else if(type==="helper"){this.helperSexpr(sexpr)}else{this.ambiguousSexpr(sexpr)}},ambiguousSexpr:function ambiguousSexpr(sexpr,program,inverse){var path=sexpr.path,name=path.parts[0],isBlock=program!=null||inverse!=null;this.opcode("getContext",path.depth);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);path.strict=true;this.accept(path);this.opcode("invokeAmbiguous",name,isBlock)},simpleSexpr:function simpleSexpr(sexpr){var path=sexpr.path;path.strict=true;this.accept(path);this.opcode("resolvePossibleLambda")},helperSexpr:function helperSexpr(sexpr,program,inverse){var params=this.setupFullMustacheParams(sexpr,program,inverse),path=sexpr.path,name=path.parts[0];if(this.options.knownHelpers[name]){this.opcode("invokeKnownHelper",params.length,name)}else if(this.options.knownHelpersOnly){throw new _exception2["default"]("You specified knownHelpersOnly, but used the unknown helper "+name,sexpr)}else{path.strict=true;path.falsy=true;this.accept(path);this.opcode("invokeHelper",params.length,path.original,_ast2["default"].helpers.simpleId(path))}},PathExpression:function PathExpression(path){this.addDepth(path.depth);this.opcode("getContext",path.depth);var name=path.parts[0],scoped=_ast2["default"].helpers.scopedId(path),blockParamId=!path.depth&&!scoped&&this.blockParamIndex(name);if(blockParamId){this.opcode("lookupBlockParam",blockParamId,path.parts)}else if(!name){this.opcode("pushContext")}else if(path.data){this.options.data=true;this.opcode("lookupData",path.depth,path.parts,path.strict)}else{this.opcode("lookupOnContext",path.parts,path.falsy,path.strict,scoped)}},StringLiteral:function StringLiteral(string){this.opcode("pushString",string.value)},NumberLiteral:function NumberLiteral(number){this.opcode("pushLiteral",number.value)},BooleanLiteral:function BooleanLiteral(bool){this.opcode("pushLiteral",bool.value)},UndefinedLiteral:function UndefinedLiteral(){this.opcode("pushLiteral","undefined")},NullLiteral:function NullLiteral(){this.opcode("pushLiteral","null")},Hash:function Hash(hash){var pairs=hash.pairs,i=0,l=pairs.length;this.opcode("pushHash");for(;i<l;i++){this.pushParam(pairs[i].value)}while(i--){this.opcode("assignToHash",pairs[i].key)}this.opcode("popHash")},opcode:function opcode(name){this.opcodes.push({opcode:name,args:slice.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function addDepth(depth){if(!depth){return}this.useDepths=true},classifySexpr:function classifySexpr(sexpr){var isSimple=_ast2["default"].helpers.simpleId(sexpr.path);var isBlockParam=isSimple&&!!this.blockParamIndex(sexpr.path.parts[0]);var isHelper=!isBlockParam&&_ast2["default"].helpers.helperExpression(sexpr);var isEligible=!isBlockParam&&(isHelper||isSimple);if(isEligible&&!isHelper){var _name2=sexpr.path.parts[0],options=this.options;if(options.knownHelpers[_name2]){isHelper=true}else if(options.knownHelpersOnly){isEligible=false}}if(isHelper){return"helper"}else if(isEligible){return"ambiguous"}else{return"simple"}},pushParams:function pushParams(params){for(var i=0,l=params.length;i<l;i++){this.pushParam(params[i])}},pushParam:function pushParam(val){var value=val.value!=null?val.value:val.original||"";if(this.stringParams){if(value.replace){value=value.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")}if(val.depth){this.addDepth(val.depth)}this.opcode("getContext",val.depth||0);this.opcode("pushStringParam",value,val.type);if(val.type==="SubExpression"){this.accept(val)}}else{if(this.trackIds){var blockParamIndex=undefined;if(val.parts&&!_ast2["default"].helpers.scopedId(val)&&!val.depth){blockParamIndex=this.blockParamIndex(val.parts[0])}if(blockParamIndex){var blockParamChild=val.parts.slice(1).join(".");this.opcode("pushId","BlockParam",blockParamIndex,blockParamChild)}else{value=val.original||value;if(value.replace){value=value.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")}this.opcode("pushId",val.type,value)}}this.accept(val)}},setupFullMustacheParams:function setupFullMustacheParams(sexpr,program,inverse,omitEmpty){var params=sexpr.params;this.pushParams(params);this.opcode("pushProgram",program);this.opcode("pushProgram",inverse);if(sexpr.hash){this.accept(sexpr.hash)}else{this.opcode("emptyHash",omitEmpty)}return params},blockParamIndex:function blockParamIndex(name){for(var depth=0,len=this.options.blockParams.length;depth<len;depth++){var blockParams=this.options.blockParams[depth],param=blockParams&&_utils.indexOf(blockParams,name);if(blockParams&&param>=0){return[depth,param]}}}};function precompile(input,options,env){if(input==null||typeof input!=="string"&&input.type!=="Program"){throw new _exception2["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+input)}options=options||{};if(!("data"in options)){options.data=true}if(options.compat){options.useDepths=true}var ast=env.parse(input,options),environment=(new env.Compiler).compile(ast,options);return(new env.JavaScriptCompiler).compile(environment,options)}function compile(input,options,env){if(options===undefined)options={};if(input==null||typeof input!=="string"&&input.type!=="Program"){throw new _exception2["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input)}options=_utils.extend({},options);if(!("data"in options)){options.data=true}if(options.compat){options.useDepths=true}var compiled=undefined;function compileInput(){var ast=env.parse(input,options),environment=(new env.Compiler).compile(ast,options),templateSpec=(new env.JavaScriptCompiler).compile(environment,options,undefined,true);return env.template(templateSpec)}function ret(context,execOptions){if(!compiled){compiled=compileInput()}return compiled.call(this,context,execOptions)}ret._setup=function(setupOptions){if(!compiled){compiled=compileInput()}return compiled._setup(setupOptions)};ret._child=function(i,data,blockParams,depths){if(!compiled){compiled=compileInput()
}return compiled._child(i,data,blockParams,depths)};return ret}function argEquals(a,b){if(a===b){return true}if(_utils.isArray(a)&&_utils.isArray(b)&&a.length===b.length){for(var i=0;i<a.length;i++){if(!argEquals(a[i],b[i])){return false}}return true}}function transformLiteralToPath(sexpr){if(!sexpr.path.parts){var literal=sexpr.path;sexpr.path={type:"PathExpression",data:false,depth:0,parts:[literal.original+""],original:literal.original+"",loc:literal.loc}}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(1)["default"];exports.__esModule=true;var _base=__webpack_require__(4);var _exception=__webpack_require__(6);var _exception2=_interopRequireDefault(_exception);var _utils=__webpack_require__(5);var _codeGen=__webpack_require__(43);var _codeGen2=_interopRequireDefault(_codeGen);function Literal(value){this.value=value}function JavaScriptCompiler(){}JavaScriptCompiler.prototype={nameLookup:function nameLookup(parent,name){if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return[parent,".",name]}else{return[parent,"[",JSON.stringify(name),"]"]}},depthedLookup:function depthedLookup(name){return[this.aliasable("container.lookup"),'(depths, "',name,'")']},compilerInfo:function compilerInfo(){var revision=_base.COMPILER_REVISION,versions=_base.REVISION_CHANGES[revision];return[revision,versions]},appendToBuffer:function appendToBuffer(source,location,explicit){if(!_utils.isArray(source)){source=[source]}source=this.source.wrap(source,location);if(this.environment.isSimple){return["return ",source,";"]}else if(explicit){return["buffer += ",source,";"]}else{source.appendToBuffer=true;return source}},initializeBuffer:function initializeBuffer(){return this.quotedString("")},compile:function compile(environment,options,context,asObject){this.environment=environment;this.options=options;this.stringParams=this.options.stringParams;this.trackIds=this.options.trackIds;this.precompile=!asObject;this.name=this.environment.name;this.isChild=!!context;this.context=context||{decorators:[],programs:[],environments:[]};this.preamble();this.stackSlot=0;this.stackVars=[];this.aliases={};this.registers={list:[]};this.hashes=[];this.compileStack=[];this.inlineStack=[];this.blockParams=[];this.compileChildren(environment,options);this.useDepths=this.useDepths||environment.useDepths||environment.useDecorators||this.options.compat;this.useBlockParams=this.useBlockParams||environment.useBlockParams;var opcodes=environment.opcodes,opcode=undefined,firstLoc=undefined,i=undefined,l=undefined;for(i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];this.source.currentLocation=opcode.loc;firstLoc=firstLoc||opcode.loc;this[opcode.opcode].apply(this,opcode.args)}this.source.currentLocation=firstLoc;this.pushSource("");if(this.stackSlot||this.inlineStack.length||this.compileStack.length){throw new _exception2["default"]("Compile completed with content left on stack")}if(!this.decorators.isEmpty()){this.useDecorators=true;this.decorators.prepend("var decorators = container.decorators;\n");this.decorators.push("return fn;");if(asObject){this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()])}else{this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n");this.decorators.push("}\n");this.decorators=this.decorators.merge()}}else{this.decorators=undefined}var fn=this.createFunctionContext(asObject);if(!this.isChild){var ret={compiler:this.compilerInfo(),main:fn};if(this.decorators){ret.main_d=this.decorators;ret.useDecorators=true}var _context=this.context;var programs=_context.programs;var decorators=_context.decorators;for(i=0,l=programs.length;i<l;i++){if(programs[i]){ret[i]=programs[i];if(decorators[i]){ret[i+"_d"]=decorators[i];ret.useDecorators=true}}}if(this.environment.usePartial){ret.usePartial=true}if(this.options.data){ret.useData=true}if(this.useDepths){ret.useDepths=true}if(this.useBlockParams){ret.useBlockParams=true}if(this.options.compat){ret.compat=true}if(!asObject){ret.compiler=JSON.stringify(ret.compiler);this.source.currentLocation={start:{line:1,column:0}};ret=this.objectLiteral(ret);if(options.srcName){ret=ret.toStringWithSourceMap({file:options.destName});ret.map=ret.map&&ret.map.toString()}else{ret=ret.toString()}}else{ret.compilerOptions=this.options}return ret}else{return fn}},preamble:function preamble(){this.lastContext=0;this.source=new _codeGen2["default"](this.options.srcName);this.decorators=new _codeGen2["default"](this.options.srcName)},createFunctionContext:function createFunctionContext(asObject){var varDeclarations="";var locals=this.stackVars.concat(this.registers.list);if(locals.length>0){varDeclarations+=", "+locals.join(", ")}var aliasCount=0;for(var alias in this.aliases){var node=this.aliases[alias];if(this.aliases.hasOwnProperty(alias)&&node.children&&node.referenceCount>1){varDeclarations+=", alias"+ ++aliasCount+"="+alias;node.children[0]="alias"+aliasCount}}var params=["container","depth0","helpers","partials","data"];if(this.useBlockParams||this.useDepths){params.push("blockParams")}if(this.useDepths){params.push("depths")}var source=this.mergeSource(varDeclarations);if(asObject){params.push(source);return Function.apply(this,params)}else{return this.source.wrap(["function(",params.join(","),") {\n  ",source,"}"])}},mergeSource:function mergeSource(varDeclarations){var isSimple=this.environment.isSimple,appendOnly=!this.forceBuffer,appendFirst=undefined,sourceSeen=undefined,bufferStart=undefined,bufferEnd=undefined;this.source.each(function(line){if(line.appendToBuffer){if(bufferStart){line.prepend("  + ")}else{bufferStart=line}bufferEnd=line}else{if(bufferStart){if(!sourceSeen){appendFirst=true}else{bufferStart.prepend("buffer += ")}bufferEnd.add(";");bufferStart=bufferEnd=undefined}sourceSeen=true;if(!isSimple){appendOnly=false}}});if(appendOnly){if(bufferStart){bufferStart.prepend("return ");bufferEnd.add(";")}else if(!sourceSeen){this.source.push('return "";')}}else{varDeclarations+=", buffer = "+(appendFirst?"":this.initializeBuffer());if(bufferStart){bufferStart.prepend("return buffer + ");bufferEnd.add(";")}else{this.source.push("return buffer;")}}if(varDeclarations){this.source.prepend("var "+varDeclarations.substring(2)+(appendFirst?"":";\n"))}return this.source.merge()},blockValue:function blockValue(name){var blockHelperMissing=this.aliasable("helpers.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs(name,0,params);var blockName=this.popStack();params.splice(1,0,blockName);this.push(this.source.functionCall(blockHelperMissing,"call",params))},ambiguousBlockValue:function ambiguousBlockValue(){var blockHelperMissing=this.aliasable("helpers.blockHelperMissing"),params=[this.contextName(0)];this.setupHelperArgs("",0,params,true);this.flushInline();var current=this.topStack();params.splice(1,0,current);this.pushSource(["if (!",this.lastHelper,") { ",current," = ",this.source.functionCall(blockHelperMissing,"call",params),"}"])},appendContent:function appendContent(content){if(this.pendingContent){content=this.pendingContent+content}else{this.pendingLocation=this.source.currentLocation}this.pendingContent=content},append:function append(){if(this.isInline()){this.replaceStack(function(current){return[" != null ? ",current,' : ""']});this.pushSource(this.appendToBuffer(this.popStack()))}else{var local=this.popStack();this.pushSource(["if (",local," != null) { ",this.appendToBuffer(local,undefined,true)," }"]);if(this.environment.isSimple){this.pushSource(["else { ",this.appendToBuffer("''",undefined,true)," }"])}}},appendEscaped:function appendEscaped(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function getContext(depth){this.lastContext=depth},pushContext:function pushContext(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function lookupOnContext(parts,falsy,strict,scoped){var i=0;if(!scoped&&this.options.compat&&!this.lastContext){this.push(this.depthedLookup(parts[i++]))}else{this.pushContext()}this.resolvePath("context",parts,i,falsy,strict)},lookupBlockParam:function lookupBlockParam(blockParamId,parts){this.useBlockParams=true;this.push(["blockParams[",blockParamId[0],"][",blockParamId[1],"]"]);this.resolvePath("context",parts,1)},lookupData:function lookupData(depth,parts,strict){if(!depth){this.pushStackLiteral("data")}else{this.pushStackLiteral("container.data(data, "+depth+")")}this.resolvePath("data",parts,0,true,strict)},resolvePath:function resolvePath(type,parts,i,falsy,strict){var _this=this;if(this.options.strict||this.options.assumeObjects){this.push(strictLookup(this.options.strict&&strict,this,parts,type));return}var len=parts.length;for(;i<len;i++){this.replaceStack(function(current){var lookup=_this.nameLookup(current,parts[i],type);if(!falsy){return[" != null ? ",lookup," : ",current]}else{return[" && ",lookup]}})}},resolvePossibleLambda:function resolvePossibleLambda(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function pushStringParam(string,type){this.pushContext();this.pushString(type);if(type!=="SubExpression"){if(typeof string==="string"){this.pushString(string)}else{this.pushStackLiteral(string)}}},emptyHash:function emptyHash(omitEmpty){if(this.trackIds){this.push("{}")}if(this.stringParams){this.push("{}");this.push("{}")}this.pushStackLiteral(omitEmpty?"undefined":"{}")},pushHash:function pushHash(){if(this.hash){this.hashes.push(this.hash)}this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function popHash(){var hash=this.hash;this.hash=this.hashes.pop();if(this.trackIds){this.push(this.objectLiteral(hash.ids))}if(this.stringParams){this.push(this.objectLiteral(hash.contexts));this.push(this.objectLiteral(hash.types))}this.push(this.objectLiteral(hash.values))},pushString:function pushString(string){this.pushStackLiteral(this.quotedString(string))},pushLiteral:function pushLiteral(value){this.pushStackLiteral(value)},pushProgram:function pushProgram(guid){if(guid!=null){this.pushStackLiteral(this.programExpression(guid))}else{this.pushStackLiteral(null)}},registerDecorator:function registerDecorator(paramSize,name){var foundDecorator=this.nameLookup("decorators",name,"decorator"),options=this.setupHelperArgs(name,paramSize);this.decorators.push(["fn = ",this.decorators.functionCall(foundDecorator,"",["fn","props","container",options])," || fn;"])},invokeHelper:function invokeHelper(paramSize,name,isSimple){var nonHelper=this.popStack(),helper=this.setupHelper(paramSize,name),simple=isSimple?[helper.name," || "]:"";var lookup=["("].concat(simple,nonHelper);if(!this.options.strict){lookup.push(" || ",this.aliasable("helpers.helperMissing"))}lookup.push(")");this.push(this.source.functionCall(lookup,"call",helper.callParams))},invokeKnownHelper:function invokeKnownHelper(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(this.source.functionCall(helper.name,"call",helper.callParams))},invokeAmbiguous:function invokeAmbiguous(name,helperCall){this.useRegister("helper");var nonHelper=this.popStack();this.emptyHash();var helper=this.setupHelper(0,name,helperCall);var helperName=this.lastHelper=this.nameLookup("helpers",name,"helper");var lookup=["(","(helper = ",helperName," || ",nonHelper,")"];if(!this.options.strict){lookup[0]="(helper = ";lookup.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))}this.push(["(",lookup,helper.paramsInit?["),(",helper.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",helper.callParams)," : helper))"])},invokePartial:function invokePartial(isDynamic,name,indent){var params=[],options=this.setupParams(name,1,params);if(isDynamic){name=this.popStack();delete options.name}if(indent){options.indent=JSON.stringify(indent)}options.helpers="helpers";options.partials="partials";options.decorators="container.decorators";if(!isDynamic){params.unshift(this.nameLookup("partials",name,"partial"))}else{params.unshift(name)}if(this.options.compat){options.depths="depths"}options=this.objectLiteral(options);params.push(options);this.push(this.source.functionCall("container.invokePartial","",params))},assignToHash:function assignToHash(key){var value=this.popStack(),context=undefined,type=undefined,id=undefined;if(this.trackIds){id=this.popStack()}if(this.stringParams){type=this.popStack();context=this.popStack()}var hash=this.hash;if(context){hash.contexts[key]=context}if(type){hash.types[key]=type}if(id){hash.ids[key]=id}hash.values[key]=value},pushId:function pushId(type,name,child){if(type==="BlockParam"){this.pushStackLiteral("blockParams["+name[0]+"].path["+name[1]+"]"+(child?" + "+JSON.stringify("."+child):""))}else if(type==="PathExpression"){this.pushString(name)}else if(type==="SubExpression"){this.pushStackLiteral("true")}else{this.pushStackLiteral("null")}},compiler:JavaScriptCompiler,compileChildren:function compileChildren(environment,options){var children=environment.children,child=undefined,compiler=undefined;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler;var existing=this.matchExistingProgram(child);if(existing==null){this.context.programs.push("");var index=this.context.programs.length;child.index=index;child.name="program"+index;this.context.programs[index]=compiler.compile(child,options,this.context,!this.precompile);this.context.decorators[index]=compiler.decorators;this.context.environments[index]=child;this.useDepths=this.useDepths||compiler.useDepths;this.useBlockParams=this.useBlockParams||compiler.useBlockParams;child.useDepths=this.useDepths;child.useBlockParams=this.useBlockParams}else{child.index=existing.index;child.name="program"+existing.index;this.useDepths=this.useDepths||existing.useDepths;this.useBlockParams=this.useBlockParams||existing.useBlockParams}}},matchExistingProgram:function matchExistingProgram(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child)){return environment}}},programExpression:function programExpression(guid){var child=this.environment.children[guid],programParams=[child.index,"data",child.blockParams];if(this.useBlockParams||this.useDepths){programParams.push("blockParams")}if(this.useDepths){programParams.push("depths")}return"container.program("+programParams.join(", ")+")"},useRegister:function useRegister(name){if(!this.registers[name]){this.registers[name]=true;this.registers.list.push(name)}},push:function push(expr){if(!(expr instanceof Literal)){expr=this.source.wrap(expr)}this.inlineStack.push(expr);return expr},pushStackLiteral:function pushStackLiteral(item){this.push(new Literal(item))},pushSource:function pushSource(source){if(this.pendingContent){this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation));this.pendingContent=undefined}if(source){this.source.push(source)}},replaceStack:function replaceStack(callback){var prefix=["("],stack=undefined,createdStack=undefined,usedLiteral=undefined;if(!this.isInline()){throw new _exception2["default"]("replaceStack on non-inline")}var top=this.popStack(true);if(top instanceof Literal){stack=[top.value];prefix=["(",stack];usedLiteral=true}else{createdStack=true;var _name=this.incrStack();prefix=["((",this.push(_name)," = ",top,")"];stack=this.topStack()}var item=callback.call(this,stack);if(!usedLiteral){this.popStack()}if(createdStack){this.stackSlot--}this.push(prefix.concat(item,")"))},incrStack:function incrStack(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return this.topStackName()},topStackName:function topStackName(){return"stack"+this.stackSlot},flushInline:function flushInline(){var inlineStack=this.inlineStack;this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal){this.compileStack.push(entry)}else{var stack=this.incrStack();this.pushSource([stack," = ",entry,";"]);this.compileStack.push(stack)}}},isInline:function isInline(){return this.inlineStack.length},popStack:function popStack(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&item instanceof Literal){return item.value}else{if(!inline){if(!this.stackSlot){throw new _exception2["default"]("Invalid stack pop")}this.stackSlot--}return item}},topStack:function topStack(){var stack=this.isInline()?this.inlineStack:this.compileStack,item=stack[stack.length-1];if(item instanceof Literal){return item.value}else{return item}},contextName:function contextName(context){if(this.useDepths&&context){return"depths["+context+"]"}else{return"depth"+context}},quotedString:function quotedString(str){return this.source.quotedString(str)},objectLiteral:function objectLiteral(obj){return this.source.objectLiteral(obj)},aliasable:function aliasable(name){var ret=this.aliases[name];if(ret){ret.referenceCount++;return ret}ret=this.aliases[name]=this.source.wrap(name);ret.aliasable=true;ret.referenceCount=1;return ret},setupHelper:function setupHelper(paramSize,name,blockHelper){var params=[],paramsInit=this.setupHelperArgs(name,paramSize,params,blockHelper);var foundHelper=this.nameLookup("helpers",name,"helper"),callContext=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:params,paramsInit:paramsInit,name:foundHelper,callParams:[callContext].concat(params)}},setupParams:function setupParams(helper,paramSize,params){var options={},contexts=[],types=[],ids=[],objectArgs=!params,param=undefined;if(objectArgs){params=[]}options.name=this.quotedString(helper);options.hash=this.popStack();if(this.trackIds){options.hashIds=this.popStack()}if(this.stringParams){options.hashTypes=this.popStack();options.hashContexts=this.popStack()}var inverse=this.popStack(),program=this.popStack();if(program||inverse){options.fn=program||"container.noop";options.inverse=inverse||"container.noop"}var i=paramSize;while(i--){param=this.popStack();params[i]=param;if(this.trackIds){ids[i]=this.popStack()}if(this.stringParams){types[i]=this.popStack();contexts[i]=this.popStack()}}if(objectArgs){options.args=this.source.generateArray(params)}if(this.trackIds){options.ids=this.source.generateArray(ids)}if(this.stringParams){options.types=this.source.generateArray(types);options.contexts=this.source.generateArray(contexts)}if(this.options.data){options.data="data"}if(this.useBlockParams){options.blockParams="blockParams"}return options},setupHelperArgs:function setupHelperArgs(helper,paramSize,params,useRegister){var options=this.setupParams(helper,paramSize,params);options=this.objectLiteral(options);if(useRegister){this.useRegister("options");params.push("options");return["options=",options]}else if(params){params.push(options);return""}else{return options}}};(function(){var reservedWords=("break else new var"+" case finally return void"+" catch for switch while"+" continue function this with"+" default if throw"+" delete in try"+" do instanceof typeof"+" abstract enum int short"+" boolean export interface static"+" byte extends long super"+" char final native synchronized"+" class float package throws"+" const goto private transient"+" debugger implements protected volatile"+" double import public let yield await"+" null true false").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true}})();JavaScriptCompiler.isValidJavaScriptVariableName=function(name){return!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name)};function strictLookup(requireTerminal,compiler,parts,type){var stack=compiler.popStack(),i=0,len=parts.length;if(requireTerminal){len--}for(;i<len;i++){stack=compiler.nameLookup(stack,parts[i],type)}if(requireTerminal){return[compiler.aliasable("container.strict"),"(",stack,", ",compiler.quotedString(parts[i]),")"]}else{return stack}}exports["default"]=JavaScriptCompiler;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(5);var SourceNode=undefined;try{if(false){var SourceMap=require("source-map");SourceNode=SourceMap.SourceNode}}catch(err){}if(!SourceNode){SourceNode=function(line,column,srcFile,chunks){this.src="";if(chunks){this.add(chunks)}};SourceNode.prototype={add:function add(chunks){if(_utils.isArray(chunks)){chunks=chunks.join("")}this.src+=chunks},prepend:function prepend(chunks){if(_utils.isArray(chunks)){chunks=chunks.join("")}this.src=chunks+this.src},toStringWithSourceMap:function toStringWithSourceMap(){return{code:this.toString()}},toString:function toString(){return this.src}}}function castChunk(chunk,codeGen,loc){if(_utils.isArray(chunk)){var ret=[];for(var i=0,len=chunk.length;i<len;i++){ret.push(codeGen.wrap(chunk[i],loc))}return ret}else if(typeof chunk==="boolean"||typeof chunk==="number"){return chunk+""}return chunk}function CodeGen(srcFile){this.srcFile=srcFile;this.source=[]}CodeGen.prototype={isEmpty:function isEmpty(){return!this.source.length},prepend:function prepend(source,loc){this.source.unshift(this.wrap(source,loc))},push:function push(source,loc){this.source.push(this.wrap(source,loc))},merge:function merge(){var source=this.empty();this.each(function(line){source.add(["  ",line,"\n"])});return source},each:function each(iter){for(var i=0,len=this.source.length;i<len;i++){iter(this.source[i])}},empty:function empty(){var loc=this.currentLocation||{start:{}};return new SourceNode(loc.start.line,loc.start.column,this.srcFile)},wrap:function wrap(chunk){var loc=arguments.length<=1||arguments[1]===undefined?this.currentLocation||{start:{}}:arguments[1];if(chunk instanceof SourceNode){return chunk}chunk=castChunk(chunk,this,loc);return new SourceNode(loc.start.line,loc.start.column,this.srcFile,chunk)},functionCall:function functionCall(fn,type,params){params=this.generateList(params);return this.wrap([fn,type?"."+type+"(":"(",params,")"])},quotedString:function quotedString(str){return'"'+(str+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function objectLiteral(obj){var pairs=[];for(var key in obj){if(obj.hasOwnProperty(key)){var value=castChunk(obj[key],this);if(value!=="undefined"){pairs.push([this.quotedString(key),":",value])}}}var ret=this.generateList(pairs);ret.prepend("{");ret.add("}");return ret},generateList:function generateList(entries){var ret=this.empty();for(var i=0,len=entries.length;i<len;i++){if(i){ret.add(",")}ret.add(castChunk(entries[i],this))}return ret},generateArray:function generateArray(entries){var ret=this.generateList(entries);ret.prepend("[");ret.add("]");return ret}};exports["default"]=CodeGen;module.exports=exports["default"]}])});function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3])}function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32(a<<s|a>>>32-s,b)}function ff(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t)}function gg(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t)}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}function ii(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t)}function md51(s){txt="";var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);tail[i>>2]|=128<<(i%4<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0}tail[14]=n*8;md5cycle(state,tail);return state}function md5blk(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24)}return md5blks}var hex_chr="0123456789abcdef".split("");function rhex(n){var s="",j=0;for(;j<4;j++)s+=hex_chr[n>>j*8+4&15]+hex_chr[n>>j*8&15];return s}function hex(x){for(var i=0;i<x.length;i++)x[i]=rhex(x[i]);return x.join("")}function md5(s){return hex(md51(s))}function add32(a,b){return a+b&4294967295}if(md5("hello")!="5d41402abc4b2a76b9719d911017c592"){function add32(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}}(function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];doResolve(fn,this)}function handle(self,deferred){while(self._state===3){self=self._value}if(self._state===0){self._deferreds.push(deferred);return}self._handled=true;Promise._immediateFn(function(){var cb=self._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self._state===1?resolve:reject)(deferred.promise,self._value);return}var ret;try{ret=cb(self._value)}catch(e){reject(deferred.promise,e);return}resolve(deferred.promise,ret)})}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(newValue instanceof Promise){self._state=3;self._value=newValue;finale(self);return}else if(typeof then==="function"){doResolve(bind(then,newValue),self);return}}self._state=1;self._value=newValue;finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2;self._value=newValue;finale(self)}function finale(self){if(self._state===2&&self._deferreds.length===0){Promise._immediateFn(function(){if(!self._handled){Promise._unhandledRejectionFn(self._value)}})}for(var i=0,len=self._deferreds.length;i<len;i++){handle(self,self._deferreds[i])}self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,self){var done=false;try{fn(function(value){if(done)return;done=true;resolve(self,value)},function(reason){if(done)return;done=true;reject(self,reason)})}catch(ex){if(done)return;done=true;reject(self,ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);handle(this,new Handler(onFulfilled,onRejected,prom));return prom};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};Promise._immediateFn=typeof setImmediate==="function"&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)};Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",err)}};Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn};Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn};if(typeof module!=="undefined"&&module.exports){module.exports=Promise}else if(!root.Promise){root.Promise=Promise}})(this);(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates["embed"]=template({1:function(container,depth0,helpers,partials,data){var helper;return'    <div class="embed-thumb" style="background-image:url(//noembed.com/i/0/450/'+container.escapeExpression((helper=(helper=helpers.thumbnail_url||(depth0!=null?depth0.thumbnail_url:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{name:"thumbnail_url",hash:{},data:data}):helper))+')">\n      <div class="embed-play"></div>\n    </div>\n'},3:function(container,depth0,helpers,partials,data){var helper;return container.escapeExpression((helper=(helper=helpers.html||(depth0!=null?depth0.html:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{name:"html",hash:{},data:data}):helper))+"\n"},5:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.description:depth0,{name:"if",hash:{},fn:container.program(6,data,0),inverse:container.noop,data:data}))!=null?stack1:""},6:function(container,depth0,helpers,partials,data){var helper;return"<p>"+container.escapeExpression((helper=(helper=helpers.description||(depth0!=null?depth0.description:depth0))!=null?helper:helpers.helperMissing,typeof helper==="function"?helper.call(depth0!=null?depth0:container.nullContext||{},{name:"description",hash:{},data:data}):helper))+"</p>\n"
},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'<div class="embed-wrap-wrap">\n  <div class="embed-wrap" data-embed-provider="'+alias4((helper=(helper=helpers.provider_name_lc||(depth0!=null?depth0.provider_name_lc:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"provider_name_lc",hash:{},data:data}):helper))+'" data-embed-id="'+alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"id",hash:{},data:data}):helper))+'">\n\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.thumbnail_url:depth0,{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data}))!=null?stack1:"")+"\n    <h2>"+alias4((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"title",hash:{},data:data}):helper))+"</h2>\n\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.use_html:depth0,{name:"if",hash:{},fn:container.program(3,data,0),inverse:container.program(5,data,0),data:data}))!=null?stack1:"")+'\n    <p class="embed-source">'+alias4((helper=(helper=helpers.provider_name||(depth0!=null?depth0.provider_name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"provider_name",hash:{},data:data}):helper))+"</p>\n\n  </div>\n</div>\n"},useData:true});templates["nick"]=template({compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'<li><a class="nick-list-nick" data-nick="'+alias4((helper=(helper=helpers.nick||(depth0!=null?depth0.nick:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"nick",hash:{},data:data}):helper))+'" data-nick-order="'+alias4((helper=(helper=helpers.order||(depth0!=null?depth0.order:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"order",hash:{},data:data}):helper))+'">'+alias4((helper=(helper=helpers.sigil||(depth0!=null?depth0.sigil:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"sigil",hash:{},data:data}):helper))+alias4((helper=(helper=helpers.nick||(depth0!=null?depth0.nick:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"nick",hash:{},data:data}):helper))+"</a></li>\n"},useData:true});templates["message_menu"]=template({1:function(container,depth0,helpers,partials,data){return"off"},3:function(container,depth0,helpers,partials,data){return"on"},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1;return'<div class="message-menu-popup">\n  <ul>\n    <li class="message-privmsg">Direct message</li>\n    <li class="message-monospace">Monospace text '+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.is_monospace:depth0,{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.program(3,data,0),data:data}))!=null?stack1:"")+"</li>\n  </ul>\n</div>\n"},useData:true});templates["login"]=template({compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){return'    <section class="dialog login">\n      <div class="login-wrap">\n      <a href="#" class="close reset-toggle">Reset password</a>\n      <h2>Login</h2>\n      <form method="POST" class="login-form">\n        <fieldset class="input-group">\n          <label for="email">Email address or username</label>\n          <input name="email" type="text" value="" required>\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="pass">Password</label>\n          <input name="pass" type="password" value="" required>\n        </fieldset>\n        <fieldset class="submit-group">\n          <input type="submit" name="auth" value="Log In">\n        </fieldset>\n      </form>\n\n\n      <hr/>\n\n      <h2>Register</h2>\n      <form method="POST">\n        <fieldset class="input-group">\n          <label for="username">Username</label>\n          <input name="username" type="text" value="" required>\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="email">Email address</label>\n          <input name="email" type="email" value="" required>\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="pass">Password</label>\n          <input name="pass" type="password" value="" required>\n        </fieldset>\n        <fieldset class="submit-group">\n          <input type="submit" name="register" value="Register">\n        </fieldset>\n      </form>\n      </div>\n\n      <div class="reset-wrap">\n      <a href="#" class="close login-toggle">Login</a>\n      <h2>Reset password</h2>\n      <form method="POST">\n        <fieldset class="input-group">\n          <label for="email">Email address</label>\n          <input name="email" type="email" value="" required>\n        </fieldset>\n        <fieldset class="submit-group">\n          <input type="submit" name="auth" value="This doesn\'t work" disabled>\n        </fieldset>\n      </form>\n      </div>\n\n    </section>\n'},useData:true});templates["help"]=template({compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){return'    <aside class="dialog help">\n      <a href="#" class="close">close</a>\n      <p>Example commands:</p>\n\n      <ul>\n        <li><code>/join #channel</code></li>\n        <li><code>/part reason</code></li>\n        <li><code>/query user message</code></li>\n        <li><code>/say /hello</code></li>\n        <li><code>/topic new topic message</code></li>\n        <li><code>/last query</code></li>\n      </ul>\n\n      <dl>\n        <h3>Navigation</h3>\n        <dt>Alt + [Up,Down]</dt>\n        <dd>Next/Prev panel</dd>\n        <dt>Shift + Alt + [Up,Down]</dt>\n        <dd>Next/Prev unread panel</dd>\n        <dt>Alt + [1-9]</dt>\n        <dd>Focus panel</dd>\n        <dt>Alt + t</dt>\n        <dd>Quick panel switch</dd>\n        <dt>Alt + k</dt>\n        <dd>Quick panel switch</dd>\n        <dt>Alt + ;</dt>\n        <dd>Toggle nicklist</dd>\n      </dl>\n      <dl>\n        <h3>Editor</h3>\n        <dt>Ctrl + b</dt>\n        <dd>Bold</dd>\n        <dt>Ctrl + i</dt>\n        <dd>Italic</dd>\n        <dt>Ctrl + u</dt>\n        <dd>Underline</dd>\n        <dt>Ctrl + /</dt>\n        <dd>Invert</dd>\n        <dt>Up</dt>\n        <dd>Previous line history</dd>\n        <dt>Down</dt>\n        <dd>Next line in history</dd>\n      </dl>\n\n      <p>\n        <a target="_blank" href="https://github.com/lierc/lierc-basicui/blob/master/static/js/lierc/commands.js">Help Lee add more commands?</a>\n      </p>\n    </aside>\n'},useData:true});templates["join"]=template({1:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'            <option value="'+alias2(alias1(depth0!=null?depth0.id:depth0,depth0))+'">'+alias2(alias1(depth0!=null?depth0.host:depth0,depth0))+"</option>\n"},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1;return'    <section  class="dialog join">\n      <a href="#" class="close login-toggle">close</a>\n      <h2>Join a channel</h2>\n      <form method="POST">\n        <fieldset class="input-group">\n          <label for="channel">Channel name</label>\n          <input type="text" name="channel" required>\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="connection">IRC Network</label>\n          <select name="connection">\n'+((stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.connections:depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data}))!=null?stack1:"")+'          </select>\n        </fieldset>\n        <fieldset class="submit-group">\n          <input type="submit" name="join" value="Join">\n        </fieldset>\n      </form>\n    </section>\n\n'},useData:true});templates["connection"]=template({1:function(container,depth0,helpers,partials,data){return"      <h2>Edit connection</h2>\n"},3:function(container,depth0,helpers,partials,data){return"      <h2>Add a connection</h2>\n"},5:function(container,depth0,helpers,partials,data){return" checked=checked"},7:function(container,depth0,helpers,partials,data){return'          <input type="submit" value="&#xf071; Delete" class="delete-connection">\n          <input type="submit" name="connect" value="Save & Reconnect" style="font-weight:bold">\n'},9:function(container,depth0,helpers,partials,data){return'          <input type="submit" name="connect" value="Connect">\n'},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'    <section class="dialog config">\n      <a href="#" class="close">close</a>\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.edit:depth0,{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.program(3,data,0),data:data}))!=null?stack1:"")+'      <form method="'+alias4((helper=(helper=helpers.method||(depth0!=null?depth0.method:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"method",hash:{},data:data}):helper))+'" action="'+alias4((helper=(helper=helpers.action||(depth0!=null?depth0.action:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"action",hash:{},data:data}):helper))+'">\n        <div class="input-h-group">\n          <fieldset class="input-group">\n            <label for="host">Address <span class="required">*</span></label>\n            <input name="Host" type="text" value="'+alias4((helper=(helper=helpers.Host||(depth0!=null?depth0.Host:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Host",hash:{},data:data}):helper))+'" placeholder="irc.freenode.com" required>\n          </fieldset>\n          <fieldset class="input-group">\n            <label for="port">Port <span class="required">*</span></label>\n            <input name="Port" type="number" value="'+alias4((helper=(helper=helpers.Port||(depth0!=null?depth0.Port:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Port",hash:{},data:data}):helper))+'" required>\n          </fieldset>\n          <fieldset class="input-group">\n            <label for="ssl">TLS</label>\n            <input name="Ssl" type="checkbox"'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.Ssl:depth0,{name:"if",hash:{},fn:container.program(5,data,0),inverse:container.noop,data:data}))!=null?stack1:"")+'>\n          </fieldset>\n        </div>\n        <fieldset class="input-group">\n          <label for="nick">Nickname <span class="required">*</span></label>\n          <input name="Nick" type="text" value="'+alias4((helper=(helper=helpers.Nick||(depth0!=null?depth0.Nick:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Nick",hash:{},data:data}):helper))+'" required>\n        </fieldset>\n        <div class="input-h-group">\n          <fieldset class="input-group">\n            <label for="user">Username</label>\n            <input name="User" type="text" value="'+alias4((helper=(helper=helpers.User||(depth0!=null?depth0.User:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"User",hash:{},data:data}):helper))+'">\n          </fieldset>\n          <fieldset class="input-group">\n            <label for="pass">Password</label>\n            <input name="Pass" type="text" value="'+alias4((helper=(helper=helpers.Pass||(depth0!=null?depth0.Pass:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Pass",hash:{},data:data}):helper))+'">\n          </fieldset>\n        </div>\n        <fieldset class="input-group">\n          <label for="channels">Channels\n            <span>(comma separated)</span>\n          </label>\n          <input name="Channels" type="text" value="'+alias4((helper=(helper=helpers.Channels||(depth0!=null?depth0.Channels:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Channels",hash:{},data:data}):helper))+'">\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="highlight">Highlight words (comma separated)</label>\n          <input name="Highlight" type="text" value="'+alias4((helper=(helper=helpers.Highlight||(depth0!=null?depth0.Highlight:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Highlight",hash:{},data:data}):helper))+'">\n        </fieldset>\n        <fieldset class="input-group">\n          <label for="alias">Network alias</label>\n          <input name="Alias" type="text" value="'+alias4((helper=(helper=helpers.Alias||(depth0!=null?depth0.Alias:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"Alias",hash:{},data:data}):helper))+'">\n        </fieldset>\n\n        <fieldset class="submit-group">\n'+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.edit:depth0,{name:"if",hash:{},fn:container.program(7,data,0),inverse:container.program(9,data,0),data:data}))!=null?stack1:"")+'          <p style="float:right" class="note"><span class="required">*</span> required</p>\n        </fieldset>\n      </form>\n    </section>\n\n'},useData:true});templates["nav_item"]=template({1:function(container,depth0,helpers,partials,data){return'  <a class="fa fa-pencil edit edit-panel"></a>\n'},3:function(container,depth0,helpers,partials,data){return'  <a class="fa fa-times close-panel"></a>\n'},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:container.nullContext||{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return'<li data-panel-id="'+alias4((helper=(helper=helpers.id||(depth0!=null?depth0.id:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"id",hash:{},data:data}):helper))+'">\n  <a class="panel-name">'+alias4((helper=(helper=helpers.name||(depth0!=null?depth0.name:depth0))!=null?helper:alias2,typeof helper===alias3?helper.call(alias1,{name:"name",hash:{},data:data}):helper))+"</a>\n"+((stack1=helpers["if"].call(alias1,depth0!=null?depth0.status:depth0,{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.program(3,data,0),data:data}))!=null?stack1:"")+"</li>\n"},useData:true});templates["emoji"]=template({1:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'<li data-chars="'+alias2(alias1(depth0!=null?depth0.chars:depth0,depth0))+'" data-keywords="'+alias2(alias1(depth0!=null?depth0.keywords:depth0,depth0))+'" data-name="'+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+'" title="'+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+'">'+alias2(alias1(depth0!=null?depth0.chars:depth0,depth0))+"</li>\n"},compiler:[7,">= 4.0.0"],main:function(container,depth0,helpers,partials,data){var stack1;return(stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.emoji:depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data}))!=null?stack1:""},useData:true})})();var API=function(baseurl){var api=this;api.baseurl=baseurl;api.request=function(method,path,options){if(!options)options={};var settings={method:method,credentials:"same-origin"};if(options["body"]){var body=options["body"];if(body&&typeof body=="Object"){settings["body"]=JSON.stringify(body)}else{settings["body"]=body}}if(options["headers"]){settings["headers"]=options["headers"]}return fetch(api.baseurl+path,settings).then(function(res){var type=res.headers.get("Content-Type");if(type&&type.match(/^application\/javascript/)){return res.json()}else if(res.ok){return res.text()}else{throw new Error("API Error: ["+res.status+"] '"+res.statusText+"'")}}).then(function(data){if(data["status"]=="error"){throw"API Error: "+data["error"]}if(options["success"]){options["success"](data)}}).catch(function(e){if(options["error"]){options["error"](e)}else{console.error(e)}})};api.build_query=function(params){return Object.keys(params).map(function(k){return[encodeURIComponent(k),encodeURIComponent(params[k])].join("=")}).join("&")};api.stream=function(){return new Stream(api.baseurl)};api.auth=function(cb){return fetch(api.baseurl+"/auth",{credentials:"same-origin"}).then(cb)};api.logout=function(){return fetch(api.baseurl+"/logout",{method:"POST",credentials:"same-origin"}).then(function(res){if(!res.ok)alert("Error!");else window.location.reload()})};api.get=function(path,options){if(options["data"])path+="?"+api.build_query(options["data"]);return api.request("GET",path,options)};api.post=function(path,options){return api.request("POST",path,options)};api.delete=function(path,options,query){if(query)path+="?"+api.build_query(query);return api.request("DELETE",path,options)};api.put=function(path,options){return api.request("PUT",path,options)}};if(!("forEach"in NodeList)){NodeList.prototype.forEach=Array.prototype.forEach}var App=function(url,user){var app=this;app.user=user;app.api=new API(url);app.commands=new Commands(app);app.stream;app.connections={};app.filling_backlog=false;app.dialog=null;app.sorting=[];app.last_seen={};app.missed={};app.panels={};app.focused=null;app.last_panel_id=null;app.window_focused=true;app.default_panel=null;app.default_focused=false;app.prefs={};app.touchstart="ontouchstart"in document.documentElement;app.mobile=App.detect_mobile();app.post_tokens=[];app.elem={panel:document.getElementById("panel"),nav:document.getElementById("nav"),status:document.getElementById("status"),privates:document.getElementById("privates"),channels:document.getElementById("channels"),input:document.getElementById("input"),topic:document.getElementById("topic"),filler:document.getElementById("filler"),prefix:document.getElementById("prefix"),scroll:document.getElementById("panel-scroll"),title:document.getElementsByTagName("title")[0],nicks:document.getElementById("nicks"),body:document.body,audio:new Audio("/static/ent_communicator1.mp3"),emoji:document.getElementById("emoji"),switcher:document.getElementById("switcher-wrap"),panel_name:document.getElementById("panel-name"),flex_wrap:document.querySelector(".flex-wrap"),reconnect:document.getElementById("reconnect-status")};app.set_connected=function(conn_id,status,message){var connection=app.connections[conn_id];connection.connected=status;for(id in app.panels){var panel=app.panels[id];if(panel.connection==conn_id){panel.set_connected(status,message)}}};app.setup_connection=function(id,host,nick){if(app.connections[id])return;var connection=new Connection(id,host);app.connections[id]=connection;var panel=app.add_panel("status",connection.id);panel.change_name(host);panel.update_topic({value:"status."});connection.on("channel:new",function(conn,channel,message){app.add_panel(channel,conn,"Id"in message)});connection.on("private:msg",function(conn,nick,message){var panel=app.add_panel(nick,conn,false);var connection=app.connections[conn];var from=message.Prefix.Name!=connection.nick;panel.append(Render(message));app.update_title(true);if(from&&(!app.is_focused(panel)||!panel.is_scrolled()))app.elem.audio.play()});connection.on("channel:msg",function(conn,channel,message){var panel=app.get_panel(channel,conn);var html=Render(message);if(html){panel.append(html);app.update_title(true);if(message.Highlight&&(!app.is_focused(panel)||!panel.is_scrolled()))app.elem.audio.play()}});connection.on("channel:react",function(conn,channel,message){var panel=app.get_panel(channel,conn);var parts=message.Params[1].split(" ");panel.handle_reaction(message.Prefix.Name,parts[1],parts[2])});connection.on("private:react",function(conn,nick,message){var panel=app.get_panel(nick,conn);var parts=message.Params[1].split(" ");panel.handle_reaction(message.Prefix.Name,parts[1],parts[2])});connection.on("channel:nicks",function(conn,channel,nicks){var panel=app.get_panel(channel,conn);if(panel.focused)panel.update_nicks(nicks)});connection.on("channel:mode",function(conn,channel,mode){var panel=app.get_panel(channel,conn);panel.update_mode(mode)});connection.on("channel:close",function(conn,channel){app.remove_panel(App.panel_id(channel,conn))});connection.on("status:raw",function(conn,message){var panel=app.get_panel("status",conn);panel.append(Render(message,true))});connection.on("status",function(conn,message){var panel=app.get_panel("status",conn);panel.append(Render(message))});connection.on("connect",function(conn,message){app.set_connected(conn,true,message.Params[0])});connection.on("disconnect",function(conn,message){app.set_connected(conn,false,message.Params[0])});connection.on("channel:topic",function(conn,channel,topic){var panel=app.get_panel(channel,conn);panel.update_topic(topic)})};app.is_focused=function(panel){return app.window_focused&&app.focused&&app.focused.id==panel.id};app.find_default_panel=function(){var parts=window.location.hash.split("/").slice(1);if(parts.length==2){return App.panel_id(decodeURIComponent(parts[1]),parts[0])}else if(app.sorting.length){return app.sorting[0]}return null};app.init=function(){app.default_panel=app.find_default_panel();app.api.get("/connection",{success:function(configs){if(!configs.length)app.config_modal();configs.forEach(function(conn){var conn_id=conn.Id;var host=conn.Config.Alias||conn.Config.Host;var nick=conn.Nick;app.setup_connection(conn_id,host,nick)});if(app.stream)app.stream.destroy();app.connect()}})};app.add_recent_privates=function(){app.api.get("/privates",{success:function(privates){privates.forEach(function(priv){app.add_panel(priv.nick,priv.connection,false)})}})};app.connect=function(){var stream=app.api.stream();stream.on("message",function(e){var conn_id=e.ConnectionId;var message=e.Message;if(e.MessageId)message.Id=e.MessageId;message.Highlight=e.Highlight;if(app.connections[conn_id]){app.connections[conn_id].on_message(message)}});stream.on("create_connection",function(e){var conn_id=e.ConnectionId;var message=e.Message;var nick=message.Params[0];var host=message.Params[1];app.setup_connection(conn_id,host,nick)});stream.on("delete_connection",function(e){var conn_id=e.ConnectionId;for(id in app.panels){var panel=app.panels[id];if(panel.connection==conn_id){app.remove_panel(id)}}delete app.connections[conn_id]});stream.on("close",function(e){for(id in app.panels){app.panels[id].set_disabled(true)}if(app.focused){app.focused.scroll(function(){app.elem.body.classList.add("disconnected")})}else{app.elem.body.classList.add("disconnected")}});stream.on("reconnect-status",function(text){if(app.focused){app.focused.scroll(function(){app.elem.reconnect.textContent=text})}else{app.elem.reconnect.textContent=text}});stream.on("open",function(e){app.elem.body.classList.remove("disconnected");if(app.focused){if(stream.last_id){app.fill_missed(stream.last_id)}}for(var id in app.panels){app.panels[id].set_disabled(false);if(!app.focused||id!=app.focused.id){app.panels[id].clear_lists()}}});app.sync_missed();app.add_recent_privates();app.stream=stream};app.get_panel=function(name,connection){var id=App.panel_id(name,connection);return app.panels[id]};app.close_panel=function(id){var panel=app.panels[id];if(panel.type=="private"){var path="/connection/"+panel.connection+"/nick/"+encodeURIComponent(panel.name);app.api.delete(path)}app.remove_panel(id)};app.remove_panel=function(id){if(!app.panels[id])return;var focused=id==app.focused.id;app.panels[id].remove_elems();delete app.panels[id];if(focused){if(app.last_panel_id&&app.panels[app.last_panel_id])app.focus_panel(app.last_panel_id);else if(Object.keys(app.panels).length)app.focus_panel(Object.keys(app.panels)[0]);else app.focused=null}app.update_nav_counts()};app.update_nav_counts=function(){app.elem.status.previousSibling.previousSibling.querySelector(".count").textContent=app.elem.status.querySelectorAll("li").length;app.elem.privates.previousSibling.previousSibling.querySelector(".count").textContent=app.elem.privates.querySelectorAll("li").length;app.elem.channels.previousSibling.previousSibling.querySelector(".count").textContent=app.elem.channels.querySelectorAll("li").length};app.add_panel=function(name,connection,focus){var id=App.panel_id(name,connection);if(app.panels[id])return app.panels[id];if(!app.connections[connection]){console.log("Connection does not exist",connection);throw"Connection does not exist"}var conn=app.connections[connection];var panel=new Panel(name,id,conn,app.mobile);if(app.last_seen[panel.id])panel.last_seen=app.last_seen[panel.id];panel.update_nav();if(panel.type=="channel"){var channel=conn.channel(panel.name);panel.editor.completion.nicks=channel.nicks}panel.editor.completion.commands=app.commands.completions();app.panels[id]=panel;if(panel.type=="status")app.elem.status.appendChild(panel.elem.nav);else if(panel.type=="private")app.elem.privates.appendChild(panel.elem.nav);else app.insert_sorted_nav(panel);app.update_nav_counts();if(panel.type=="channel")app.ignore_events_pref(panel);app.collapse_embeds_pref(panel);app.monospace_nicks_pref(panel);panel.elem.nav.addEventListener("click",function(e){e.preventDefault();app.elem.flex_wrap.classList.remove("open");var id=this.getAttribute("data-panel-id");var panel=app.panels[id];if(e.target.classList.contains("close-panel")){if(panel.type=="channel")app.part_channel(panel.name,panel.connection);else if(panel.type=="status")app.delete_connection(panel.connection);else app.close_panel(id)}else if(e.target.classList.contains("edit-panel")){app.api.get("/connection/"+panel.connection,{success:function(res){app.config_modal(null,res)},error:function(e){alert(e)}})}else{app.focus_panel(id)}});if(focus===true||!app.focused){app.focus_panel(id)}else if(app.default_panel&&id==app.default_panel){app.default_panel=null;app.default_focused=true;app.focus_panel(id)}else if(!app.default_focused&&panel.type=="channel"&&app.channel_panels()==1){app.focus_panel(id)}if(!panel.focused&&app.missed[panel.id])app.apply_missed(panel,app.missed[panel.id]);delete app.missed[panel.id];return app.panels[id]};app.apply_missed=function(panel,missed){if(missed.messages){panel.unread=true;if(panel.type=="private")panel.highlighted=true;panel.update_nav()}else if(missed.events){panel.missed=true;panel.update_nav()}app.update_title()};app.update_title=function(highlight){if(!app.focused)return;var name=app.focused.name;if(!app.window_focused&&highlight){name="*"+name}app.elem.title.textContent=name};app.post_token=function(){var token=app.post_tokens.pop();if(!token){alert("No post tokens, tell Lee!");throw Error("No tokens")}return token};app.part_channel=function(name,connection){if(!confirm("Are you sure you want to leave "+name+"?"))return;var headers=new Headers;headers.append("lierc-token",app.post_token());headers.append("content-type","application/irc");app.api.post("/connection/"+connection,{body:"PART "+name,headers:headers,success:function(res){app.remove_panel(App.panel_id(name,connection));app.post_tokens.push(res.token)},error:function(e){alert("Error: "+e);app.load_token()}})};app.delete_connection=function(connection){if(!confirm("Are you sure you want to remove this connection?"))return;app.api.delete("/connection/"+connection,{error:function(e){alert(e)}})};app.channel_panels=function(){var panels=0;for(id in app.panels){if(app.panels[id].type=="channel")panels++}return panels};app.insert_sorted_nav=function(panel){var index=app.sorting.indexOf(panel.id);if(index==-1){app.elem.channels.appendChild(panel.elem.nav);app.save_channel_order();return}var items=app.elem.channels.childNodes;for(var i=0;i<items.length;i++){var id=items[i].getAttribute("data-panel-id");if(index<app.sorting.indexOf(id)){app.elem.channels.insertBefore(panel.elem.nav,items[i]);return}}app.elem.channels.appendChild(panel.elem.nav)};app.fill_missed=function(start){app.api.get("/log/"+start,{success:function(events){for(var i=0;i<events.length;i++){app.stream.fire("message",events[i])}},error:function(e){app.reset()}})};app.fill_backlog=function(panel,msgid){if(panel.backlog_empty)return;var connection=app.connections[panel.connection];if(!connection)return;panel.set_loading(true);var limit=panel.ignore_events?150:50;var name=panel.type=="status"?"status":panel.name;var parts=["connection",connection.id,"channel",encodeURIComponent(name),"events"];if(msgid)parts.push(msgid);app.api.get("/"+parts.join("/"),{data:{limit:limit},success:function(events){if(events.length<limit)panel.backlog_empty=true;var list=[];var reactions=[];events.forEach(function(e){var message=e.Message;message.Id=e.MessageId;message.Highlight=e.Highlight;if(app.is_reaction(message))reactions.push(message);else{var el=Render(message);if(el)list.push(el)}});panel.prepend(list);app.filling_backlog=false;reactions.forEach(function(reaction){var parts=reaction.Params[1].split(" ");panel.handle_reaction(reaction.Prefix.Name,parts[1],parts[2])});panel.react_backlog_check();panel.set_loading(false)},error:function(e){app.filling_backlog=false;panel.set_loading(false);console.log(e)}})};app.is_reaction=function(message){return message.Command=="PRIVMSG"&&(message.Params[1]||"").substring(0,5)==""+"FACE"};app.prev_panel=function(){var items=app.elem.nav.querySelectorAll("li");for(var i=items.length-1;i>=0;i--){var item=items[i];if(item.classList.contains("active")&&items[i-1]){var id=items[i-1].getAttribute("data-panel-id");app.focus_panel(id);return}}};app.prev_unread_panel=function(){var items=app.elem.nav.querySelectorAll("li");for(var i=items.length-1;i>=0;i--){var item=items[i];if(item.classList.contains("active")){for(var j=i;j>0;j--){var item=items[j-1];if(item.classList.contains("unread")){var id=item.getAttribute("data-panel-id");app.focus_panel(id);return}}return}}};app.next_panel=function(){var items=app.elem.nav.querySelectorAll("li");for(var i=0;i<items.length;i++){var item=items[i];if(item.classList.contains("active")&&items[i+1]){var id=items[i+1].getAttribute("data-panel-id");app.focus_panel(id);return}}};app.next_unread_panel=function(){var items=app.elem.nav.querySelectorAll("li");for(var i=0;i<items.length;i++){var item=items[i];if(item.classList.contains("active")){for(var j=i;j<items.length;j++){var item=items[j+1];if(item.classList.contains("unread")){var id=item.getAttribute("data-panel-id");app.focus_panel(id);return}}return}}};app.focus_panel=function(id){if(app.focused){if(app.focused.id==id)return;app.last_panel_id=app.focused.id}if(app.elem.switcher.classList.contains("open")){app.hide_switcher()}var panel=app.panels[id];if(!panel)return;app.elem.panel_name.textContent=panel.name;app.replace_child("panel",panel.elem.list);app.replace_child("input",panel.elem.input);app.replace_child("topic",panel.elem.topic);app.replace_child("filler",panel.elem.filler);app.replace_child("prefix",panel.elem.prefix);app.elem.body.setAttribute("data-panel-type",panel.type);app.replace_child("nicks",panel.elem.nicks);if(app.focused){app.focused.unfocus();app.save_seen(app.focused)}if(panel.first_focus&&panel.type=="channel")app.show_nicklist_pref(panel);panel.focus();app.focused=panel;window.history.replaceState({},"",panel.path);app.check_scroll();app.update_title();if(panel.type=="channel"){var conn=app.connections[panel.connection];panel.update_nicks(conn.nicks(conn.channel(panel.name)))}};app.replace_child=function(p,c){p=app.elem[p];while(p.firstChild){p.removeChild(p.firstChild)}p.appendChild(c)};app.config_modal=function(e,connection){if(e)e.preventDefault();var vars={};if(connection){var config=connection.Config;
vars.Host=config.Host;vars.Port=config.Port;vars.Ssl=config.Ssl;vars.Nick=config.Nick;vars.User=config.User;vars.Pass=config.Pass;vars.Alias=config.Alias;vars.Channels=config.Channels.join(", ");vars.Highlight=config.Highlight.join(", ");vars.action="/connection/"+connection.Id;vars.method="PUT";vars.edit=true}else{vars.Nick=app.user.user;vars.User=app.user.user;vars.Highlight=app.user.user;if(Object.keys(app.connections).length==0){vars.Host="irc.freenode.com";vars.Port="6697";vars.Ssl=true;vars.Channels="#lierc";vars.Alias="freenode"}vars.action="/connection";vars.method="POST";vars.edit=false}app.elem.flex_wrap.classList.remove("open");var dialog=app.new_dialog("connection",vars);var del=dialog.el.querySelector(".delete-connection");if(del&&connection){del.addEventListener("click",function(e){e.preventDefault();app.delete_connection(connection.Id);app.close_dialog()})}dialog.el.addEventListener("submit",function(e){e.preventDefault();var form=e.target;var method=form.getAttribute("method");var action=form.getAttribute("action");var data={Host:form.querySelector('input[name="Host"]').value,Port:parseInt(form.querySelector('input[name="Port"]').value),Ssl:form.querySelector('input[name="Ssl"]').checked,Nick:form.querySelector('input[name="Nick"]').value,User:form.querySelector('input[name="User"]').value,Pass:form.querySelector('input[name="Pass"]').value,Alias:form.querySelector('input[name="Alias"]').value,Channels:form.querySelector('input[name="Channels"]').value.split(/\s*,\s*/),Highlight:form.querySelector('input[name="Highlight"]').value.split(/\s*,\s*/)};app.api.request(method,action,{body:JSON.stringify(data),success:function(res){app.close_dialog()},error:function(e){alert("i'm sorry")}})})};app.check_scroll=function(){if(app.filling_backlog||!app.focused||app.focused.backlog_empty||app.overlayed()||!app.connections[app.focused.connection]||app.elem.flex_wrap.classList.contains("open")||getComputedStyle(app.elem.scroll).display=="none"){return}if(app.elem.scroll.scrollTop<=1){app.filling_backlog=true;app.fill_backlog(app.focused,app.focused.oldest_message_id())}};app.ping_server=function(){app.api.auth(function(res){if(res.status==200)return;if(res.status==401){return}console.log(res.status);if(res.status==0){app.stream.close();return}var data=res.json();if(data["error"]){console.log(data["error"])}})};app.get_prefs=function(cb){app.api.get("/preference",{success:function(data){var prefs={};for(var i=0;i<data.length;i++){try{prefs[data[i].name]=JSON.parse(data[i].value)}catch(e){console.log("Unable to parse JSON: ",data[i].value)}}cb(prefs)},error:function(e){alert(e)}})};app.get_pref=function(name){return app.prefs[name]};app.show_nicklist_pref=function(panel){var value=app.get_pref(panel.id+"-show-nicklist");if(value!=undefined)panel.set_show_nicklist(value)};app.ignore_events_pref=function(panel){var value=app.get_pref(panel.id+"-ignore-events");if(value!==undefined)panel.set_ignore_events(value)};app.collapse_embeds_pref=function(panel){var value=app.get_pref(panel.id+"-collapse-embeds");if(value!==undefined)panel.set_collapse_embeds(value)};app.monospace_nicks_pref=function(panel){var value=app.get_pref(panel.id+"-monospace-nicks");if(value!==undefined)panel.monospace_nicks=value};app.add_monospace_nick=function(panel,nick){panel.add_monospace_nick(nick);app.update_pref(panel.id+"-monospace-nicks",panel.monospace_nicks)};app.remove_monospace_nick=function(panel,nick){panel.remove_monospace_nick(nick);app.update_pref(panel.id+"-monospace-nicks",panel.monospace_nicks)};app.update_pref=function(name,value){app.prefs[name]=value;app.api.post("/preference/"+encodeURIComponent(name),{body:JSON.stringify(value)})};app.load_token=function(cb){app.api.get("/token",{success:function(data){app.post_tokens.push(data.token);if(data.extra){app.post_tokens=app.post_tokens.concat(data.extra)}if(cb)cb()},error:function(e){if(cb)cb()}})};app.load_seen=function(cb){app.api.get("/seen",{success:function(res){for(i in res){var id=App.panel_id(res[i]["channel"],res[i]["connection"]);app.last_seen[id]=res[i]["message_id"]}cb()},error:function(e){cb()}})};app.save_seen=function(panel,force){var diffs=0;var id=panel.id;var last_seen=panel.last_seen;var send=last_seen&&last_seen!=app.last_seen[id];if(send||force){var parts=["connection",panel.connection,"channel",encodeURIComponent(panel.name),"seen"];app.api.post("/"+parts.join("/"),{body:""+last_seen});app.last_seen[id]=last_seen}};app.sync_missed=function(){if(app.focused){app.focused.update_seen();if(app.focused.last_seen)app.last_seen[app.focused.id]=app.focused.last_seen}app.api.get("/missed",{data:app.last_seen,success:function(res){app.missed={};for(connection in res){for(channel in res[connection]){var id=App.panel_id(channel,connection);if(app.panels[id]){app.apply_missed(app.panels[id],res[connection][channel])}else{app.missed[id]=res[connection][channel]}}}}})};app.search_panel=function(panel,text){var parts=["connection",panel.connection,"channel",encodeURIComponent(panel.name),"last"];app.api.get("/"+parts.join("/"),{data:{query:text,limit:10},success:function(messages){if(messages.length>0){panel.scroll(function(){var line=document.createElement("DIV");line.classList.add("search-start");panel.elem.list.appendChild(line)})}for(var i=messages.length-1;i>=0;i--){var msg=messages[i].Message;msg.Search=true;panel.append(Render(msg))}}})};app.focus_input=function(force){if(force){app.focused.elem.input.focus();return}if(app.mobile)return;if(!app.focused)return;if(app.overlayed())return;app.focused.elem.input.focus()};app.hide_switcher=function(){app.elem.switcher.classList.remove("open");app.elem.nav.classList.remove("filtering");app.elem.nav.querySelectorAll("li").forEach(function(li){li.classList.remove("match","selected","candidate")})};app.toggle_switcher=function(){app.elem.switcher.querySelector("input").value="";if(app.elem.switcher.classList.contains("open")){app.hide_switcher()}else{app.elem.switcher.classList.add("open");app.elem.nav.classList.add("filtering");app.elem.nav.querySelectorAll("#channels li[data-name], #privates li[data-name]").forEach(function(li){li.classList.add("candidate");if(li.classList.contains("unread"))li.classList.add("match")});var matches=app.elem.nav.querySelectorAll("li[data-name].candidate.match");if(!matches.length)matches=app.elem.nav.querySelectorAll("li[data-name].candidate");if(matches.length){matches[0].classList.add("selected")}app.elem.switcher.querySelector("input").focus()}};app.save_channel_order=function(){var order=Array.prototype.map.call(app.elem.channels.querySelectorAll("li"),function(li){return li.getAttribute("data-panel-id")});app.sorting=order;app.update_pref("sorting",order)};app.overlayed=function(){return app.dialog&&app.dialog.open};app.close_dialog=function(){if(app.dialog)app.dialog.close();app.dialog=null};app.new_dialog=function(name,vars){if(app.dialog)app.dialog.close();var dialog=new Dialog(name,vars);app.elem.flex_wrap.classList.remove("open");dialog.append(app.elem.body);var input=dialog.el.querySelector("input[type=text]");if(!app.mobile&&input){input.focus();input.select()}app.dialog=dialog;return dialog};app.reset=function(){var path=app.focused?app.focused.path:"";for(id in app.panels){app.remove_panel(id)}window.history.replaceState({},"",path);app.default_focused=false;app.connections=[];app.last_seen={};app.missed={};app.focused=null;app.load_seen(function(){app.load_token(function(){app.init()})})};if(!app.mobile){document.querySelectorAll(".sortable").forEach(function(el){Sortable.create(el,{delay:0,onSort:function(e){app.save_channel_order()}})})}setInterval(app.check_scroll,250);setInterval(app.ping_server,1e3*15);app.get_prefs(function(prefs){app.prefs=prefs;app.sorting=app.prefs["sorting"]||[];delete app.prefs["sorting"];if(app.prefs["email"]===true){document.getElementById("email-notify").classList.add("enabled")}app.load_seen(function(){app.load_token(function(){app.init();Emoji.load()})})});app.events=new UIEvents(app);app.notify=new Notifier(app)};App.detect_mobile=function(){return function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))return true;return false}(navigator.userAgent||navigator.vendor||window.opera)};App.panel_id=function(name,connection){return[connection,name.toLowerCase()].join("-")};var Auth=function(baseurl){var baseurl=baseurl;this.auth=function(complete){fetch(baseurl+"/auth",{credentials:"same-origin"}).then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){complete(res)}).catch(function(e){console.log(e);modal_overlay(complete)})};function modal_overlay(complete){var dialog=new Dialog("login");var overlay=dialog.el;dialog.append(document.body);if(!("ontouchstart"in document.documentElement)){overlay.querySelector('.login-form input[name="email"]').focus()}overlay.addEventListener("submit",function(e){e.preventDefault();var action=e.target.querySelector('input[type="submit"]').getAttribute("name");var email=e.target.querySelector('input[name="email"]').value;var pass=e.target.querySelector('input[type="password"]').value;var body="";body+="email="+encodeURIComponent(email);body+="&pass="+encodeURIComponent(pass);if(action=="register"){var user=e.target.querySelector('input[name="username"]').value;body+="&username="+encodeURIComponent(user)}fetch(baseurl+"/"+action,{credentials:"same-origin",method:"POST",body:body,headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){dialog.close();complete(res)}).catch(function(e){alert("Sorry: "+e)})});overlay.querySelector(".login-toggle").addEventListener("click",function(e){e.preventDefault();overlay.querySelector(".login-wrap").style.display="block";overlay.querySelector(".reset-wrap").style.display="none";overlay.querySelector('.login-form input[name="email"]').focus()});overlay.querySelector(".reset-toggle").addEventListener("click",function(e){e.preventDefault();overlay.querySelector(".login-wrap").style.display="none";overlay.querySelector(".reset-wrap").style.display="block";overlay.querySelector('.reset-wrap input[name="email"]').focus()})}};var Channel=function(name){this.name=name;this.topic={value:"No topic set",user:null,time:null};this.nicks=[];this.nick_modes={};this.synced=true;this.mode="";this.reset_nicks=function(){this.nicks.splice(0,this.nicks.length);this.nick_modes={}};this.bump_nick=function(nick){var i=this.nicks.indexOf(nick);if(i!=-1){this.nicks.splice(i,1);this.nicks.unshift(nick)}};this.add_nick=function(nick,mode){if(!mode)mode="";this.nicks.unshift(nick);this.nick_modes[nick]=mode};this.set_mode=function(param){var action=param.substring(0,1);var modes=param.substring(1);for(var i=0;i<modes.length;i++){var current=this.mode;var mode=modes[i];if(action=="+"&&current.indexOf(mode)==-1)this.mode=current+mode;else if(action=="-"&&current.indexOf(mode)!=-1)this.mode=current.replace(mode,"")}};this.nick_mode=function(nick,param){var action=param.substring(0,1);var modes=param.substring(1);for(var i=0;i<modes.length;i++){var current=this.nick_modes[nick];var mode=modes[i];if(action=="+"&&current.indexOf(mode)==-1)this.nick_modes[nick]=current+mode;else if(action=="-"&&current.indexOf(mode)!=-1)this.nick_modes[nick]=current.replace(mode,"")}};this.contains_nick=function(nick){return this.nicks.indexOf(nick)!=-1};this.remove_nick=function(nick){var i=this.nicks.indexOf(nick);if(i!=-1){this.nicks.splice(i,1);delete this.nick_modes[nick];return true}return false};this.rename_nick=function(old,nick){var i=this.nicks.indexOf(old);if(i!=-1){this.nicks.splice(i,1,nick);this.nick_modes[nick]=this.nick_modes[old];delete this.nick_modes[old];return true}return false}};var Commands=function(app){var app=app;var commands=this;var handlers={};function add_command(name,aliases,handler){handlers[name]=handler;aliases.forEach(function(alias){handlers[alias]=handler})}commands.completions=function(){return Object.keys(handlers).map(function(k){return"/"+k})};add_command("help",["h"],function(panel,line){app.new_dialog("help");return});add_command("panel",["p"],function(panel,line){var parts=line.split(" ",2);var action=parts[0];var rest=parts[1];switch(action){case"move":var order=parseInt(rest);var li=panel.elem.nav;var ul=li.parentNode;var before=ul.querySelectorAll('li:not([data-panel-id="'+panel.id+'"])')[order-1];if(before){ul.removeChild(li);ul.insertBefore(li,before);app.save_channel_order()}else{alert("Invalid position: '"+order+"'")}break;default:alert("Unknown command: 'panel "+line+"'")}});add_command("join",["j"],function(panel,line){var parts=["JOIN",line];return parts.join(" ")});add_command("nick",[],function(panel,line){var parts=["NICK",line];return parts.join(" ")});add_command("mode",[],function(panel,line){var parts=["MODE",panel.name];if(line){parts.push(line)}return parts.join(" ")});add_command("last",["lastlog","l"],function(panel,line){if(panel.type=="status"){throw"Can not search on a status panel."}if(!line){throw"Search text required"}app.search_panel(panel,line)});add_command("clear",[],function(panel){panel.backlog_empty=true;panel.remove_observers(panel.elem.list);panel.elem.list.get(0).innerHTML=""});add_command("bikin",["bike","biek","beik"],function(panel){var url=":https://www.youtube.com/watch?v=WYi-YUsYZtY";return["PRIVMSG",panel.name,url].join(" ")});add_command("bustin",["bust"],function(panel){var url=":https://www.youtube.com/watch?v=0tdyU_gW6WE";return["PRIVMSG",panel.name,url].join(" ")});add_command("trim",["prune"],function(panel){panel.prune()});add_command("part",["close","wc"],function(panel,line){if(panel.type=="status"){throw"Can not close status panel."}if(panel.type=="private"){app.close_panel(panel.id);return}var parts=["PART",panel.name];if(line)parts.push(":"+line);return parts.join(" ")});add_command("who",[],function(panel,line){var parts=["WHO",":"+line];return parts.join(" ")});add_command("whois",[],function(panel,line){var parts=["WHOIS",":"+line];return parts.join(" ")});add_command("names",["n","nicks"],function(panel,line){var parts=["NAMES"];if(!line){parts.push(":"+panel.name)}else{parts.push(":"+line)}document.querySelector("#toggle-nicks").click();return parts.join(" ")});add_command("say",[""],function(panel,line){return["PRIVMSG",panel.name,":"+line].join(" ")});add_command("query",["q","msg"],function(panel,line){var args=line.split(" ",1);var rest=line.substring(args[0].length).trim();if(!rest.length){var connection=panel.connection;app.add_panel(args[0],connection,true);return}var parts=["PRIVMSG",args[0]];parts.push(":"+rest);return parts.join(" ")});add_command("me",[],function(panel,line){var parts=["PRIVMSG",panel.name];parts.push(":"+""+"ACTION "+line);return parts.join(" ")});add_command("topic",["t"],function(panel,line){if(panel.type!="channel"){throw"TOPIC only works for channels"}var parts=["TOPIC",panel.name];if(line)parts.push(":"+line);return parts.join(" ")});add_command("quote",["raw"],function(panel,line){return line});add_command("collapse",[],function(panel,line){panel.set_collapse_embeds(true);return});add_command("expand",[],function(panel,line){panel.set_collapse_embeds(false);return});commands.handle=function(panel,line){var parts=line.split(" ",1);var command=parts[0].toLowerCase();if(command in handlers){var rest=line.substring(command.length);return handlers[command](panel,rest.trim())}throw"Unknown command "+parts[0]}};var Completion=function(element){var TAB=9;this.completions=[];this.commands=[];this.nicks=[];this.completing=false;this.matches=[];this.position=0;this.index=0;this.el=element;this.complete=function(e){if(!this.completing)this.start();if(this.completing)this.cycle()};this.stop=function(){this.completing=false;this.matches=[];this.completions=[];this.position=0;this.index=0};this.start=function(){var word=this.last_word();if(word=="")return;this.completions=word[0]=="/"?this.commands:this.nicks;var sel=window.getSelection();this.position=sel.focusOffset-word.length;this.completing=true;this.matches=this.find_matches(word).concat([word]);this.index=0};this.cycle=function(){if(this.index>=this.matches.length)this.index=0;var sel=window.getSelection();var node=sel.focusNode;var start=node.textContent.substring(0,this.position);var end=this.matches[this.index++];if(this.index!=this.matches.length){if(start.indexOf(" ")==-1&&end[0]!="/"){end+=":"}end+=" "}node.textContent=start+end;this.move_cursor()};this.move_cursor=function(){var sel=window.getSelection();var node=sel.focusNode;if(node.nodeType==1){if(node.childNodes[0].nodeType==3)node=node.childNodes[0];else return}var length=node.textContent.length;var range=document.createRange();range.setStart(node,length);range.setEnd(node,length);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range)};this.find_matches=function(word){word=word.toLowerCase();var matches=[];var length=word.length;for(var i=0;i<this.completions.length;i++){var w=this.completions[i];if(w.length<length)continue;if(w.substring(0,length).toLowerCase()==word)matches.push(w)}return matches};this.last_word=function(){var sel=window.getSelection();var node=sel.focusNode;return node.textContent.replace(/.*\s/,"")}};var Connection=function(id,host,nick){var conn=this;conn.id=id;conn.host=host;conn.nick=nick;conn.connected=false;conn.channels=[];conn.isupport={};conn.prefix=[["v","+"],["o","@"],["h","%"]];conn.chantypes=["#","&"];var listeners={};conn.on=function(name,func){if(!listeners[name])listeners[name]=[];listeners[name].push(func)};fire=function(name){if(listeners[name]){var data=Array.prototype.slice.call(arguments,1);listeners[name].forEach(function(listener){listener.apply(undefined,data)})}};conn.remove_channel=function(name){var i=conn.channels.indexOf(name);if(i!=-1){conn.channels.splice(i,1);return true}return false};conn.nick_mode=function(nick){var first=nick.slice(0,1);for(var i=0;i<conn.prefix.length;i++){if(first==conn.prefix[i][1]){return[nick.slice(1),conn.prefix[i][0]]}}return[nick,""]};conn.nicks=function(channel){var ret={};var nicks=channel.nicks;var l=nicks.length;for(var i=0;i<l;i++){var nick=nicks[i];var modes=channel.nick_modes[nick];ret[nick]="";for(var j=0;j<conn.prefix.length;j++){if(modes.indexOf(conn.prefix[j][0])!=-1){ret[nick]=conn.prefix[j][1]+ret[nick]}}}return ret};conn.on_message=function(message){switch(String(message.Command)){case"CONNECT":fire("connect",conn.id,message);fire("status",conn.id,message);break;case"DISCONNECT":fire("disconnect",conn.id,message);fire("status",conn.id,message);break;case"001":conn.nick=message.Params[0];fire("status:raw",conn.id,message);break;case"005":var parts=message.Params[1].split(" ");for(var i=0;i<parts.length;i++){if(parts[i].indexOf("=")!=-1){var kv=parts[i].split("=",2);conn.isupport[kv[0]]=kv[1];if(kv[0]=="PREFIX"){var match=kv[1].match(/\(([^\)]+)\)(.+)/);if(match){var modes=match[1].split("");var prefixes=match[2].split("");conn.prefix=[];for(var j=0;j<modes.length;j++){conn.prefix.push([modes[j],prefixes[j]])}}}else if(kv[0]=="CHANTYPES"){conn.chantypes=kv[1].split("")}}else{conn.isupport[parts[i]]=true}}break;case"NICK":var old=message.Prefix.Name;var nick=message.Params[0];if(old==conn.nick){conn.nick=nick;conn.channels.forEach(function(channel){channel.rename_nick(old,nick);fire("status:raw",conn.id,message);fire("channel:msg",conn.id,channel.name,message);fire("channel:nicks",conn.id,channel.name,conn.nicks(channel))})}else{conn.channels.forEach(function(channel){if(channel.rename_nick(old,nick)){fire("channel:msg",conn.id,channel.name,message);fire("channel:nicks",conn.id,channel.name,conn.nicks(channel))}})}break;case"PART":var nick=message.Prefix.Name;var name=message.Params[0];var msg=message.Params[1];var del=true;for(var i=0;i<conn.channels;i++){if(conn.channels[i].contains_nick(nick)){del=false;break}}var channel=conn.channel(name);if(channel){if(nick==conn.nick){conn.remove_channel(name);fire("channel:close",conn.id,name)}else{channel.remove_nick(nick);fire("channel:msg",conn.id,name,message);fire("channel:nicks",conn.id,name,conn.nicks(channel))}};break;case"QUIT":var nick=message.Prefix.Name;var msg=message.Params[0];conn.channels.forEach(function(channel){if(channel.remove_nick(nick)){fire("channel:msg",conn.id,channel.name,message);fire("channel:nicks",conn.id,channel.name,conn.nicks(channel))}});break;case"JOIN":var name=message.Params[0];var nick=message.Prefix.Name;if(nick==conn.nick){var channel=new Channel(name);conn.channels.push(channel);fire("channel:new",conn.id,name,message)}else{var channel=conn.channel(name);if(channel){channel.add_nick(nick);fire("channel:msg",conn.id,name,message);fire("channel:nicks",conn.id,name,conn.nicks(channel))}}break;case"324":var name=message.Params[0];var channel=conn.channel(name);if(channel){channel.mode=message.Params[1].substring(1);fire("channel:mode",conn.id,name,channel.mode)}break;case"MODE":if(message.Prefix.Name==message.Params[0]){}else{var name=message.Params[0];var channel=conn.channel(name);if(channel){if(message.Params[1].match(/[+-][voh]/)){channel.nick_mode(message.Params[2],message.Params[1]);fire("channel:nicks",conn.id,name,conn.nicks(channel))}else{channel.set_mode(message.Params[1]);fire("channel:mode",conn.id,name,channel.mode)}fire("channel:msg",conn.id,name,message)}}break;case"332":var name=message.Params[1];var topic=message.Params[2];var channel=conn.channel(name);if(channel){channel.topic.value=topic;fire("channel:topic",conn.id,name,channel.topic)}break;case"333":var name=message.Params[1];var channel=conn.channel(name);if(channel){channel.topic.user=message.Params[2];channel.topic.time=message.Params[3];fire("channel:topic",conn.id,name,channel.topic)}break;case"TOPIC":var nick=message.Prefix.Name;var name=message.Params[0];var text=message.Params[1];var channel=conn.channel(name);if(channel){channel.topic.value=text;channel.topic.time=parseInt((new Date).getTime()/1e3);channel.topic.user=nick;fire("channel:msg",conn.id,name,message);fire("channel:topic",conn.id,name,channel.topic)}break;case"353":var name=message.Params[2];var nicks=message.Params[3].split(/\s+/);var channel=conn.channel(name);if(channel){if(channel.synced){channel.reset_nicks();channel.synced=false}for(i in nicks){if(nicks[i])var nick_mode=conn.nick_mode(nicks[i]);channel.add_nick(nick_mode[0],nick_mode[1])}}break;case"366":var name=message.Params[1];var channel=conn.channel(name);if(channel){channel.synced=true;fire("channel:nicks",conn.id,name,conn.nicks(channel))}break;case"PRIVMSG":var nick=message.Prefix.Name;var name=message.Params[0];var text=message.Params[1];var priv=conn.chantypes.indexOf(name[0])==-1;var type="msg";if(text&&text.substring(0,5)==""+"FACE")type="react";var channel=conn.channel(name);if(name==conn.nick&&priv)fire("private:"+type,conn.id,nick,message);else if(priv)fire("private:"+type,conn.id,name,message);else if(channel){channel.bump_nick(nick);fire("channel:"+type,conn.id,name,message)}break;case"PING":break;case"PONG":break;default:fire("status",conn.id,message)}};conn.channel=function(name){name=name.toLowerCase();for(var i=0;i<conn.channels.length;i++){if(conn.channels[i].name.toLowerCase()==name){return conn.channels[i]}}return false}};var Dialog=function(template,vars){this.open=false;this.el=document.createElement("DIV");this.el.classList.add("overlay");this.el.innerHTML=Template(template,vars);this.append=function(p){this.open=true;p.appendChild(this.el)};this.close=function(){this.open=false;if(this.el.parentNode)this.el.parentNode.removeChild(this.el)};this.listen=function(){var self=this;["click","touchstart"].forEach(function(type){self.el.addEventListener(type,function(e){if(!e.target.matches(".overlay, .close"))return;e.preventDefault();self.close()})})};this.listen()};var Editor=function(element){var editor=this;var BOLD=66;var ITALIC=73;var UNDERLINE=85;var INVERT=191;var COLOR=67;var RESET=79;var TAB=9;var UP=38;var DOWN=40;editor.el=element;editor.info=document.getElementById("color-info");editor.completion=new Completion(element);editor.history=new History(element);editor.focused=false;editor.coloring=false;editor.color="";editor.range=null;var osx=window.navigator.userAgent.match(/Macintosh/);editor.keydown=function(e,mods){if(editor.coloring){if(e.which>=48&&e.which<=57){var i=String(9-(57-e.which));editor.color+=i;e.preventDefault()}else if(e.which==188){editor.color+=",";e.preventDefault()}else{editor.coloring=false;editor.el.classList.remove("coloring");editor.info.classList.remove("open");var seq=editor.color;var parts=seq.match(/^(?:([0-9]{1,2}),?([0-9]{1,2})?)?$/);editor.color="";if(parts===null){alert("Invalid color sequence: '"+seq+"'");return}var sel=window.getSelection();var node=sel.focusNode;var range=sel.getRangeAt(0);var span=document.createElement("SPAN");span.appendChild(range.extractContents());if(typeof parts[1]!="undefined"){var i=parts[1];var c=Format.color_map[parseInt(i)];if(typeof c==="undefined"){alert("Invalid color '"+i+"' in sequence '"+seq+"'");return}span.style.color=c;span.setAttribute("data-color-fg",i);if(typeof parts[2]!="undefined"){var i=parts[2];var c=Format.color_map[parseInt(i)];if(typeof c==="undefined"){alert("Invalid color '"+i+"' in sequence '"+seq+"'");return}span.style.backgroundColor=c;span.setAttribute("data-color-bg",i)}}else{span.style.color="#000";span.style.backgroundColor="#fff";span.setAttribute("data-color-reset",1)}range.insertNode(span);if(span.textContent==""){span.textContent="​";range.setStart(span,1);range.setEnd(span,1)}}}else if(mods["meta"]&&!mods["shift"]&&!mods["ctrl"]){if(e.which==COLOR){editor.coloring=!editor.coloring;if(editor.coloring){editor.el.classList.add("coloring");editor.info.classList.add("open")}else{editor.el.classList.remove("coloring");editor.info.classList.remove("open")}return}if(e.which==RESET){var sel=window.getSelection();var range=sel.getRangeAt(0);var last=editor.el.lastChild;range.setEndAfter(last);var contents=range.extractContents();var text=document.createTextNode("​"+contents.textContent);editor.el.appendChild(text);range.setStart(text,1);range.setEnd(text,1);return}}else if(mods["ctrl"]&&!mods["shift"]&&!mods["meta"]){if(e.which==BOLD){e.preventDefault();document.execCommand("bold");return}if(e.which==INVERT){e.preventDefault();var sel=window.getSelection();var range=sel.getRangeAt(0);var span=document.createElement("SPAN");span.appendChild(range.extractContents());span.classList.add("invert");range.insertNode(span);if(span.textContent==""){span.textContent="​";range.setStart(span,1);range.setEnd(span,1)}return}if(e.which==ITALIC){e.preventDefault();document.execCommand("italic");return}if(e.which==UNDERLINE){e.preventDefault();document.execCommand("underline");return}}if(e.which==TAB&&!mods["ctrl"]){e.preventDefault();editor.completion.complete();return}editor.completion.stop();if(e.which==UP&&!mods["ctrl"]&&!mods["meta"]&&!mods["shift"]){e.preventDefault();editor.history.up();var sel=window.getSelection();var range=sel.getRangeAt(0);var last=editor.el.lastChild;if(last){range.setStartAfter(last);range.setEndAfter(last)}return}if(e.which==DOWN&&!mods["ctrl"]&&!mods["meta"]&&!mods["shift"]){e.preventDefault();editor.history.down();var sel=window.getSelection();var range=sel.getRangeAt(0);var last=editor.el.lastChild;if(last){range.setStartAfter(last);range.setEndAfter(last)}return}editor.history.reset()};editor.blur=function(){editor.focused=false};editor.focus=function(){editor.focused=true;editor.restore_selection()};editor.restore_selection=function(){if(editor.range){var s=window.getSelection();s.removeAllRanges();var range=document.createRange();range.setStart(editor.range.startContainer,editor.range.startOffset);range.setEnd(editor.range.endContainer,editor.range.endOffset);s.addRange(range)}};editor.save_selection=function(){var s=window.getSelection();if(s.rangeCount==0){editor.range=null;return}var range=s.getRangeAt(0);var node=range.commonAncestorContainer;if(editor.el.contains(node)){editor.range={startContainer:range.startContainer,endContainer:range.endContainer,startOffset:range.startOffset,endOffset:range.endOffset}}else{editor.range=null}};editor.el.addEventListener("blur",editor.blur);editor.el.addEventListener("focus",editor.focus)};var Embed={patterns:[]};var embed_id=0;Embed.embed_all=function(els,panel){els.forEach(function(el){el.querySelectorAll(".message-text a[href]").forEach(function(link){Embed.embed(link,panel)})})};Embed.embed=function(a,panel){var href=a.href;var id=embed_id++;for(var i=0;i<Embed.patterns.length;i++){if(Embed.patterns[i].test(href)){var url="//noembed.com/embed?url="+encodeURIComponent(href)+"&maxwidth=450";fetch(url).then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){if(!res.error){panel.scroll(function(){var toggle=document.createElement("SPAN");res["id"]="embed-"+String(id);toggle.setAttribute("data-embed",JSON.stringify(res));toggle.setAttribute("data-embed-id",res["id"]);toggle.setAttribute("class","embed-toggle");toggle.setAttribute("aria-hidden","true");a.parentNode.insertBefore(toggle,a.nextSibling);panel.embed(a,res)})}});return}}};Embed.load=function(){fetch("//noembed.com/providers").then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){for(provider in res){var p=res[provider].patterns;for(var i=0;i<p.length;i++){Embed.patterns.push(new RegExp(p[i]))}}})};Embed.load();var Emoji={names:{},regex:new RegExp,list:document.querySelector("#emoji ul")};Emoji.filter=function(list,text){var items=list.querySelectorAll("li");var len=items.length;if(!text){for(var i=0;i<len;i++){items[i].style.display="inline-block"}return}var t=text.toLowerCase();for(var i=0;i<len;i++){if(items[i].getAttribute("data-keywords").indexOf(t)!=-1){items[i].style.display="inline-block"}else if(items[i].getAttribute("data-name").indexOf(t)!=-1){items[i].style.display="inline-block"}else{items[i].style.display="none"}}};Emoji.load=function(){var safari=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1;
fetch("/static/emoji-data.json").then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){var codepoints=[];var length=safari?Math.min(res.length,100):res.length;var data=[];for(var i=0;i<length;i++){var annotations=res[i]["annotations"]||[];data.push({chars:res[i]["chars"],keywords:annotations.join(" ").toLowerCase(),name:res[i]["name"]});Emoji.names[res[i]["chars"]]=res[i]["name"];var surrogate="";for(var j=0;j<res[i]["codes"].length;j++){var C=parseInt(res[i]["codes"][j],16);if(C>65535){var H=Math.floor((C-65536)/1024)+55296;var L=(C-65536)%1024+56320;surrogate+="\\u"+H.toString(16)+"\\u"+L.toString(16)}else{surrogate+="\\u"+C.toString(16)}}codepoints.push(surrogate)}var sorted=codepoints.sort(function(a,b){if(a.length>b.length)return-1;else if(a.length==b.length)return 0;else return 1});Emoji.regex=new RegExp("("+sorted.join("|")+")","g");function append_chunk(){var chunk=data.splice(0,50);if(chunk.length>0){var html=Template("emoji",{emoji:chunk});Emoji.list.insertAdjacentHTML("beforeend",html)}if(chunk.length==50){window.requestAnimationFrame(append_chunk)}}window.requestAnimationFrame(append_chunk)})};var Unformat=function(html){var parser=new DOMParser;var doc=parser.parseFromString(html,"text/html");return Unformat.descend(doc,"")};Unformat.descend=function(node,string){if(node.nodeType==3){string+=node.textContent}else if(node.nodeType==1||node.nodeType==9){if(Unformat.block.indexOf(node.nodeName)!=-1)string+="\n";if(Unformat.tags[node.nodeName])string+=Unformat.tags[node.nodeName];if(node.nodeType==1){if(node.classList&&node.classList.contains("invert"))string+=Unformat.invert;if(node.hasAttribute("data-color-fg")){string+=""+node.getAttribute("data-color-fg");if(node.hasAttribute("data-color-bg")){string+=","+node.getAttribute("data-color-bg")}}if(node.hasAttribute("data-color-reset"))string+=""}for(var i=0;i<node.childNodes.length;i++){string=Unformat.descend(node.childNodes[i],string)}if(Unformat.tags[node.nodeName])string+=Unformat.tags[node.nodeName]}return string};Unformat.block=["DIV"];Unformat.tags={B:"",U:"",I:""};Unformat.invert="";var Format=function(text){var tokens=text.split(Format.token_re);return Format.parse([],tokens).filter(function(item){return item.text!=""}).map(function(item){var span=document.createElement("SPAN");span.textContent=item.text;if(item.background!=null)span.style.backgroundColor=Format.color_map[parseInt(item.background)];if(item.color!=null)span.style.color=Format.color_map[parseInt(item.color)];if(item.bold)span.style.fontWeight="bold";if(item.italic)span.style.fontStyle="italic";if(item.underline)span.style.textDecoration="underline";return Format.linkify(span)})};Format.url_re=/(https?:\/\/[^\s<"]*)/gi;Format.token_re=/(\d{0,2}(?:,\d{1,2})?|||||)/;Format.linkify=function(elem){var children=elem.childNodes;var length=children.length;var tmp=document.createElement("SPAN");for(var i=0;i<length;i++){var node=children[i];if(node.nodeName=="A"){continue}else if(node.nodeName!="#text"){Format.linkify(node);continue}if(node.nodeValue===null){continue}if(!node.nodeValue){console.log(node)}if(node.nodeValue&&node.nodeValue.match(Format.url_re)){var span=document.createElement("SPAN");tmp.textContent=node.nodeValue;var escaped=tmp.innerHTML;span.innerHTML=escaped.replace(Format.url_re,'<a href="$1" target="_blank" rel="noreferrer">$1</a>');node.parentNode.replaceChild(span,node);node=span}if(node.nodeValue&&Emoji.regex.test(node.nodeValue)){var chars=node.nodeValue.match(Emoji.regex);var span=document.createElement("SPAN");tmp.textContent=node.nodeValue;var escaped=tmp.innerHTML;for(var j=0;j<chars.length;j++){var title=Emoji.names[chars[j]];escaped=escaped.replace(new RegExp(chars[j],"g"),'<span class="emoji" title="'+title+'">'+chars[j]+"</span>")}span.innerHTML=escaped;node.parentNode.replaceChild(span,node)}}return elem};Format.make=function(){return{text:"",color:null,background:null,bold:false,italic:false,underline:false}};Format.clone=function(node){return{text:"",color:node.color,background:node.background,bold:node.bold,italic:node.italic,underline:node.underline}};Format.color_map=["white","black","navy","green","red","maroon","purple","olive","yellow","lightgreen","teal","cyan","royalblue","magenta","gray","lightgray"];Format.parse=function(acc,tokens){if(tokens.length==0)return acc;var token=tokens.shift();var head=acc.length?acc[acc.length-1]:Format.make();var node=Format.clone(head);switch(token.substring(0,1)){case"":var colors=token.substring(1).split(",",2);node.color=colors[0];node.background=colors[1];break;case"":node.bold=!head.bold;break;case"":node=Format.make();break;case"":node.italic=!head.italic;break;case"":node.underline=!head.underline;break;case"":node.color=head.background===null?0:head.background;node.background=head.color===null?1:head.color;break;default:node.text+=token}acc.push(node);return Format.parse(acc,tokens)};var History=function(element){this.el=element;this.limit=10;this.history=[];var EMPTY="";var index=null;var current=null;this.up=function(){var history=this.history.concat(this.tail());if(index===null){index=0}else if(++index>=history.length){index=0}this.el.innerHTML=history[index]};this.tail=function(rev){var current=this.current();var tail=[EMPTY];if(current!=EMPTY)tail.push(current);return tail};this.current=function(){if(current===null){current=this.el.innerHTML}return current};this.reset=function(){current=null;index=null};this.down=function(){var history=this.history.concat(this.tail(true));if(index===null){index=0}else if(--index<0){index=history.length-1}this.el.innerHTML=history[index]};this.record=function(){this.history.unshift(this.el.innerHTML);current=null;if(this.history.length>this.limit)this.history=this.history.slice(0,this.limit)}};var Notifier=function(app){var notifier=this;notifier.subscribed=false;if("serviceWorker"in navigator){navigator.serviceWorker.register("/service-worker.js").then(function(){notifier.setup()})}notifier.setup=function(){if(!("showNotification"in ServiceWorkerRegistration.prototype)){console.log("Notifications not supported.");return}if(Notification.permission==="denied"){console.log("User blocked notifications.");return}if(!("PushManager"in window)){console.log("Push notifications not supported.");return}navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.getSubscription().then(function(subscription){if(subscription){notifier.set_enabled(true,subscription)}})})};notifier.unsubscribe=function(){navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.getSubscription().then(function(subscription){if(!subscription){notifier.set_enabled(false);return}subscription.unsubscribe().then(function(){notifier.set_enabled(false)}).catch(function(e){console.log("Failed to unsubscribe",e)})}).catch(function(e){console.log("Error unsubscribing",e)})})};notifier.subscribe=function(){navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true}).then(function(subscription){notifier.set_enabled(true,subscription)}).catch(function(e){if(Notification.permission==="denied"){console.log("Notifier permission denied")}else{console.log("Unable to subscribe",e)}notifier.set_enabled(false)})})};notifier.build_pref=function(sub){var rawKey=sub.getKey?sub.getKey("p256dh"):"";var key=rawKey?btoa(String.fromCharCode.apply(null,new Uint8Array(rawKey))):"";var rawAuthSecret=sub.getKey?sub.getKey("auth"):"";var authSecret=rawAuthSecret?btoa(String.fromCharCode.apply(null,new Uint8Array(rawAuthSecret))):"";return{endpoint:sub.endpoint,key:key,auth:authSecret}};notifier.set_enabled=function(bool,sub){notifier.subscribed=bool;if(bool){if(sub){app.update_pref("gcm_sub",notifier.build_pref(sub))}document.getElementById("web-notify").classList.add("enabled")}else{app.update_pref("gcm_sub",null);document.getElementById("web-notify").classList.remove("enabled")}}};var Panel=function(name,id,connection,mobile){var panel=this;panel.name=name;panel.id=id;panel.connection=connection.id;panel.unread=false;panel.missed=false;panel.connected=connection.connected;panel.highlighted=false;panel.type=determine_panel_type(name,connection.chantypes);panel.focused=false;panel.backlog_empty=false;panel.reactions=[];panel.monospace_nicks=[];panel.ignore_events=false;panel.collapse_embeds=false;panel.show_nicklist=false;panel.first_focus=true;panel.last_seen=null;panel.path=window.location.pathname+"#/"+connection.id+"/"+encodeURIComponent(name);panel.mode="";panel.network=connection.host;panel.mobile=mobile;panel.change_name=function(name){panel.name=name;panel.update_nav()};function determine_panel_type(name,chantypes){if(name=="status")return"status";if(chantypes.indexOf(name[0])!=-1)return"channel";return"private"}panel.update_mode=function(mode){panel.mode=mode;panel.update_nav()};panel.update_nicks=function(nicks){var order=["@","+"];var sorted=Object.keys(nicks).map(function(n){return[n,n.toLowerCase()]}).sort(function(a,b){return a[1]<b[1]?-1:a[1]>b[1]?1:0}).map(function(n){return n[0]});var display_sorted=sorted.map(function(n){var pos=order.indexOf(nicks[n]);var prefix=""+(pos!=-1?pos:order.length);return[n,prefix+n.toLowerCase()]}).sort(function(a,b){return a[1]<b[1]?-1:a[1]>b[1]?1:0});var list=panel.elem.nicks;var items=list.querySelectorAll("li");var l=items.length;var del=[];for(var i=0;i<l;i++){var a=items[i].querySelector("a");var nick=a.getAttribute("data-nick");if(!(nick in nicks)){del.push(items[i])}}var sorted_len=display_sorted.length;for(var i=0;i<sorted_len;i++){var nick=display_sorted[i][0];var order=display_sorted[i][1];var inserted=false;for(var j=0;j<l;j++){var item=items[j];var a=item.querySelector("a");var n=a.getAttribute("data-nick");var o=a.getAttribute("data-nick-order");if(n==nick){var text=a.textContent;var display=nicks[nick]+nick;if(text!=display){a.textContent=display;a.setAttribute("data-nick-order",order)}inserted=true;break}else if(o>order){var html=Template("nick",{nick:nick,order:order,sigil:nicks[nick]});item.insertAdjacentHTML("beforebegin",html);inserted=true;break}}if(!inserted){var html=Template("nick",{nick:nick,order:order,sigil:nicks[nick]});list.insertAdjacentHTML("beforeend",html)}}for(var i=0;i<del.length;i++){list.removeChild(del[i])}};panel.focus=function(){if(panel.ignore_events)panel.elem.body.classList.add("hide-events");else panel.elem.body.classList.remove("hide-events");if(panel.collapse_embeds)panel.elem.body.classList.add("hide-embeds");else panel.elem.body.classList.remove("hide-embeds");if(panel.show_nicklist)panel.elem.body.classList.add("show-nicklist");else panel.elem.body.classList.remove("show-nicklist");panel.first_focus=false;panel.focused=true;panel.resize_filler();if(!panel.mobile)panel.elem.input.focus();panel.unread=false;panel.missed=false;panel.highlighted=false;panel.update_nav();panel.scroll_bottom(0);setTimeout(function(){panel.scroll_bottom(0)},10)};panel.build_nav=function(){var html=Template("nav_item",{name:panel.name,status:panel.type=="status",id:panel.id});var el=document.createElement("DIV");el.innerHTML=html;return el.firstChild};panel.update_nav=function(){panel.elem.nav.querySelector(".panel-name").textContent=panel.name;if(panel.focused){panel.elem.nav.classList.add("active");panel.elem.nav.classList.remove("unread","missed","highlighted","disconnected");if(!panel.connected)panel.elem.nav.classList.add("disconnected")}else{panel.elem.nav.classList.remove("active");if(panel.unread)panel.elem.nav.classList.add("unread");if(panel.missed)panel.elem.nav.classList.add("missed");if(panel.highlighted)panel.elem.nav.classList.add("highlighted");if(panel.connected)panel.elem.nav.classList.remove("disconnected");else panel.elem.nav.classList.add("disconnected")}var prefix=panel.name;var title=panel.network;if(panel.mode){prefix+=" (+"+panel.mode+")";title+=" (+"+panel.mode+")"}panel.elem.prefix.textContent=prefix;panel.elem.prefix.setAttribute("title",panel.network);panel.elem.nav.setAttribute("title",title);panel.elem.nav.setAttribute("data-name",panel.name)};panel.update_seen=function(){var id=panel.latest_message_id();if(id)panel.last_seen=id};panel.unfocus=function(){panel.update_seen();panel.focused=false;panel.elem.nav.classList.remove("active");panel.clear_lists();panel.backlog_empty=false};panel.remove_elems=function(){["nav","prefix","filler","topic","nicks","input","list"].forEach(function(el){if(panel.elem[el].parentNode)panel.elem[el].parentNode.removeChild(panel.elem[el])})};panel.clear_lists=function(){var list=panel.elem.list;while(list.firstChild){list.removeChild(list.firstChild)}var nicks=panel.elem.nicks;while(nicks.firstChild){nicks.removeChild(nicks.firstChild)}};panel.prepend=function(els){var list=panel.elem.list;var prev_time,prev_nick,prev_mono;var length=els.length;for(var i=length-1;i>=0;i--){var el=els[i];el.classList.add("loading");if(!el.matches("li.chat"))continue;var time=el.querySelector("time");if(time){if(time.innerHTML==prev_time)time.className="hidden";prev_time=time.innerHTML}if(el.classList.contains("message")){var nick=el.querySelector(".message-nick").getAttribute("data-nick");if(panel.monospace_nicks.indexOf(nick)!=-1){el.classList.add("monospace");if(!prev_mono){el.classList.add("monospace-start")}prev_mono=true}else{if(prev_mono&&els[i+1]){els[i+1].classList.add("monospace-end")}prev_mono=false}if(nick==prev_nick){el.classList.add("consecutive")}prev_nick=nick}else{if(prev_mono&&els[i+1])els[i+1].classList.add("monospace-end");prev_nick=null;prev_mono=null}}panel.scroll(function(){for(var i=0;i<els.length;i++){if(list.childNodes.length){list.insertBefore(els[i],list.childNodes[0])}else{list.appendChild(els[i])}}});requestAnimationFrame(function(){for(var i=0;i<els.length;i++){els[i].classList.add("loaded")}});for(var i=0;i<els.length;i++){panel.imagify(els[i]);panel.vidify(els[i]);panel.audify(els[i]);panel.emojify(els[i])}Embed.embed_all(els,panel);panel.last_seen_separator()};panel.emojify=function(el){var message=el.querySelector(".message-text");if(!message)return;var emojis=message.querySelectorAll("span.emoji");if(emojis.length!=1)return;var e=emojis[0];if(e.innerText!=message.innerText)return;panel.scroll(function(){var wrap=document.createElement("DIV");wrap.className="emoji-wrap";e.parentNode.removeChild(e);e.className="emoji-large";wrap.appendChild(e);message.appendChild(wrap)})};panel.embed=function(a,embed,manual){if(!manual&&panel.collapse_embeds){var toggle=a.nextSibling;while(toggle&&!toggle.classList.contains("embed-toggle")){toggle=toggle.nextSibling}if(toggle&&toggle.classList.contains("embed-toggle")){toggle.classList.add("hidden")}return}var li=a.parentNode;while(li.nodeName!="LI"){li=li.parentNode}if(embed.provider_name=="Twitter"){embed.html=new Handlebars.SafeString(embed.html.replace(/<script[^>]+>.*<\/script>/,"").replace(/twitter-tweet/,""))}var html=Template("embed",{provider_name_lc:embed.provider_name.toLowerCase(),provider_name:embed.provider_name,id:embed.id,thumbnail_url:embed.thumbnail_url,title:embed.title,description:embed.desciption,html:embed.html,use_html:embed.provider_name=="Twitter"});panel.scroll(function(){li.querySelector(".message-text").insertAdjacentHTML("beforeend",html)})};panel.is_scrolled=function(){return panel.scroll_bottom()<10};panel.append=function(el){if(el===undefined)return;if(panel.focused){var id=el.getAttribute("data-message-id");if(id&&panel.elem.list.querySelectorAll('li[data-message-id="'+id+'"]').length)return;panel.scroll(function(){panel.elem.list.appendChild(el);if(el.classList.contains("chat")){var nick_el=el.querySelector("span[data-nick]");var nick=nick_el?nick_el.getAttribute("data-nick"):"";var prev=el.previousSibling;if(el.classList.contains("message")&&prev&&prev.classList.contains("message")){var prev_nick_el=prev.querySelector("span[data-nick]");var prev_nick=prev_nick_el?prev_nick_el.getAttribute("data-nick"):"";if(nick==prev_nick)el.classList.add("consecutive")}if(prev&&prev.classList.contains("chat")){var time=el.querySelector("time");var prev_time=prev.querySelector("time");if(time&&prev_time&&time.textContent==prev_time.textContent)time.classList.add("hidden")}if(el.classList.contains("message")&&panel.monospace_nicks.indexOf(nick)!=-1){el.classList.add("monospace");if(prev&&!prev.classList.contains("monospace")){el.classList.add("monospace-start")}}else{if(prev&&prev.classList.contains("monospace"))prev.classList.add("monospace-end")}if(el.classList.contains("message")){panel.imagify(el);panel.vidify(el);panel.audify(el);panel.emojify(el);Embed.embed_all([el],panel)}}})}else{el.innerHTML="";if(el.classList.contains("message")){panel.unread=true;if(el.classList.contains("highlight"))panel.highlighted=true;panel.update_nav()}else if(el.classList.contains("event")&&!panel.ignore_events){panel.missed=true;panel.update_nav()}}};panel.resize_filler=function(){if(!panel.focused)return;var scroll=panel.scroller.clientHeight;var chat=panel.elem.list.clientHeight;panel.elem.filler.style.height=Math.max(0,scroll-chat)+"px"};panel.scroll_jump=0;panel.scrolling=false;panel.scroll=function(cb){var nested=panel.scrolling;panel.scroll_jump=panel.scroll_bottom();panel.scrolling=true;if(cb)cb();if(!nested){if(panel.focused){panel.scroll_bottom(panel.scroll_jump);panel.resize_filler()}panel.scrolling=false}};panel.set_disabled=function(bool){if(bool){panel.elem.input.setAttribute("contenteditable","false");panel.elem.input.classList.add("disabled")}else{panel.elem.input.setAttribute("contenteditable","true");panel.elem.input.classList.remove("disabled")}};panel.latest_message_id=function(){var els=panel.elem.list.querySelectorAll("li[data-message-id]");if(els.length){return parseInt(els[els.length-1].getAttribute("data-message-id"))}return null};panel.oldest_message_id=function(){var els=panel.elem.list.querySelectorAll("li[data-message-id]");if(els.length){return parseInt(els[0].getAttribute("data-message-id"))}return null};panel.update_topic=function(topic){while(panel.elem.topic.firstChild){panel.elem.topic.removeChild(panel.elem.topic.firstChild)}Format(topic.value).forEach(function(el){panel.elem.topic.appendChild(el)});if(topic.user&&topic.time){var date=new Date(topic.time*1e3);panel.elem.topic.setAttribute("title","set by "+topic.user+" on "+date)}};panel.elem={input:document.createElement("DIV"),list:document.createElement("OL"),nicks:document.createElement("UL"),topic:document.createElement("P"),filler:document.createElement("DIV"),prefix:document.createElement("SPAN"),nav:panel.build_nav(),body:document.body};panel.elem.input.setAttribute("contenteditable","true");panel.elem.input.setAttribute("data-panel-id",id);panel.elem.input.classList.add("input");panel.elem.filler.classList.add("filler");panel.elem.prefix.textContent=panel.name;panel.elem.topic.textContent="No topic set";panel.scroller=document.getElementById("panel-scroll");panel.inner=document.getElementById("panel-inner-scroll");panel.prune=function(){if(panel.focused&&!panel.is_scrolled())return;var els=Array.prototype.filter.call(panel.elem.list.querySelectorAll("li.chat"),function(el){return getComputedStyle(el).display!="none"});var l=els.length;if(l>300){els.slice(0,l-300).forEach(function(el){el.parentNode.removeChild(el)})}};panel.editor=new Editor(panel.elem.input);setInterval(panel.prune,1e3*60);panel.img_re=/^http[^\s]*\.(?:jpe?g|gif|png|bmp|svg)[^\/]*$/i;panel.imagify=function(elem){var links=elem.querySelectorAll("a");var message=elem.querySelector(".message-text");if(!message)return;for(var i=links.length-1;i>=0;i--){var link=links[i];if(link.href.match(panel.img_re)){if(link.href.match(/\.gifv/))continue;if(link.href.match(/#(nsfw|hide)/))continue;var image=new Image;image.setAttribute("title",link.href);image.onload=function(image,link){return function(e){var s=panel.scroller;var wrap=document.createElement("DIV");var a=link.cloneNode(false);var toggle=document.createElement("SPAN");a.appendChild(image);panel.scroll(function(){if(panel.collapse_embeds){toggle.setAttribute("class","image-toggle hidden");wrap.setAttribute("class","image-wrap hidden")}else{toggle.setAttribute("class","image-toggle");wrap.setAttribute("class","image-wrap")}toggle.setAttribute("aria-hidden","true");link.parentNode.insertBefore(toggle,link.nextSibling);wrap.appendChild(a);message.appendChild(wrap)});toggle.addEventListener("click",function(e){e.preventDefault();var hidden=wrap.classList.contains("hidden");if(hidden){panel.scroll(function(){wrap.classList.remove("hidden");toggle.classList.remove("hidden")})}else{wrap.classList.add("hidden");toggle.classList.add("hidden")}})}}(image,link);image.src="https://noembed.com/i/0/600/"+link.href}}};panel.vid_re=/^http[^\s]*\.(?:gifv|mp4)[^\/]*$/i;panel.vidify=function(elem){var links=elem.querySelectorAll("a");var message=elem.querySelector(".message-text");if(!message)return;for(var i=links.length-1;i>=0;i--){var link=links[i];if(link.href.match(panel.vid_re)){if(link.href.match(/i\.imgur\.com\/[^\/\.]+\.gifv/))link.href=link.href.replace(".gifv",".mp4");if(link.href.match(/http:\/\/i\.imgur\.com/))link.href=link.href.replace(/^http/,"https");var video=document.createElement("VIDEO");video.controls="controls";video.preload="metadata";video.addEventListener("loadeddata",function(video,link){return function(e){var s=panel.scroller;var wrap=document.createElement("DIV");var toggle=document.createElement("SPAN");panel.scroll(function(){if(panel.collapse_embeds){toggle.setAttribute("class","image-toggle hidden");wrap.setAttribute("class","image-wrap hidden")}else{toggle.setAttribute("class","image-toggle");wrap.setAttribute("class","image-wrap")}toggle.setAttribute("aria-hidden","true");link.parentNode.insertBefore(toggle,link.nextSibling);wrap.appendChild(video);message.appendChild(wrap)});toggle.addEventListener("click",function(e){e.preventDefault();var hidden=wrap.classList.contains("hidden");if(hidden){panel.scroll(function(){wrap.classList.remove("hidden");toggle.classList.remove("hidden")})}else{wrap.classList.add("hidden");toggle.classList.add("hidden")}})}}(video,link),false);video.src=link.href;video.load()}}};panel.aud_re=/^http[^\s]*\.(?:mp3|wav|aac|m4a)[^\/]*$/i;panel.audify=function(elem){var links=elem.querySelectorAll("a");var message=elem.querySelector(".message-text");if(!message)return;for(var i=links.length-1;i>=0;i--){var link=links[i];if(link.href.match(panel.aud_re)){var audio=document.createElement("AUDIO");audio.controls="controls";audio.addEventListener("loadeddata",function(audio,link){return function(e){panel.scroll(function(){var wrap=document.createElement("DIV");message.appendChild(wrap);link.parentNode.removeChild(link);wrap.appendChild(link);link.innerHTML="";link.appendChild(audio);wrap.className="image-wrap"})}}(audio,link),false);audio.src=link.href;audio.load()}}};panel.react_backlog_check=function(){panel.reactions.forEach(function(reaction,i){var li=panel.elem.list.querySelector('li[data-message-hash="'+reaction[1]+'"]');if(li){panel.handle_reaction.apply(panel,reaction);panel.reactions.slice(i,1)}})};panel.handle_reaction=function(from,hash,reaction){if(!hash){console.log(from,hash,reaction);return}var li=panel.elem.list.querySelector('li[data-message-hash="'+hash+'"]');if(li){panel.scroll(function(){var reactions=li.querySelector(".reactions");if(!reactions){reactions=document.createElement("DIV");reactions.classList.add("reactions");li.appendChild(reactions)}var span=document.createElement("SPAN");span.textContent=reaction;span.setAttribute("title",from);if(reactions.firstChild){reactions.insertBefore(span,reactions.firstChild)}else{reactions.appendChild(span)}})}else{panel.reactions.push([from,hash,reaction])}};panel.set_loading=function(on){if(on){panel.elem.list.classList.add("loading")}else{panel.elem.list.classList.remove("loading")}};panel.set_collapse_embeds=function(bool){panel.scroll(function(){if(panel.focused){if(bool){panel.elem.body.classList.add("hide-embeds");panel.elem.list.querySelectorAll(".embed-toggle:not(.hidden)").forEach(function(el){el.click()});panel.elem.list.querySelectorAll(".image-toggle:not(.hidden)").forEach(function(el){el.click()})}else{panel.elem.body.classList.remove("hide-embeds");panel.elem.list.querySelectorAll(".embed-toggle.hidden").forEach(function(el){el.click()});panel.elem.list.querySelectorAll(".image-toggle.hidden").forEach(function(el){el.click()})}}panel.collapse_embeds=bool})};panel.set_ignore_events=function(bool){panel.scroll(function(){if(panel.focused){if(bool)panel.elem.body.classList.add("hide-events");else panel.elem.body.classList.remove("hide-events")}panel.ignore_events=bool})};panel.set_connected=function(bool,message){panel.connected=bool;panel.update_nav()};panel.set_show_nicklist=function(bool){panel.scroll(function(){if(bool)panel.elem.body.classList.add("show-nicklist");else panel.elem.body.classList.remove("show-nicklist");panel.show_nicklist=bool})};panel.add_monospace_nick=function(nick){if(panel.monospace_nicks.indexOf(nick)==-1){panel.monospace_nicks.push(nick)}panel.scroll(function(){panel.elem.list.querySelectorAll('li.message .message-nick[data-nick="'+nick+'"]').forEach(function(line){line.parentNode.parentNode.classList.add("monospace")})})};panel.remove_monospace_nick=function(nick){var i=panel.monospace_nicks.indexOf(nick);if(i!=-1){panel.monospace_nicks.splice(i,1)}panel.scroll(function(){panel.elem.list.querySelectorAll('li.message .message-nick[data-nick="'+nick+'"]').forEach(function(line){line.parentNode.parentNode.classList.remove("monospace","monospace-start","monospace-end")})})};panel.last_seen_separator=function(){if(panel.last_seen){var msg=panel.elem.list.querySelector('li[data-message-id="'+panel.last_seen+'"]');if(!msg)return;var next_visible;while(msg.nextSibling){if(msg.nodeType==1&&getComputedStyle(msg.nextSibling).display!="none"){next_visible=msg.nextSibling;break}msg=msg.nextSibling}if(next_visible){panel.scroll(function(){var sep=panel.elem.list.querySelector(".last-read");if(sep){sep.parentNode.removeChild(sep)}sep=document.createElement("DIV");sep.classList.add("last-read");msg.parentNode.insertBefore(sep,msg.nextSibling);if(msg.classList.contains("monospace")){msg.classList.add("monospace-end")}})}}};panel.scroll_bottom=function(set){var s=panel.scroller.scrollHeight;if(set!==undefined){if(set<=5){panel.scroller.scrollTop=s;return set}var h=panel.scroller.clientHeight;var t=s-h-set;panel.scroller.scrollTop=t;if(window.navigator.userAgent.match(/iP(hone|ad)/i)){panel.scroller.style.overflowY="hidden";requestAnimationFrame(function(){panel.scroller.style.overflowY="visible"})}return set}var s=panel.scroller.scrollHeight;var h=panel.scroller.clientHeight;var t=panel.scroller.scrollTop;var b=s-(t+h);return b}};var Render=function(message,force_raw){if(force_raw)return raw(message);switch(String(message.Command)){case"NICK":var old=message.Prefix.Name;var nick=message.Params[0];message.Prefix.Name=nick;return append(make("event",message),[make_text(old+" is now known as "),make_nick(message),timestamp(message)]);case"PART":var nick=message.Prefix.Name;var name=message.Params[0];var msg=message.Params[1];return append(make("event",message),[make_nick(message),make_text(" has left"+(msg?" ("+msg+")":"")),timestamp(message)]);case"MODE":if(message.Prefix.Nick==message.Params[0]){return raw(message)}else{var channel=message.Params[0];return append(make("event",message),[make_text(message.Params.slice(1).join(" ")),make_text(" by "+message.Prefix.Name),timestamp(message)])}case"QUIT":var nick=message.Prefix.Name;var msg=message.Params[0];return append(make("event",message),[make_nick(message),make_text(" has quit"+(msg?" ("+msg+")":"")),timestamp(message)]);case"JOIN":var name=message.Params[0];var nick=message.Prefix.Name;return append(make("event",message),[make_nick(message),make_text(" has joined the channel"),timestamp(message)]);case"332":var name=message.Params[1];var text=message.Params[2];var span=append(make_text(),[make_text("Topic: ")].concat(Format(text)));return append(make("event",message),[span]);case"TOPIC":var nick=message.Prefix.Name;var name=message.Params[0];var text=message.Params[1];var span=append(make_text(),[make_nick(message),make_text(" changed the topic: ")].concat(Format(text)));return append(make("event",message),[span,timestamp(message)]);case"PRIVMSG":var nick=message.Prefix.Name;if(message.Params.length<2)return;var name=message.Params[0];var text=message.Params[1];if(!name.length||!text.length)return raw(message);var from=make_nick(message);var color=string_to_color(message.Prefix.User||nick);var wrap=make_text();wrap.setAttribute("class","message-text");from.style.color=color;var msg=make_text();msg.setAttribute("class","message-text-pre");wrap.appendChild(msg);if(text.substring(0,1)==""){if(text.substring(1,7)=="ACTION"){from.textContent="* "+nick+" ";var action=text.substring(8).replace(/$/,"");append(msg,Format(action))}else{return}}else{from.textContent="< "+nick+"> ";append(msg,Format(text))}var hash=md5(message.Raw);var li=make("message",message);li.setAttribute("data-message-hash",hash);return append(li,[flex(from,wrap,timestamp(message)),controls(message)]);case"NOTICE":var name=message.Prefix.Name;var text=message.Params[1];var chan=make_text(name);chan.setAttribute("class","channel");var span=append(make_text(" "),Format(text));return append(make("raw notice",message),[chan,span]);case"CONNECT":if(message.Params.length!=1)return;var host=message.Prefix.Name;var span=make_text(host+" ");span.setAttribute("class","host");return append(make("raw notice",message),[span,message.Params[0]]);case"DISCONNECT":if(message.Params.length!=1)return;var host=message.Prefix.Name;var span=make_text(host+" ");span.setAttribute("class","host");return append(make("raw notice",message),[span,message.Params[0]]);default:return raw(message)}function append(node,children){for(var i=0;i<children.length;i++){if(typeof children[i]==="string"){node.appendChild(document.createTextNode(children[i]))}else{try{node.appendChild(children[i])}catch(e){console.log(e,children[i])}}}return node}function make_text(text){var el=document.createElement("SPAN");if(text)el.textContent=text;return el}function make_nick(message){var prefix=message.Prefix.Name+"!"+message.Prefix.User+"@"+message.Prefix.Server;var el=document.createElement("SPAN");el.setAttribute("data-nick",message.Prefix.Name);el.setAttribute("title",prefix);el.classList.add("message-nick");el.textContent=message.Prefix.Name;return el}function raw(message){var text="";if(message.Command.match(/^[45][0-9][0-9]$/))text=message.Params.join(" ");else if(message.Command.match(/^[0-9][0-9][0-9]$/))text=message.Params.slice(1).join(" ");else text=[message.Prefix.Name,message.Command].concat(message.Params).join(" ");var raw=make("raw",message);raw.textContent=text;return raw}function timestamp(message){var date=new Date(message.Time*1e3);var h=String(date.getHours());if(h.length<2)h="0"+h;var m=String(date.getMinutes());if(m.length<2)m="0"+m;var time=document.createElement("TIME");time.setAttribute("data-time",message.Time);time.setAttribute("title",date.toString());time.textContent=h+":"+m;return time}function controls(message){var controls=document.createElement("DIV");controls.classList.add("message-controls","popup-toggle");if(!message.Prefix.Self){var react=document.createElement("DIV");react.classList.add("message-react","popup-toggle");controls.appendChild(react)}var menu=document.createElement("DIV");menu.classList.add("message-menu","popup-toggle");controls.appendChild(menu);return controls}function make(type,message){var li=document.createElement("LI");li.classList.add("chat",message.Command.toLowerCase());var classes=type.split(" ");for(var i=0;i<classes.length;i++){li.classList.add(classes[i])}if(message.Prefix.Self)li.classList.add("self");if(message.Highlight)li.classList.add("highlight");
if(message.Search)li.classList.add("search");if(message.Id)li.setAttribute("data-message-id",message.Id);return li}function flex(){var wrap=document.createElement("DIV");wrap.setAttribute("class","message-flex");for(var i=0;i<arguments.length;i++){wrap.appendChild(arguments[i])}return wrap}function string_to_color(str){var colors=["MediumVioletRed","PaleVioletRed","DeepPink","HotPink","Red","DarkRed","FireBrick","Crimson","IndianRed","Orange","DarkOrange","Coral","Tomato","OrangeRed","Maroon","Brown","Sienna","SaddleBrown","Chocolate","Peru","DarkGoldenrod","Goldenrod","MidnightBlue","MediumBlue","Blue","RoyalBlue","SteelBlue","CornflowerBlue","DodgerBlue","DeepSkyBlue","LightSkyBlue","SkyBlue","MediumSlateBlue","SlateBlue","DarkSlateBlue","Indigo","Purple","DarkMagenta","DarkOrchid","DarkViolet"];var c=0;var m=colors.length;for(var i=0;i<str.length;i++){c=((c<<5)+str.charCodeAt(i))%m}return colors[c]}};var Stream=function(baseurl){var stream=this;stream.baseurl=baseurl;stream.retries=0;stream.eventsource=null;stream.last_id=null;var listeners={};stream.on=function(name,func){if(!listeners[name])listeners[name]=[];listeners[name].push(func)};stream.fire=function(name){if(listeners[name]){var data=Array.prototype.slice.call(arguments,1);listeners[name].forEach(function(listener){data.unshift(listener,0);setTimeout.apply(undefined,data)})}};function connect(){var url=stream.baseurl+"/events";var es=new EventSource(url);es.addEventListener("irc",stream.onmessage);es.addEventListener("open",stream.onopen);es.addEventListener("error",stream.close);stream.eventsource=es;stream.timer=null}stream.connect=function(){if(stream.eventsource)stream.eventsource.close();var backoff=Math.max(3,Math.min(stream.retries++,15));console.log("reconnecting in "+backoff+" seconds");stream.fire("reconnect-status","Reconnecting in "+backoff+" seconds");function count(){if(--backoff<=0){clearTimeout(stream.timer);connect()}else{stream.fire("reconnect-status","Reconnecting in "+backoff+" seconds");stream.timer=setTimeout(count,1e3)}}stream.timer=setTimeout(count,1e3)};stream.onconnect=function(e){var data=JSON.parse(e.data);stream.fire("connect",data)};stream.onopen=function(){stream.fire("open");stream.retries=0};stream.onmessage=function(e){var data=JSON.parse(e.data);if(data.Message.Command=="CREATE"){stream.fire("create_connection",data)}else if(data.Message.Command=="DELETE"){stream.fire("delete_connection",data)}else{if(data.MessageId)stream.last_id=data.MessageId;stream.fire("message",data)}};stream.close=function(){if(stream.eventsource)stream.eventsource.close()};stream.check=function(){if(!stream.timer){if(stream.retries==0&&(!stream.eventsource||stream.eventsource.readyState!=1)){stream.fire("close");console.log("closed")}if(!stream.eventsource||stream.eventsource.readyState==2){stream.connect()}else if(stream.eventsource.readyState==0){if(stream.retries==0){stream.retries=1}console.log("reconnecting now");stream.fire("reconnect-status","Reconnecting now")}}};connect();var timer=setInterval(stream.check,1e3);stream.destroy=function(){clearInterval(timer);listeners={};if(stream.eventsource){stream.eventsource.removeEventListener("irc",stream.onmessage);stream.eventsource.removeEventListener("open",stream.onopen);stream.eventsource.close()}stream=null}};var Template=function(name,vars){return Handlebars.templates[name](vars)};var UIEvents=function(app){var app=app;var events=this;var max_userhost_len=63+10+1;var lang=window.navigator.language;function clickTouchEvent(el,f){["click","touch"].forEach(function(type){el.addEventListener(type,f)})}document.addEventListener("keydown",function(e){var mods={meta:e.altKey,shift:e.shiftKey,ctrl:e.ctrlKey,cmd:e.metaKey};if(e.which==27&&app.overlayed()){app.close_dialog();return}else if(app.overlayed()){return}else if(e.which==27){var open=document.querySelectorAll(".popup-toggle.open");open.forEach(function(el){el.classList.remove("open")})}if(app.elem.switcher.classList.contains("open")){if(e.which==27){app.hide_switcher();app.focus_input();return}else if(e.which==40&&mods["ctrl"]||e.which==9){e.preventDefault();var items=app.elem.nav.querySelectorAll("li[data-name].candidate.match");for(var i=1;i<items.length;i++){if(items[i-1].classList.contains("selected")){items[i-1].classList.remove("selected");items[i].classList.add("selected");return}}}else if(e.which==38&&mods["ctrl"]){e.preventDefault();var items=app.elem.nav.querySelectorAll("li[data-name].candidate.match");for(var i=0;i<items.length-1;i++){if(items[i+1].classList.contains("selected")){items[i+1].classList.remove("selected");items[i].classList.add("selected");return}}}else if(e.which==13){var selected=app.elem.nav.querySelector("li.selected");if(selected){e.preventDefault();var id=selected.getAttribute("data-panel-id");app.focus_panel(id);app.hide_switcher();return}}}if(e.which==13&&!mods["shift"]){e.preventDefault();send_submit();return}else if(e.which==38&&mods["meta"]){e.preventDefault();mods["shift"]?app.prev_unread_panel():app.prev_panel();return}else if(e.which==40&&mods["meta"]){e.preventDefault();mods["shift"]?app.next_unread_panel():app.next_panel();return}else if((e.which==75||e.which==84)&&mods["meta"]){e.preventDefault();app.toggle_switcher();return}var c=String.fromCharCode(e.which);if((mods["cmd"]||!mods["ctrl"]&&mods["meta"])&&c.match(/^[1-9]$/)){var panels=app.elem.nav.querySelectorAll("#channels li,#privates li");if(panels[c-1]){app.focus_panel(panels[c-1].getAttribute("data-panel-id"));return}}if(app.focused){if(app.focused.editor.focused){app.focused.editor.keydown(e,mods)}else if(e.target.nodeName!="INPUT"&&e.target.nodeName!="TEXTAREA"&&!mods["meta"]&&!mods["ctrl"]&&!mods["cmd"]&&(c.match(/[a-zA-Z0-9\/]/)||e.which==191)){app.focus_input()}}});app.elem.switcher.addEventListener("input",function(e){var val=app.elem.switcher.querySelector("input").value;var items=app.elem.nav.querySelectorAll("li[data-name]");val=val.toLowerCase();matches=[];misses=[];if(val){for(var i=0;i<items.length;i++){var item=items[i];var text=item.getAttribute("data-name").toLowerCase().replace(/^[#&]/,"");if(text.substring(0,val.length)==val){matches.push(item)}else{misses.push(item)}}}else{for(var i=0;i<items.length;i++){var item=items[i];if(item.classList.contains("unread")){matches.push(item)}else{misses.push(item)}}}for(var i=0;i<matches.length;i++){matches[i].classList.add("match")}for(var i=0;i<misses.length;i++){misses[i].classList.remove("match")}for(var i=0;i<items.length;i++){if(items[i].classList.contains("selected")){if(items[i].classList.contains("match"))return;for(var j=i;j<items.length;j++){if(items[j].classList.contains("match")){items[i].classList.remove("selected");items[j].classList.add("selected");return}}for(var k=i;k>=0;k--){if(items[k].classList.contains("match")){items[i].classList.remove("selected");items[k].classList.add("selected");return}}}}});window.addEventListener("blur",function(e){app.window_focused=false});window.addEventListener("focus",function(e){app.window_focused=true;app.focus_input();app.update_title()});document.addEventListener("click",function(e){if(e.target.hasAttribute("data-nick")){e.preventDefault();var nick=e.target.getAttribute("data-nick");var connection=app.focused.connection;app.add_panel(nick,connection,true)}document.querySelectorAll(".popup-toggle.open").forEach(function(el){if(!el.contains(e.target)){el.classList.remove("open")}})});function join_click(e){e.preventDefault();app.elem.flex_wrap.classList.remove("open");var dialog=app.new_dialog("join",{connections:Object.values(app.connections)});dialog.el.addEventListener("submit",function(e){e.preventDefault();var channel=dialog.el.querySelector("input[name=channel]").value;var select=dialog.el.querySelector("select");var conn=select.options[select.selectedIndex].value;app.api.post("/connection/"+conn,{body:"JOIN "+channel,headers:{"content-type":"application/irc","lierc-token":app.post_token()},success:function(res){app.post_tokens.push(res.token);app.close_dialog()},error:function(e){app.close_dialog();var res=JSON.parse(e.responseText);alert("Error: "+res.error);app.load_token()}})})}document.querySelectorAll(".join-channel").forEach(function(el){el.addEventListener("click",join_click)});document.querySelectorAll(".add-connection").forEach(function(el){el.addEventListener("click",app.config_modal)});document.querySelectorAll("#nav .nav-title").forEach(function(el){el.addEventListener("click",function(e){if(e.target.classList.contains("nav-title")||e.target.classList.contains("nav-title-text")||e.target.classList.contains("count")){e.preventDefault();el.classList.toggle("collapsed")}})});clickTouchEvent(document.querySelector("#toggle-hideevents a"),function(e){e.preventDefault();app.focused.set_ignore_events(!app.focused.ignore_events);app.update_pref(app.focused.id+"-ignore-events",app.focused.ignore_events)});clickTouchEvent(document.querySelector("#toggle-hideembeds a"),function(e){e.preventDefault();app.focused.set_collapse_embeds(!app.focused.collapse_embeds);app.update_pref(app.focused.id+"-collapse-embeds",app.focused.collapse_embeds)});clickTouchEvent(document.querySelector("#toggle-nicks"),function(e){e.preventDefault();app.focused.set_show_nicklist(!app.focused.show_nicklist);app.update_pref(app.focused.id+"-show-nicklist",app.focused.show_nicklist)});app.elem.emoji.addEventListener("click",function(e){e.preventDefault();var emoji_search=document.querySelector(".emoji-search input");if(e.target.matches("li[data-chars]")){app.focus_input(true);document.execCommand("insertText",false,e.target.getAttribute("data-chars"));app.elem.emoji.classList.remove("open");emoji_search.value="";Emoji.filter(app.elem.emoji,"")}if(e.target.matches("#emoji")){e.target.classList.toggle("open");if(!app.mobile){if(e.target.classList.contains("open")){emoji_search.value="";Emoji.filter(app.elem.emoji,"");emoji_search.focus()}}}});function send_submit(){var input=app.elem.input.querySelector(".input");var panel=app.panels[input.getAttribute("data-panel-id")];var text=input.textContent.trim();if(text=="")return;panel.editor.history.record();var value=Unformat(input.innerHTML);input.innerHTML="";panel.editor.save_selection();value=value.replace("​","");text=text.replace("​","");var connection=app.connections[panel.connection];var send=[];if(text.substring(0,1)=="/"){try{send.push(app.commands.handle(panel,text.substring(1)))}catch(e){alert(e);return}}else if(panel.type=="status"){throw"Can not message a status"}else{var lines=value.split(/[\r\n]/);for(var j=0;j<lines.length;j++){var value=lines[j];if(!value)continue;var privmsg="PRIVMSG "+panel.name+" :";var max=510-"!: PRIVMSG :".length-panel.name.length-connection.nick.length-max_userhost_len;if(value.length<max){send.push(privmsg+value)}else{var words=value.split(/(\b)/);var len=0;var buf=[];if(words.length>max*20){alert("This is too much text!");return}for(var i=0;i<words.length;i++){var word=words[i];if(len+word.length>max){send.push(privmsg+buf.join(""));len=word.length;buf=[word]}else{buf.push(word);len+=word.length}}if(buf.length){send.push(privmsg+buf.join(""))}}}}function sendlines(lines){if(!lines.length)return;app.api.post("/connection/"+panel.connection,{headers:{"content-type":"application/irc","lierc-token":app.post_token()},body:lines.shift(),success:function(res){app.post_tokens.push(res.token);if(lines.length)sendlines(lines)},error:function(e){alert("Error: "+e);app.load_token()}})}sendlines(send)}document.getElementById("gist-upload-form").addEventListener("submit",function(e){e.preventDefault();var form=e.target;var submit=form.querySelector("input[name=upload]");var text=form.querySelector("textarea");var ext=form.querySelector("select");var filename="files1."+ext.options[ext.selectedIndex].value;submit.setAttribute("disabled","disabled");text.setAttribute("disabled","disabled");var data={"public":false,files:{}};data["files"][filename]={content:text.value};fetch("https://api.github.com/gists",{method:"POST",body:JSON.stringify(data)}).then(function(res){if(!res.ok)throw Error(res.statusText);return res.json()}).then(function(res){submit.removeAttribute("disabled");text.removeAttribute("disabled");text.value="";app.focus_input(true);document.execCommand("insertText",false,res.html_url);document.getElementById("upload").classList.remove("open")}).catch(function(e){alert("I'm sorry");submit.removeAttribute("disabled");text.removeAttribute("disabled")})});document.getElementById("image-upload-form").addEventListener("submit",function(e){e.preventDefault();var submit=e.target.querySelector('input[name="upload"]');var image=e.target.querySelector('input[name="image"]');var files=image.files;if(files.length==0||!files[0].type.match(/^image/)){alert("Must select an image file");return}var fd=new FormData;fd.append("image",files[0]);var xhr=new XMLHttpRequest;xhr.open("POST","//api.imgur.com/3/image");xhr.setRequestHeader("Authorization","Client-ID 033f98700d8577c");submit.setAttribute("disabled","disabled");xhr.addEventListener("load",function(){var res=JSON.parse(xhr.responseText);app.focus_input(true);document.execCommand("insertText",false,res.data.link);document.getElementById("upload").classList.remove("open");image.value=null;submit.removeAttribute("disabled")});xhr.send(fd)});clickTouchEvent(document.getElementById("upload"),function(e){if(e.target.matches("#upload")){e.preventDefault();e.target.classList.toggle("open")}});clickTouchEvent(document.getElementById("help"),function(e){e.preventDefault();app.new_dialog("help")});clickTouchEvent(document.getElementById("logout"),function(e){e.preventDefault();if(!confirm("Are you sure you want to log out?"))return;app.api.logout()});window.addEventListener("resize",function(e){if(app.focused){app.focused.scroll_bottom(0);app.focused.resize_filler()}});document.addEventListener("copy",function(e){if(app.overlayed())return;e.preventDefault();var selected=window.getSelection().toString().split("\n");var lines=[];var nick;for(i in selected){var line=selected[i].trim();if(line.match(/^\d\d:\d\d$/))continue;if(!nick&&line.match(/^< [^>]+>$/)){nick=line;continue}if(nick){lines.push(nick+" "+line);nick=null;continue}if(line.match(/\S/))lines.push(line)}e.clipboardData.setData("Text",lines.join("\n"))});document.addEventListener("paste",function(e){if(app.overlayed())return;if(document.activeElement.matches("#gist-upload-input"))return;e.preventDefault();var clipboard=e.clipboardData||e.originalEvent.clipboardData;var items=clipboard.items;for(i in items){if(items[i].type&&items[i].type.match(/^image\//)){app.focus_input();var blob=items[i].getAsFile();var fd=new FormData;fd.append("image",blob);var xhr=new XMLHttpRequest;xhr.open("POST","//api.imgur.com/3/image");xhr.setRequestHeader("Authorization","Client-ID 033f98700d8577c");xhr.onload=function(){var res=JSON.parse(xhr.responseText);app.focus_input(true);document.execCommand("insertText",false,res.data.link)};xhr.send(fd);return}}app.focus_input();var lines=clipboard.getData("Text").trim().split(/[\r\n]/);var text=lines.map(function(line){return line.trim()}).filter(function(line){return line.match(/\S/)}).join("\n");document.execCommand("insertText",false,text)});clickTouchEvent(document.querySelector(".flex-wrap-left header"),function(e){e.preventDefault();app.elem.flex_wrap.classList.toggle("open")});document.addEventListener("input",function(e){if(e.target.matches(".emoji-search input")){var list=e.target.parentNode.previousSibling;Emoji.filter(list,e.target.value)}});document.getElementById("web-notify").addEventListener("click",function(e){e.preventDefault();if(app.notify.subscribed){app.notify.unsubscribe()}else{app.notify.subscribe()}});document.getElementById("email-notify").addEventListener("click",function(e){e.preventDefault();this.classList.toggle("enabled");var enabled=this.classList.contains("enabled");app.update_pref("email",enabled)});app.elem.panel.addEventListener("click",function(e){if(!e.target.matches(".message-menu, .message-menu *"))return;var target=e.target;var toggle=target;var controls=target;var message=target;while(toggle&&!toggle.matches(".message-menu")){toggle=toggle.parentNode}while(controls&&!controls.matches(".message-controls")){controls=controls.parentNode}while(message&&!message.matches("li.message")){message=message.parentNode}var is_monospace=message.classList.contains("monospace");toggle.classList.toggle("open");if(target.matches(".message-menu")){if(toggle.classList.contains("open")){var has_child=toggle.querySelector(".message-menu-popup");if(!has_child){var html=Template("message_menu",{is_monospace:is_monospace});toggle.insertAdjacentHTML("beforeend",html)}controls.classList.add("open")}else{controls.classList.remove("open")}}else if(target.matches(".message-privmsg")){controls.classList.remove("open");message.querySelector(".message-nick").click()}else if(target.matches(".message-monospace")){controls.classList.remove("open");var nick=message.querySelector(".message-nick").getAttribute("data-nick");if(is_monospace){app.remove_monospace_nick(app.focused,nick)}else{app.add_monospace_nick(app.focused,nick)}}});app.elem.panel.addEventListener("click",function(e){if(!e.target.matches(".embed-toggle"))return;e.preventDefault();var toggle=e.target;var embed=JSON.parse(toggle.getAttribute("data-embed"));toggle.classList.toggle("hidden");if(toggle.classList.contains("hidden")){var wrap=document.querySelector(".embed-wrap[data-embed-id='"+embed.id+"']");wrap.parentNode.parentNode.removeChild(wrap.parentNode)}else{app.focused.scroll(function(){var a=toggle.previousSibling;app.focused.embed(a,embed,true)})}});app.elem.topic.addEventListener("click",function(e){if(app.focused){if(e.target.nodeName!="A"){var elem=this;app.focused.scroll(function(){elem.classList.toggle("expanded")})}}});app.elem.panel.addEventListener("click",function(e){if(!e.target.matches(".embed-wrap[data-embed-id]:not(.open),"+".embed-wrap[data-embed-id]:not(.open) *"))return;var p=e.target;while(p&&!p.matches(".embed-wrap[data-embed-id]")){p=p.parentNode}var id=p.getAttribute("data-embed-id");var a=document.querySelector(".embed-toggle[data-embed-id='"+id+"']");var embed=JSON.parse(a.getAttribute("data-embed"));app.focused.scroll(function(){p.classList.add("open");p.innerHTML=embed.html;var head=document.querySelector("head");p.querySelectorAll("script").forEach(function(el){var s=el.parentNode.removeChild(el);var script=document.createElement("SCRIPT");var attrs=s.attributes;for(var i=0;i<attrs.length;i++){script.setAttribute(attrs[i].name,attrs[i].value)}head.appendChild(script)})});var h=p.clientHeight;var panel=app.focused;var m=new MutationObserver(function(s){var u=p.clientHeight;if(!panel.is_scrolled())panel.scroller.scrollTop+=u-h;h=u});var c={childList:true,attributes:true,subtree:true,attributeFilter:["class","style"]};m.observe(p,c);setTimeout(function(){m.disconnect()},1e4)});app.elem.panel.addEventListener("click",function(e){if(!e.target.matches(".message-react, .message-react *"))return;var target=e.target;var react=target;var controls=target;while(react&&!react.matches(".message-react")){react=react.parentNode}while(controls&&!controls.matches(".message-controls")){controls=controls.parentNode}if(target.matches(".message-react")){react.classList.toggle("open");if(react.classList.contains("open")){var emoji=document.querySelector("#emoji .emoji-popup").cloneNode(true);react.appendChild(emoji);emoji.querySelector(".emoji-search input").focus();controls.classList.add("open")}else{var popup=react.querySelector(".emoji-popup");popup.parentNode.removeChild(popup);controls.classList.remove("open")}}if(target.matches("li[data-chars]")){var emoji=target.getAttribute("data-chars");var message=react;while(message&&!message.matches("li.message")){message=message.parentNode}var hash=message.getAttribute("data-message-hash");var panel=app.focused;react.classList.remove("open");controls.classList.remove("open");var popup=react.querySelector(".emoji-popup");popup.parentNode.removeChild(popup);if(!(emoji&&hash&&panel))return;app.api.post("/connection/"+panel.connection,{body:"PRIVMSG "+panel.name+" :"+["FACE",hash,emoji].join(" "),headers:{"lierc-token":app.post_token(),"content-type":"application/irc"},success:function(res){app.post_tokens.push(res.token)},error:function(e){var res=JSON.parse(e.responseText);alert("Error: "+res.error);app.load_token()}})}});window.addEventListener("beforeunload",function(){if(app.focused){app.focused.update_seen();app.save_seen(app.focused,true)}});app.elem.panel.addEventListener("transitionend",function(e){if(e.target.matches("li.chat"))e.target.classList.remove("loading","loaded")});document.onselectionchange=function(e){if(app.focused&&app.focused.editor.focused){app.focused.editor.save_selection()}}};
//# sourceMappingURL=/static/site.map.js